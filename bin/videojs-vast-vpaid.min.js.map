{"version":3,"sources":["videojs-vast-vpaid.js","utilityFunctions.js","http.js","urlUtils.js","ads/vpaid/VPAIDAdUnitWrapper.js","ads/vpaid/VPAIDFlashTech.js","ads/vpaid/VPAIDHTML5Tech.js","ads/vpaid/VPAIDIntegrator.js","ads/vast/client/Ad.js","ads/vast/client/Creative.js","ads/vast/client/Inline.js","ads/vast/client/Linear.js","ads/vast/client/MediaFile.js","ads/vast/client/TrackingEvent.js","ads/vast/client/VASTClient.js","ads/vast/client/VASTError.js","ads/vast/client/VASTIntegrator.js","ads/vast/client/VASTTracker.js","ads/vast/client/VideoClicks.js","ads/vast/client/Wrapper.js","async.js","dom.js","playerUtils.js","xml.js","ads/videojs.vast.js","ads/components/ads-label.js","ads/components/black-poster.js","ads/vast/client/VASTResponse.js","ads/vast/client/vastUtil.js"],"names":["window","document","vjs","undefined","noop","isNull","o","isDefined","isUndefined","isObject","obj","isFunction","str","isNumber","num","isArray","array","Object","prototype","toString","call","isString","isEmptyString","length","isNotEmptyString","arrayLikeObjToArray","args","Array","slice","forEach","iterator","context","key","hasOwnProperty","isPrimitive","extend","arg","i","k","arguments","capitalize","s","charAt","toUpperCase","decapitalize","toLowerCase","transformArray","transformer","transformedArray","item","index","transformedItem","push","toFixedDigits","digits","formattedNum","parseInt","isNaN","NaN","throttle","callback","delay","previousCall","Date","getTime","time","apply","this","echoFn","val","isISO8601","value","iso8086Regex","test","trim","isOldIE","version","getInternetExplorerVersion","navigator","rv","appName","ua","userAgent","re","RegExp","res","exec","parseFloat","isIDevice","_UA","isIPhone","HttpRequestError","message","HttpRequest","createXhr","xhr","XMLHttpRequest","XDomainRequest","urlParts","url","href","msie","urlParsingNode","setAttribute","protocol","replace","host","search","hash","hostname","port","pathname","VPAIDAdUnitWrapper","vpaidAdUnit","opts","sanityCheck","adUnit","checkVPAIDInterface","VASTError","responseTimeout","options","_adUnit","VPAIDFlashTech","mediaFile","settings","src","name","containerEl","vpaidFlashClient","VPAIDHTML5Tech","INVALID_MEDIA_FILE","videoEl","vpaidHTMLClient","VPAIDIntegrator","player","createVPAIDContainerEl","createElement","dom","addClass","el","insertBefore","controlBar","VIEW_MODE","NORMAL","FULLSCREEN","THUMBNAIL","VPAID_VERSION","resizeAd","tech","querySelector","dimension","getDimension","MODE","isFullscreen","width","height","logError","error","console","log","Ad","adJTree","id","attr","sequence","inLine","InLine","wrapper","Wrapper","Creative","creativeJTree","adId","apiFramework","linear","Linear","inlineJTree","parseSurveys","inlineSurveys","survey","keyValue","uri","type","adTitle","xml","adSystem","impressions","vastUtil","parseImpressions","impression","creatives","parseCreatives","description","advertiser","surveys","pricing","extensions","linearJTree","parseTrackingEvents","trackingEvents","duration","trackings","trackingData","TrackingEvent","parseMediaFiles","mediaFilesJxonTree","mediaFiles","mfData","MediaFile","parseDuration","tracking","skipoffset","parseOffset","videoClicks","VideoClicks","adParameters","decode","mediaFileJTree","delivery","codec","bitrate","minBitrate","maxBitrate","scalable","maintainAspectRatio","trackingJTree","offset","VASTClient","defaultOptions","WRAPPER_LIMIT","errorURLMacros","code","VASTIntegrator","VASTTracker","assetURI","vastResponse","VASTResponse","response","progress","quartiles","firstQuartile","tracked","Math","round","midpoint","thirdQuartile","videoClickJTree","parseClickTrackings","clickTrackings","clickTrackingData","clickThrough","clickTracking","customClicks","customClick","wrapperJTree","VASTAdTagURI","vASTAdTagURI","followAdditionalWrappers","allowMultipleAds","fallbackOnNoAd","async","setImmediate","fn","setTimeout","tasks","makeCallback","next","waterfall","err","Error","wrapIterator","when","condition","isAllowed","pop","unshift","isVisible","style","getComputedStyle","visibility","isHidden","display","isShown","hide","__prev_style_display_","show","hasClass","cssClass","classes","len","classList","contains","getAttribute","split","add","join","removeClass","remove","newClasses","addEventListener","handler","e","t","attachEvent","removeEventListener","detachEvent","dispatchEvent","event","fireEvent","eventType","isDescendant","parent","child","node","parentNode","getTextContent","textContent","text","prependChild","removeChild","firstChild","isDomElement","Element","click","once","handlerWrap","element","rect","getBoundingClientRect","offsetWidth","offsetHeight","run","method","setHeaders","headers","setRequestHeader","requestError","timeout","timeoutId","open","withCredentials","onload","statusText","status","getAllResponseHeaders","clearTimeout","responseText","onerror","onabort","send","abort","get","processResponse","headersString","isSuccess","http","playerUtils","getPlayerSnapshot","getSuppressedTracks","tracks","remoteTextTracks","tracks_","suppressedTracks","track","mode","snapshot","ended","currentSrc","currentTime","currentType","playing","paused","nativePoster","poster","restorePlayerSnapshot","ensureCanplayEvtGetsFired","trigger","one","hasSrcChanged","restoreTracks","trackSnapshot","tryToResume","resume","play","isReadyToResume","attempts","videojs","warn","load","readyState","seekable","prepareForAds","monkeyPatchPlayerApi","origPlay","callOrigPlay","firstPlay","volumeSnapshot","saveVolumeSnapshot","muted","isAdPlaying","vast","resumeAd","isFirstPlay","origPause","pause","callOrigPause","pauseAd","origPaused","callOrigPaused","isPaused","tryToTriggerFirstPlay","_firstPlay","resetFirstPlay","blackPoster","restoreContentVolume","volume","restoreVolumeSnapshot","hideBlackPoster","addStyles","removeStyles","addChild","on","removeNativePoster","removeAttribute","events","listener","off","documentMode","strToXMLDoc","stringContainingXMLSource","parseString","parsedDocument","parser","DOMParser","parseFromString","isParseError","errorneousParse","parsererrorNS","getElementsByTagName","namespaceURI","getElementsByTagNameNS","xmlDocument","ActiveXObject","loadXML","parseText","sValue","isFinite","JXONTree","oXMLParent","documentElement","hasChildNodes","oNode","sProp","vContent","sCollectedTxt","nItem","childNodes","nodeType","nodeValue","prefix","nodeName","constructor","hasAttr","hasAttributes","attributes","oAttrib","nAttrib","toJXONTree","xmlString","xmlDoc","xmlObj","encode","plugin","tryToPlayPrerollAd","removeAdUnit","restoreVideoContent","setupContentEvents","evt","checkAdsEnabled","adsEnabled","preparePlayerForAd","canPlayPrerollAd","addSpinnerIcon","startAdCancelTimeout","iosPrerollCancelTimeout","clearAdCancelTimeout","adCancelTimeoutId","adsCanceled","trackAdError","adCancelTimeout","removeSpinnerIcon","playPrerollAd","cancelAds","getVastResponse","playAd","getVASTResponse","adTagUrl","adTagXML","addAdsLabel","adFinished","getChild","removeAdsLabel","preventManualProgress","adTimeupdateHandler","progressDelta","abs","previousTime","PROGRESS_THRESHOLD","skipad_attempts","stopPreventManualProgress","adIntegrator","isVPAID","defaultOpts","playAdAlways","autoResize","vpaidFlashLoaderPath","isEnabled","enable","disable","vjsComponent","getComponent","AdsLabel","that","currentTimeComp","createEl","className","innerHTML","registerComponent","BlackPoster","posterImg","bind","VPAIDAdUnit","canSubscribeToEvents","subscribe","canUnsubscribeFromEvents","unsubscribe","VPAIDInterfaceMethods","adUnitAsyncCall","cb","wrapCallback","shift","evtName","waitForEvent","responseListener","handshakeVersion","initAd","viewMode","desiredBitrate","adUnitData","startAd","stopAd","expandAd","collapseAd","skipAd","property","getterName","setAdVolume","supports","VPAIDFLASHClient","isSupported","loadAdUnit","objectEl","container","flashClientOpts","data","unloadAdUnit","destroy","video","INVALID_DOM_CONTAINER_EL","tagName","MISSING_CALLBACK","VPAIDHTML5Client","PREFIX","INVALID_DOM_VIDEO_EL","techs","triggerVpaidAdEnd","_findSupportedTech","_loadAdUnit","_playAdUnit","_finishPlaying","_trackError","_paused","getSrc","findSupportedTech","mediafile","VPAIDTech","vpaidMediaFiles","filter","vjsTechEl","WrappedAdUnit","techClass","_handshake","_initAd","_setupEvents","_addSkipButton","_linkPlayerControls","_startAd","isSupportedVersion","majorNum","major","parts","AdParameters","notifyPlayToPlayer","notifyPauseToPlayer","pauseAdUnit","resumeAdUnit","adUnitSrc","tracker","trackSkip","trackImpressions","trackCreativeView","trackStart","trackResume","trackPause","trackFirstQuartile","trackMidpoint","trackThirdQuartile","trackComplete","generateClickThroughURL","clickThroughMacro","variables","ASSETURI","CONTENTPLAYHEAD","parseURLMacro","playerHandles","clickThruUrl","trackClick","trackAcceptInvitation","trackAcceptInvitationLinear","trackClose","trackCloseLinear","trackCollapse","trackErrorWithCode","lastVolume","getAdVolume","currentVolume","trackMute","trackUnmute","updateViewSize","updateViewSizeThrottled","updateSkipButtonState","getAdSkippableState","isSkippable","skipButton","addSkipButton","removeSkipButton","createSkipButton","appendChild","onclick","Event","stopPropagation","linkVolumeControl","updateAdUnitVolume","vol","updatePlayerVolume","linkFullScreenControl","finishPlayingAd","errMsg","ERRORCODE","buildVASTResponse","adsChain","_buildVASTResponse","_getVASTAd","getAdWaterfall","requestVastXML","_requestVASTXml","buildVastWaterfall","xmlStr","vastTree","ads","ad","validateVASTTree","vastVersion","getAd","adChain","requestVASTAd","buildAd","adJxonTree","validateAd","errMsgPrefix","waterfallHandler","waterfallAds","requestHandler","addAdsToResponse","addAd","validateResponse","progressEvents","hasLinear","progressEvent","addErrorUrlMacros","_selectAdSource","_createVASTTracker","_addClickThrough","_playSelectedAd","_src","source","playerWidth","sort","a","b","deltaA","deltaB","selectSource","adMediaFile","unbindEvents","trackFullscreenChange","trackProgress","trackVolumeChange","trackFullscreen","trackExitFullscreen","currentTimeInMs","previouslyMuted","addSkipButtonToPlayer","skipOffset","updateSkipButton","timeLeft","ceil","skipOffsetInSec","createClickThroughBlocker","blocker","target","updateBlockerURL","formatProgress","removeBlocker","updateBlocker","preload","_linearAdded","appendToArray","items","_addInLine","_addWrapper","_addErrorTrackUrl","errorURL","_addImpressions","_addClickTrackings","_addCustomClicks","_addTrackingEvents","eventsMap","trackingEvent","_addTitle","title","_addDuration","_addVideoClicks","_addMediaFiles","_addSkipoffset","_addAdParameters","_addLinear","creative","trackURLs","urls","trackEvent","eventName","trackOnce","getEventUris","uris","newProgressInMs","hasRewound","currentProgress","newProgress","REWIND_THRESHOLD","addTrackEvent","canBeAdded","addQuartileEvents","trackQuartile","quartileName","quartile","canBeTracked","ONCE","quartileTime","trackProgressEvents","pendingProgressEvts","trackEvents","ALWAYS","errorcode","URLMacros","sources","parseURLMacros","trackImgs","img","Image","parsedURLs","random","URLMacro","_parseURLMacro","durationStr","parseHoursToMs","hourStr","parseMinToMs","minStr","parseSecToMs","secStr","match","durationInMs","durationRegex","creativesJTree","creativesData","hours","minutes","seconds","milliseconds","floor","isPercentage","percentageRegex","calculatePercentage","percentStr","calcPercent","quantity","percent"],"mappings":"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","file":"videojs-vast-vpaid.min.js","sourcesContent":["(function (window, document, vjs, undefined) {/*jshint unused:false */\n\"use strict\";\n\nvar NODE_TYPE_ELEMENT = 1;\n\nfunction noop(){ }\n\nfunction isNull(o) {\n  return o === null;\n}\n\nfunction isDefined(o){\n  return o !== undefined;\n}\n\nfunction isUndefined(o){\n  return o === undefined;\n}\n\nfunction isObject(obj) {\n  return typeof obj === 'object';\n}\n\nfunction isFunction(str){\n  return typeof str === 'function';\n}\n\nfunction isNumber(num){\n  return typeof num === 'number';\n}\n\nfunction isWindow(obj) {\n  return isObject(obj) && obj.window === obj;\n}\n\nfunction isArray(array){\n  return Object.prototype.toString.call( array ) === '[object Array]';\n}\n\nfunction isArrayLike(obj) {\n  if (obj === null || isWindow(obj) || isFunction(obj) || isUndefined(obj)) {\n    return false;\n  }\n\n  var length = obj.length;\n\n  if (obj.nodeType === NODE_TYPE_ELEMENT && length) {\n    return true;\n  }\n\n  return isString(obj) || isArray(obj) || length === 0 ||\n    typeof length === 'number' && length > 0 && (length - 1) in obj;\n}\n\nfunction isString(str){\n  return typeof str === 'string';\n}\n\nfunction isEmptyString(str) {\n  return isString(str) && str.length === 0;\n}\n\nfunction isNotEmptyString(str) {\n  return isString(str) && str.length !== 0;\n}\n\nfunction arrayLikeObjToArray(args) {\n  return Array.prototype.slice.call(args);\n}\n\nfunction forEach(obj, iterator, context) {\n  var key, length;\n  if (obj) {\n    if (isFunction(obj)) {\n      for (key in obj) {\n        // Need to check if hasOwnProperty exists,\n        // as on IE8 the result of querySelectorAll is an object without a hasOwnProperty function\n        if (key !== 'prototype' && key !== 'length' && key !== 'name' && (!obj.hasOwnProperty || obj.hasOwnProperty(key))) {\n          iterator.call(context, obj[key], key, obj);\n        }\n      }\n    } else if (isArray(obj)) {\n      var isPrimitive = typeof obj !== 'object';\n      for (key = 0, length = obj.length; key < length; key++) {\n        if (isPrimitive || key in obj) {\n          iterator.call(context, obj[key], key, obj);\n        }\n      }\n    } else if (obj.forEach && obj.forEach !== forEach) {\n      obj.forEach(iterator, context, obj);\n    } else {\n      for (key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          iterator.call(context, obj[key], key, obj);\n        }\n      }\n    }\n  }\n  return obj;\n}\n\nvar SNAKE_CASE_REGEXP = /[A-Z]/g;\nfunction snake_case(name, separator) {\n  separator = separator || '_';\n  return name.replace(SNAKE_CASE_REGEXP, function(letter, pos) {\n    return (pos ? separator : '') + letter.toLowerCase();\n  });\n}\n\nfunction isValidEmail(email){\n  if(!isString(email)){\n    return false;\n  }\n  var EMAIL_REGEXP = /^[a-z0-9!#$%&'*+\\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)+$/i;\n  return EMAIL_REGEXP.test(email.trim());\n}\n\nfunction extend (obj) {\n  var arg, i, k;\n  for (i = 1; i < arguments.length; i++) {\n    arg = arguments[i];\n    for (k in arg) {\n      if (arg.hasOwnProperty(k)) {\n        if(isObject(obj[k]) && !isNull(obj[k]) && isObject(arg[k])){\n          obj[k] = extend({}, obj[k], arg[k]);\n        }else {\n          obj[k] = arg[k];\n        }\n      }\n    }\n  }\n  return obj;\n}\n\nfunction capitalize(s){\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction decapitalize(s) {\n  return s.charAt(0).toLowerCase() + s.slice(1);\n}\n\n/**\n * This method works the same way array.prototype.map works but if the transformer returns undefine, then\n * it won't be added to the transformed Array.\n */\nfunction transformArray(array, transformer) {\n  var transformedArray = [];\n\n  array.forEach(function(item, index){\n    var transformedItem = transformer(item, index);\n    if(isDefined(transformedItem)) {\n      transformedArray.push(transformedItem);\n    }\n  });\n\n  return transformedArray;\n}\n\nfunction toFixedDigits(num, digits) {\n  var formattedNum = num + '';\n  digits = isNumber(digits) ? digits : 0;\n  num = isNumber(num) ? num : parseInt(num, 10);\n  if(isNumber(num) && !isNaN(num)){\n    formattedNum = num + '';\n    while(formattedNum.length < digits) {\n      formattedNum = '0' + formattedNum;\n    }\n    return formattedNum;\n  }\n  return NaN + '';\n}\n\nfunction throttle(callback, delay) {\n  var previousCall = new Date().getTime() - (delay + 1);\n  return function() {\n    var time = new Date().getTime();\n    if ((time - previousCall) >= delay) {\n      previousCall = time;\n      callback.apply(this, arguments);\n    }\n  };\n}\n\nfunction debounce (callback, wait) {\n  var timeoutId;\n\n  return function (){\n    if(timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(function(){\n      callback.apply(this, arguments);\n      timeoutId = undefined;\n    }, wait);\n  };\n}\n\n// a function designed to blow up the stack in a naive way\n// but it is ok for videoJs children components\nfunction treeSearch(root, getChildren, found){\n  var children = getChildren(root);\n  for (var i = 0; i < children.length; i++){\n    if (found(children[i])) {\n      return children[i];\n    }\n    else {\n      var el = treeSearch(children[i], getChildren, found);\n      if (el){\n        return el;\n      }\n    }\n  }\n}\n\nfunction echoFn(val) {\n  return function () {\n    return val;\n  };\n}\n\n//Note: Supported formats come from http://www.w3.org/TR/NOTE-datetime\n// and the iso8601 regex comes from http://www.pelagodesign.com/blog/2009/05/20/iso-8601-date-validation-that-doesnt-suck/\nfunction isISO8601(value) {\n  if(isNumber(value)){\n    value = value + '';  //we make sure that we are working with strings\n  }\n\n  if(!isString(value)){\n    return false;\n  }\n\n  /*jslint maxlen: 500 */\n  var iso8086Regex = /^([\\+-]?\\d{4}(?!\\d{2}\\b))((-?)((0[1-9]|1[0-2])(\\3([12]\\d|0[1-9]|3[01]))?|W([0-4]\\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\\d|[12]\\d{2}|3([0-5]\\d|6[1-6])))([T\\s]((([01]\\d|2[0-3])((:?)[0-5]\\d)?|24\\:?00)([\\.,]\\d+(?!:))?)?(\\17[0-5]\\d([\\.,]\\d+)?)?([zZ]|([\\+-])([01]\\d|2[0-3]):?([0-5]\\d)?)?)?)?$/;\n  return iso8086Regex.test(value.trim());\n}\n\n/**\n * Checks if the Browser is IE9 and below\n * @returns {boolean}\n */\nfunction isOldIE() {\n  var version = getInternetExplorerVersion(navigator);\n  if (version === -1) {\n    return false;\n  }\n\n  return version < 10;\n}\n\n/**\n * Returns the version of Internet Explorer or a -1 (indicating the use of another browser).\n * Source: https://msdn.microsoft.com/en-us/library/ms537509(v=vs.85).aspx\n * @returns {number} the version of Internet Explorer or a -1 (indicating the use of another browser).\n */\nfunction getInternetExplorerVersion(navigator) {\n  var rv = -1;\n\n  if (navigator.appName == 'Microsoft Internet Explorer') {\n    var ua = navigator.userAgent;\n    var re = new RegExp(\"MSIE ([0-9]{1,}[\\.0-9]{0,})\");\n    var res = re.exec(ua);\n    if (res !== null) {\n      rv = parseFloat(res[1]);\n    }\n  }\n\n  return rv;\n}\n\n/*** Mobile Utility functions ***/\nvar _UA = navigator.userAgent;\nfunction isIDevice() {\n  return /iP(hone|ad)/.test(_UA);\n}\n\nfunction isMobile() {\n  return /iP(hone|ad|od)|Android|Windows Phone/.test(_UA);\n}\n\nfunction isIPhone() {\n  return /iP(hone|od)/.test(_UA);\n}\n\nfunction isAndroid() {\n  return /Android/.test(_UA);\n}\n\n;\n//Small subset of async\nvar async = {};\n\nasync.setImmediate = function (fn) {\n  setTimeout(fn, 0);\n};\n\nasync.iterator = function (tasks) {\n  var makeCallback = function (index) {\n    var fn = function () {\n      if (tasks.length) {\n        tasks[index].apply(null, arguments);\n      }\n      return fn.next();\n    };\n    fn.next = function () {\n      return (index < tasks.length - 1) ? makeCallback(index + 1) : null;\n    };\n    return fn;\n  };\n  return makeCallback(0);\n};\n\n\nasync.waterfall = function (tasks, callback) {\n  callback = callback || function () { };\n  if (!isArray(tasks)) {\n    var err = new Error('First argument to waterfall must be an array of functions');\n    return callback(err);\n  }\n  if (!tasks.length) {\n    return callback();\n  }\n  var wrapIterator = function (iterator) {\n    return function (err) {\n      if (err) {\n        callback.apply(null, arguments);\n        callback = function () {\n        };\n      }\n      else {\n        var args = Array.prototype.slice.call(arguments, 1);\n        var next = iterator.next();\n        if (next) {\n          args.push(wrapIterator(next));\n        }\n        else {\n          args.push(callback);\n        }\n        async.setImmediate(function () {\n          iterator.apply(null, args);\n        });\n      }\n    };\n  };\n  wrapIterator(async.iterator(tasks))();\n};\n\nasync.when = function (condition, callback) {\n  if (!isFunction(callback)) {\n    throw new Error(\"async.when error: missing callback argument\");\n  }\n\n  var isAllowed = isFunction(condition) ? condition : function () {\n    return !!condition;\n  };\n\n  return function () {\n    var args = arrayLikeObjToArray(arguments);\n    var next = args.pop();\n\n    if (isAllowed.apply(null, args)) {\n      return callback.apply(this, arguments);\n    }\n\n    args.unshift(null);\n    return next.apply(null, args);\n  };\n};\n\n\n\n;\n\"use strict\";\n\nvar dom = {};\n\ndom.isVisible = function isVisible(el) {\n  var style = window.getComputedStyle(el);\n  return style.visibility !== 'hidden';\n};\n\ndom.isHidden = function isHidden(el) {\n  var style = window.getComputedStyle(el);\n  return style.display === 'none';\n};\n\ndom.isShown = function isShown(el) {\n  return !dom.isHidden(el);\n};\n\ndom.hide = function hide(el) {\n  el.__prev_style_display_ = el.style.display;\n  el.style.display = 'none';\n};\n\ndom.show = function show(el) {\n  if (dom.isHidden(el)) {\n    el.style.display = el.__prev_style_display_;\n  }\n  el.__prev_style_display_ = undefined;\n};\n\ndom.hasClass = function hasClass(el, cssClass) {\n  var classes, i, len;\n\n  if (isNotEmptyString(cssClass)) {\n    if (el.classList) {\n      return el.classList.contains(cssClass);\n    }\n\n    classes = isString(el.getAttribute('class')) ? el.getAttribute('class').split(/\\s+/) : [];\n    cssClass = (cssClass || '');\n\n    for (i = 0, len = classes.length; i < len; i += 1) {\n      if (classes[i] === cssClass) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\ndom.addClass = function (el, cssClass) {\n  var classes;\n\n  if (isNotEmptyString(cssClass)) {\n    if (el.classList) {\n      return el.classList.add(cssClass);\n    }\n\n    classes = isString(el.getAttribute('class')) ? el.getAttribute('class').split(/\\s+/) : [];\n    if (isString(cssClass) && isNotEmptyString(cssClass.replace(/\\s+/, ''))) {\n      classes.push(cssClass);\n      el.setAttribute('class', classes.join(' '));\n    }\n  }\n};\n\ndom.removeClass = function (el, cssClass) {\n  var classes;\n\n  if (isNotEmptyString(cssClass)) {\n    if (el.classList) {\n      return el.classList.remove(cssClass);\n    }\n\n    classes = isString(el.getAttribute('class')) ? el.getAttribute('class').split(/\\s+/) : [];\n    var newClasses = [];\n    var i, len;\n    if (isString(cssClass) && isNotEmptyString(cssClass.replace(/\\s+/, ''))) {\n\n      for (i = 0, len = classes.length; i < len; i += 1) {\n        if (cssClass !== classes[i]) {\n          newClasses.push(classes[i]);\n        }\n      }\n      el.setAttribute('class', newClasses.join(' '));\n    }\n  }\n};\n\ndom.addEventListener = function addEventListener(el, type, handler) {\n  if(isArray(el)){\n    forEach(el, function(e) {\n      dom.addEventListener(e, type, handler);\n    });\n    return;\n  }\n\n  if(isArray(type)){\n    forEach(type, function(t) {\n      dom.addEventListener(el, t, handler);\n    });\n    return;\n  }\n\n  if (el.addEventListener) {\n    el.addEventListener(type, handler, false);\n  } else if (el.attachEvent) {\n    // WARNING!!! this is a very naive implementation !\n    // the event object that should be passed to the handler\n    // would not be there for IE8\n    // we should use \"window.event\" and then \"event.srcElement\"\n    // instead of \"event.target\"\n    el.attachEvent(\"on\" + type, handler);\n  }\n};\n\ndom.removeEventListener = function removeEventListener(el, type, handler) {\n  if(isArray(el)){\n    forEach(el, function(e) {\n      dom.removeEventListener(e, type, handler);\n    });\n    return;\n  }\n\n  if(isArray(type)){\n    forEach(type, function(t) {\n      dom.removeEventListener(el, t, handler);\n    });\n    return;\n  }\n\n  if (el.removeEventListener) {\n    el.removeEventListener(type, handler, false);\n  } else if (el.detachEvent) {\n    el.detachEvent(\"on\" + type, handler);\n  } else {\n    el[\"on\" + type] = null;\n  }\n};\n\ndom.dispatchEvent = function dispatchEvent(el, event) {\n  if (el.dispatchEvent) {\n    el.dispatchEvent(event);\n  } else {\n    el.fireEvent(\"on\" + event.eventType, event);\n  }\n};\n\ndom.isDescendant = function isDescendant(parent, child) {\n  var node = child.parentNode;\n  while (node !== null) {\n    if (node === parent) {\n      return true;\n    }\n    node = node.parentNode;\n  }\n  return false;\n};\n\ndom.getTextContent = function getTextContent(el){\n  return el.textContent || el.text;\n};\n\ndom.prependChild = function prependChild(parent, child) {\n  if(child.parentNode){\n    child.parentNode.removeChild(child);\n  }\n  return parent.insertBefore(child, parent.firstChild);\n};\n\ndom.remove = function removeNode(node){\n  if(node && node.parentNode){\n    node.parentNode.removeChild(node);\n  }\n};\n\ndom.isDomElement = function isDomElement(o) {\n  return o instanceof Element;\n};\n\ndom.click = function(el, handler) {\n  dom.addEventListener(el, 'click', handler);\n};\n\ndom.once = function(el, type, handler) {\n  function handlerWrap() {\n    handler.apply(null, arguments);\n    dom.removeEventListener(el, type, handlerWrap);\n  }\n\n  dom.addEventListener(el, type, handlerWrap);\n};\n\n//Note: there is no getBoundingClientRect on iPad so we need a fallback\ndom.getDimension = function getDimension(element) {\n  var rect;\n\n  //On IE9 and below getBoundingClientRect does not work consistently\n  if(!isOldIE() && element.getBoundingClientRect) {\n    rect = element.getBoundingClientRect();\n    return {\n      width: rect.width,\n      height: rect.height\n    };\n  }\n\n  return {\n    width: element.offsetWidth,\n    height: element.offsetHeight\n  };\n};\n\n;\n\"use strict\";\n\nfunction HttpRequestError(message) {\n  this.message = 'HttpRequest Error: ' + (message || '');\n}\nHttpRequestError.prototype = new Error();\nHttpRequestError.prototype.name = \"HttpRequest Error\";\n\nfunction HttpRequest(createXhr) {\n  if (!isFunction(createXhr)) {\n    throw new HttpRequestError('Missing XMLHttpRequest factory method');\n  }\n\n  this.createXhr = createXhr;\n}\n\nHttpRequest.prototype.run = function (method, url, callback, options) {\n  sanityCheck(url, callback, options);\n  var timeout, timeoutId;\n  var xhr = this.createXhr();\n  options = options || {};\n  timeout = isNumber(options.timeout) ? options.timeout : 0;\n\n  xhr.open(method, urlParts(url).href, true);\n\n  if (options.headers) {\n    setHeaders(xhr, options.headers);\n  }\n\n  if (options.withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.onload = function () {\n    var statusText, response, status;\n\n    /**\n     * The only way to do a secure request on IE8 and IE9 is with the XDomainRequest object. Unfortunately, microsoft is\n     * so nice that decided that the status property and the 'getAllResponseHeaders' method where not needed so we have to\n     * fake them. If the request gets done with an XDomainRequest instance, we will assume that there are no headers and\n     * the status will always be 200. If you don't like it, DO NOT USE ANCIENT BROWSERS!!!\n     *\n     * For mor info go to: https://msdn.microsoft.com/en-us/library/cc288060(v=vs.85).aspx\n     */\n    if (!xhr.getAllResponseHeaders) {\n      xhr.getAllResponseHeaders = function () {\n        return null;\n      };\n    }\n\n    if (!xhr.status) {\n      xhr.status = 200;\n    }\n\n    if (isDefined(timeoutId)) {\n      clearTimeout(timeoutId);\n      timeoutId = undefined;\n    }\n\n    statusText = xhr.statusText || '';\n\n    // responseText is the old-school way of retrieving response (supported by IE8 & 9)\n    // response/responseType properties were introduced in XHR Level2 spec (supported by IE10)\n    response = ('response' in xhr) ? xhr.response : xhr.responseText;\n\n    // normalize IE9 bug (http://bugs.jquery.com/ticket/1450)\n    status = xhr.status === 1223 ? 204 : xhr.status;\n\n    callback(\n      status,\n      response,\n      xhr.getAllResponseHeaders(),\n      statusText);\n  };\n\n  xhr.onerror = requestError;\n  xhr.onabort = requestError;\n\n  xhr.send();\n\n  if (timeout > 0) {\n    timeoutId = setTimeout(function () {\n      xhr && xhr.abort();\n    }, timeout);\n  }\n\n  function sanityCheck(url, callback, options) {\n    if (!isString(url) || isEmptyString(url)) {\n      throw new HttpRequestError(\"Invalid url '\" + url + \"'\");\n    }\n\n    if (!isFunction(callback)) {\n      throw new HttpRequestError(\"Invalid handler '\" + callback + \"' for the http request\");\n    }\n\n    if (isDefined(options) && !isObject(options)) {\n      throw new HttpRequestError(\"Invalid options map '\" + options + \"'\");\n    }\n  }\n\n  function setHeaders(xhr, headers) {\n    forEach(headers, function (value, key) {\n      if (isDefined(value)) {\n        xhr.setRequestHeader(key, value);\n      }\n    });\n  }\n\n  function requestError() {\n    callback(-1, null, null, '');\n  }\n};\n\nHttpRequest.prototype.get = function (url, callback, options) {\n  this.run('GET', url, processResponse, options);\n\n  function processResponse(status, response, headersString, statusText) {\n    if (isSuccess(status)) {\n      callback(null, response, status, headersString, statusText);\n    } else {\n      callback(new HttpRequestError(statusText), response, status, headersString, statusText);\n    }\n  }\n\n  function isSuccess(status) {\n    return 200 <= status && status < 300;\n  }\n};\n\nfunction createXhr() {\n  var xhr = new XMLHttpRequest();\n  if (!(\"withCredentials\" in xhr)) {\n    // XDomainRequest for IE.\n    xhr = new XDomainRequest();\n  }\n  return xhr;\n}\n\nvar http = new HttpRequest(createXhr);\n\n;\nvar playerUtils = {};\n\n/**\n * Returns an object that captures the portions of player state relevant to\n * video playback. The result of this function can be passed to\n * restorePlayerSnapshot with a player to return the player to the state it\n * was in when this function was invoked.\n * @param {object} player The videojs player object\n */\nplayerUtils.getPlayerSnapshot = function getPlayerSnapshot(player) {\n  var tech = player.el().querySelector('.vjs-tech');\n  var snapshot = {\n    ended: player.ended(),\n    src: player.currentSrc(),\n    currentTime: player.currentTime(),\n    type: player.currentType(),\n    playing: !player.paused(),\n    suppressedTracks: getSuppressedTracks(player)\n  };\n\n  if (tech) {\n    snapshot.nativePoster = tech.poster;\n    snapshot.style = tech.getAttribute('style');\n  }\n\n  return snapshot;\n\n  /**** Local Functions ****/\n  function getSuppressedTracks(player) {\n    var tracks = player.remoteTextTracks ? player.remoteTextTracks() : [];\n\n    if (tracks && isArray(tracks.tracks_)) {\n      tracks = tracks.tracks_;\n    }\n\n    if (!isArray(tracks)) {\n      tracks = [];\n    }\n\n    var suppressedTracks = [];\n    tracks.forEach(function (track) {\n      suppressedTracks.push({\n        track: track,\n        mode: track.mode\n      });\n      track.mode = 'disabled';\n    });\n\n    return suppressedTracks;\n  }\n};\n\n/**\n * Attempts to modify the specified player so that its state is equivalent to\n * the state of the snapshot.\n * @param {object} snapshot - the player state to apply\n */\nplayerUtils.restorePlayerSnapshot = function restorePlayerSnapshot(player, snapshot) {\n  var tech = player.el().querySelector('.vjs-tech');\n  var attempts = 20; // the number of remaining attempts to restore the snapshot\n\n  if (snapshot.nativePoster) {\n    tech.poster = snapshot.nativePoster;\n  }\n\n  if ('style' in snapshot) {\n    // overwrite all css style properties to restore state precisely\n    tech.setAttribute('style', snapshot.style || '');\n  }\n\n  if (hasSrcChanged(player, snapshot)) {\n    // on ios7, fiddling with textTracks too early will cause safari to crash\n    player.one('contentloadedmetadata', restoreTracks);\n\n    player.one('canplay', tryToResume);\n    ensureCanplayEvtGetsFired();\n\n    // if the src changed for ad playback, reset it\n    player.src({src: snapshot.src, type: snapshot.type});\n\n    // safari requires a call to `load` to pick up a changed source\n    player.load();\n\n  } else {\n    restoreTracks();\n\n    if (snapshot.playing) {\n      player.play();\n    }\n  }\n\n  /*** Local Functions ***/\n\n  /**\n   * Sometimes firefox does not trigger the 'canplay' evt.\n   * This code ensure that it always gets triggered triggered.\n   */\n  function ensureCanplayEvtGetsFired() {\n    var timeoutId = setTimeout(function() {\n      player.trigger('canplay');\n    }, 1000);\n\n    player.one('canplay', function(){\n      clearTimeout(timeoutId);\n    });\n  }\n\n  /**\n   * Determine whether the player needs to be restored to its state\n   * before ad playback began. With a custom ad display or burned-in\n   * ads, the content player state hasn't been modified and so no\n   * restoration is required\n   */\n  function hasSrcChanged(player, snapshot) {\n    if (player.src()) {\n      return player.src() !== snapshot.src;\n    }\n    // the player was configured through source element children\n    return player.currentSrc() !== snapshot.src;\n  }\n\n  function restoreTracks() {\n    var suppressedTracks = snapshot.suppressedTracks;\n    suppressedTracks.forEach(function (trackSnapshot) {\n      trackSnapshot.track.mode = trackSnapshot.mode;\n    });\n  }\n\n  /**\n   * Determine if the video element has loaded enough of the snapshot source\n   * to be ready to apply the rest of the state\n   */\n  function tryToResume() {\n    if (playerUtils.isReadyToResume(tech)) {\n      // if some period of the video is seekable, resume playback\n      return resume();\n    }\n\n    // delay a bit and then check again unless we're out of attempts\n    if (attempts--) {\n      setTimeout(tryToResume, 50);\n    } else {\n      (function () {\n        try {\n          resume();\n        } catch (e) {\n          videojs.log.warn('Failed to resume the content after an advertisement', e);\n        }\n      })();\n    }\n\n\n    /*** Local functions ***/\n    function resume() {\n      player.currentTime(snapshot.currentTime);\n\n      if (snapshot.playing) {\n        player.play();\n      }\n    }\n\n  }\n};\n\nplayerUtils.isReadyToResume = function (tech) {\n  if (tech.readyState > 1) {\n    // some browsers and media aren't \"seekable\".\n    // readyState greater than 1 allows for seeking without exceptions\n    return true;\n  }\n\n  if (tech.seekable === undefined) {\n    // if the tech doesn't expose the seekable time ranges, try to\n    // resume playback immediately\n    return true;\n  }\n\n  if (tech.seekable.length > 0) {\n    // if some period of the video is seekable, resume playback\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * This function prepares the player to display ads.\n * Adding convenience events like the 'vast.firsPlay' that gets fired when the video is first played\n * and ads the blackPoster to the player to prevent content from being displayed before the preroll ad.\n *\n * @param player\n */\nplayerUtils.prepareForAds = function (player) {\n  var blackPoster = player.addChild('blackPoster');\n  var _firstPlay = true;\n  var volumeSnapshot;\n\n\n  monkeyPatchPlayerApi();\n\n  player.on('play', tryToTriggerFirstPlay);\n  player.on('vast.reset', resetFirstPlay);//Every time we change the sources we reset the first play.\n  player.on('vast.firstPlay', restoreContentVolume);\n  player.on('error', hideBlackPoster);//If there is an error in the player we remove the blackposter to show the err msg\n  player.on('vast.adStart', hideBlackPoster);\n  player.on('vast.adsCancel', hideBlackPoster);\n  player.on('vast.adError', hideBlackPoster);\n  player.on('vast.adStart', addStyles);\n  player.on('vast.adEnd', removeStyles);\n  player.on('vast.adsCancel', removeStyles);\n\n  /*** Local Functions ***/\n\n  /**\n   What this function does is ugly and horrible and I should think twice before calling myself a good developer. With that said,\n   it is the best solution I could find to mute the video until the 'play' event happens (on mobile devices) and the plugin can decide whether\n   to play the ad or not.\n\n   We also need this monkeypatch to be able to pause and resume an ad using the player's API\n\n   If you have a better solution please do tell me.\n   */\n  function monkeyPatchPlayerApi() {\n\n    /**\n     * Monkey patch needed to handle firstPlay and resume of playing ad.\n     *\n     * @param callOrigPlay necessary flag to prevent infinite loop when you are restoring a VAST ad.\n     * @returns {player}\n     */\n    var origPlay = player.play;\n    player.play = function (callOrigPlay) {\n      if (isFirstPlay()) {\n        firstPlay.call(this);\n      } else {\n        resume.call(this, callOrigPlay);\n      }\n\n      return this;\n\n      /*** local functions ***/\n      function firstPlay() {\n        if (!isIPhone()) {\n          volumeSnapshot = saveVolumeSnapshot();\n          player.muted(true);\n        }\n\n        origPlay.apply(this, arguments);\n      }\n\n      function resume(callOrigPlay) {\n        if (isAdPlaying() && !callOrigPlay) {\n          player.vast.adUnit.resumeAd();\n        } else {\n          origPlay.apply(this, arguments);\n        }\n      }\n    };\n\n\n    /**\n     * Needed monkey patch to handle pause of playing ad.\n     *\n     * @param callOrigPlay necessary flag to prevent infinite loop when you are pausing a VAST ad.\n     * @returns {player}\n     */\n    var origPause = player.pause;\n    player.pause = function (callOrigPause) {\n      if (isAdPlaying() && !callOrigPause) {\n        player.vast.adUnit.pauseAd();\n      } else {\n        origPause.apply(this, arguments);\n      }\n      return this;\n    };\n\n\n    /**\n     * Needed monkey patch to handle paused state of the player when ads are playing.\n     *\n     * @param callOrigPlay necessary flag to prevent infinite loop when you are pausing a VAST ad.\n     * @returns {player}\n     */\n    var origPaused = player.paused;\n    player.paused = function (callOrigPaused) {\n      if (isAdPlaying() && !callOrigPaused) {\n        return player.vast.adUnit.isPaused();\n      }\n      return origPaused.apply(this, arguments);\n    };\n  }\n\n  function isAdPlaying() {\n    return player.vast && player.vast.adUnit;\n  }\n\n  function tryToTriggerFirstPlay() {\n    if (isFirstPlay()) {\n      _firstPlay = false;\n      player.trigger('vast.firstPlay');\n    }\n  }\n\n  function resetFirstPlay() {\n    _firstPlay = true;\n    blackPoster.show();\n    restoreContentVolume();\n  }\n\n  function isFirstPlay() {\n    return _firstPlay;\n  }\n\n  function saveVolumeSnapshot() {\n    return {\n      muted: player.muted(),\n      volume: player.volume()\n    };\n  }\n\n  function restoreContentVolume() {\n    if (volumeSnapshot) {\n      player.currentTime(0);\n      restoreVolumeSnapshot(volumeSnapshot);\n      volumeSnapshot = null;\n    }\n  }\n\n  function restoreVolumeSnapshot(snapshot) {\n    if (isObject(snapshot)) {\n      player.volume(snapshot.volume);\n      player.muted(snapshot.muted);\n    }\n  }\n\n  function hideBlackPoster() {\n    if (!dom.hasClass(blackPoster.el(), 'vjs-hidden')) {\n      blackPoster.hide();\n    }\n  }\n\n  function addStyles() {\n    dom.addClass(player.el(), 'vjs-ad-playing');\n  }\n\n  function removeStyles() {\n    dom.removeClass(player.el(), 'vjs-ad-playing');\n  }\n};\n\n/**\n * Remove the poster attribute from the video element tech, if present. When\n * reusing a video element for multiple videos, the poster image will briefly\n * reappear while the new source loads. Removing the attribute ahead of time\n * prevents the poster from showing up between videos.\n * @param {object} player The videojs player object\n */\nplayerUtils.removeNativePoster = function (player) {\n  var tech = player.el().querySelector('.vjs-tech');\n  if (tech) {\n    tech.removeAttribute('poster');\n  }\n};\n\n/**\n * Helper function to listen to many events until one of them gets fired, then we\n * execute the handler and unsubscribe all the event listeners;\n *\n * @param player specific player from where to listen for the events\n * @param events array of events\n * @param handler function to execute once one of the events fires\n */\nplayerUtils.once = function once(player, events, handler) {\n  function listener() {\n    handler.apply(null, arguments);\n\n    events.forEach(function (event) {\n      player.off(event, listener);\n    });\n  }\n\n  events.forEach(function (event) {\n    player.on(event, listener);\n  });\n};\n\n;\n'use strict';\n\n/**\n * documentMode is an IE-only property\n * http://msdn.microsoft.com/en-us/library/ie/cc196988(v=vs.85).aspx\n */\nvar msie = document.documentMode;\n\n/**\n *\n * IMPORTANT NOTE: This function comes from angularJs and was originally called urlResolve\n *                 you can take a look at the original code here https://github.com/angular/angular.js/blob/master/src/ng/urlUtils.js\n *\n * Implementation Notes for non-IE browsers\n * ----------------------------------------\n * Assigning a URL to the href property of an anchor DOM node, even one attached to the DOM,\n * results both in the normalizing and parsing of the URL.  Normalizing means that a relative\n * URL will be resolved into an absolute URL in the context of the application document.\n * Parsing means that the anchor node's host, hostname, protocol, port, pathname and related\n * properties are all populated to reflect the normalized URL.  This approach has wide\n * compatibility - Safari 1+, Mozilla 1+, Opera 7+,e etc.  See\n * http://www.aptana.com/reference/html/api/HTMLAnchorElement.html\n *\n * Implementation Notes for IE\n * ---------------------------\n * IE >= 8 and <= 10 normalizes the URL when assigned to the anchor node similar to the other\n * browsers.  However, the parsed components will not be set if the URL assigned did not specify\n * them.  (e.g. if you assign a.href = \"foo\", then a.protocol, a.host, etc. will be empty.)  We\n * work around that by performing the parsing in a 2nd step by taking a previously normalized\n * URL (e.g. by assigning to a.href) and assigning it a.href again.  This correctly populates the\n * properties such as protocol, hostname, port, etc.\n *\n * IE7 does not normalize the URL when assigned to an anchor node.  (Apparently, it does, if one\n * uses the inner HTML approach to assign the URL as part of an HTML snippet -\n * http://stackoverflow.com/a/472729)  However, setting img[src] does normalize the URL.\n * Unfortunately, setting img[src] to something like \"javascript:foo\" on IE throws an exception.\n * Since the primary usage for normalizing URLs is to sanitize such URLs, we can't use that\n * method and IE < 8 is unsupported.\n *\n * References:\n *   http://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement\n *   http://www.aptana.com/reference/html/api/HTMLAnchorElement.html\n *   http://url.spec.whatwg.org/#urlutils\n *   https://github.com/angular/angular.js/pull/2902\n *   http://james.padolsey.com/javascript/parsing-urls-with-the-dom/\n *\n * @kind function\n * @param {string} url The URL to be parsed.\n * @description Normalizes and parses a URL.\n * @returns {object} Returns the normalized URL as a dictionary.\n *\n *   | member name   | Description    |\n *   |---------------|----------------|\n *   | href          | A normalized version of the provided URL if it was not an absolute URL |\n *   | protocol      | The protocol including the trailing colon                              |\n *   | host          | The host and port (if the port is non-default) of the normalizedUrl    |\n *   | search        | The search params, minus the question mark                             |\n *   | hash          | The hash string, minus the hash symbol\n *   | hostname      | The hostname\n *   | port          | The port, without \":\"\n *   | pathname      | The pathname, beginning with \"/\"\n *\n */\n\nvar urlParsingNode = document.createElement(\"a\");\n\nfunction urlParts(url) {\n  var href = url;\n\n  if (msie) {\n    // Normalize before parse.  Refer Implementation Notes on why this is\n    // done in two steps on IE.\n    urlParsingNode.setAttribute(\"href\", href);\n    href = urlParsingNode.href;\n  }\n\n  urlParsingNode.setAttribute('href', href);\n\n  // urlParsingNode provides the UrlUtils interface - http://url.spec.whatwg.org/#urlutils\n  return {\n    href: urlParsingNode.href,\n    protocol: urlParsingNode.protocol ? urlParsingNode.protocol.replace(/:$/, '') : '',\n    host: urlParsingNode.host,\n    search: urlParsingNode.search ? urlParsingNode.search.replace(/^\\?/, '') : '',\n    hash: urlParsingNode.hash ? urlParsingNode.hash.replace(/^#/, '') : '',\n    hostname: urlParsingNode.hostname,\n    port: isNotEmptyString(urlParsingNode.port)? urlParsingNode.port: 80,\n    pathname: (urlParsingNode.pathname.charAt(0) === '/')\n      ? urlParsingNode.pathname\n      : '/' + urlParsingNode.pathname\n  };\n}\n\n\n/**\n * This function accepts a query string (search part of a url) and returns a dictionary with\n * the different key value pairs\n * @param {string} qs queryString\n */\nfunction queryStringToObj(qs, cond) {\n  var pairs, qsObj;\n\n  cond = isFunction(cond)? cond : function() {\n    return true;\n  };\n\n  qs = qs.trim().replace(/^\\?/, '');\n  pairs = qs.split('&');\n  qsObj = {};\n\n  forEach(pairs, function (pair) {\n    var keyValue, key, value;\n    if (pair !== '') {\n      keyValue = pair.split('=');\n      key = keyValue[0];\n      value = keyValue[1];\n      if(cond(key, value)){\n        qsObj[key] = value;\n      }\n    }\n  });\n\n  return qsObj;\n}\n\n/**\n * This function accepts an object and serializes it into a query string without the leading '?'\n * @param obj\n * @returns {string}\n */\nfunction objToQueryString(obj) {\n  var pairs = [];\n  forEach(obj, function (value, key) {\n    pairs.push(key + '=' + value);\n  });\n  return pairs.join('&');\n}\n\n\n;\nvar xml = {};\n\nxml.strToXMLDoc = function strToXMLDoc(stringContainingXMLSource){\n  //IE 8\n  if(typeof window.DOMParser === 'undefined'){\n    var xmlDocument = new ActiveXObject('Microsoft.XMLDOM');\n    xmlDocument.async = false;\n    xmlDocument.loadXML(stringContainingXMLSource);\n    return xmlDocument;\n  }\n\n  return parseString(stringContainingXMLSource);\n\n  function parseString(stringContainingXMLSource){\n    var parser = new DOMParser();\n    var parsedDocument;\n\n    //Note: This try catch is to deal with the fact that on IE parser.parseFromString does throw an error but the rest of the browsers don't.\n    try {\n      parsedDocument = parser.parseFromString(stringContainingXMLSource, \"application/xml\");\n\n      if(isParseError(parsedDocument) || isEmptyString(stringContainingXMLSource)){\n        throw new Error();\n      }\n    }catch(e){\n      throw new Error(\"xml.strToXMLDOC: Error parsing the string: '\" + stringContainingXMLSource + \"'\");\n    }\n\n    return parsedDocument;\n  }\n\n  function isParseError(parsedDocument) {\n    try { // parser and parsererrorNS could be cached on startup for efficiency\n      var parser = new DOMParser(),\n        errorneousParse = parser.parseFromString('INVALID', 'text/xml'),\n        parsererrorNS = errorneousParse.getElementsByTagName(\"parsererror\")[0].namespaceURI;\n\n      if (parsererrorNS === 'http://www.w3.org/1999/xhtml') {\n        // In PhantomJS the parseerror element doesn't seem to have a special namespace, so we are just guessing here :(\n        return parsedDocument.getElementsByTagName(\"parsererror\").length > 0;\n      }\n\n      return parsedDocument.getElementsByTagNameNS(parsererrorNS, 'parsererror').length > 0;\n    } catch (e) {\n      //Note on IE parseString throws an error by itself and it will never reach this code. Because it will have failed before\n    }\n  }\n};\n\nxml.parseText = function parseText (sValue) {\n  if (/^\\s*$/.test(sValue)) { return null; }\n  if (/^(?:true|false)$/i.test(sValue)) { return sValue.toLowerCase() === \"true\"; }\n  if (isFinite(sValue)) { return parseFloat(sValue); }\n  if (isISO8601(sValue)) { return new Date(sValue); }\n  return sValue.trim();\n};\n\nxml.JXONTree = function JXONTree (oXMLParent) {\n  var parseText = xml.parseText;\n\n  //The document object is an especial object that it may miss some functions or attrs depending on the browser.\n  //To prevent this problem with create the JXONTree using the root childNode which is a fully fleshed node on all supported\n  //browsers.\n  if(oXMLParent.documentElement){\n    return new xml.JXONTree(oXMLParent.documentElement);\n  }\n\n  if (oXMLParent.hasChildNodes()) {\n    var sCollectedTxt = \"\";\n    for (var oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {\n      oNode = oXMLParent.childNodes.item(nItem);\n      /*jshint bitwise: false*/\n      if ((oNode.nodeType - 1 | 1) === 3) { sCollectedTxt += oNode.nodeType === 3 ? oNode.nodeValue.trim() : oNode.nodeValue; }\n      else if (oNode.nodeType === 1 && !oNode.prefix) {\n        sProp = decapitalize(oNode.nodeName);\n        vContent = new xml.JXONTree(oNode);\n        if (this.hasOwnProperty(sProp)) {\n          if (this[sProp].constructor !== Array) { this[sProp] = [this[sProp]]; }\n          this[sProp].push(vContent);\n        } else { this[sProp] = vContent; }\n      }\n    }\n    if (sCollectedTxt) { this.keyValue = parseText(sCollectedTxt); }\n  }\n\n  //IE8 Stupid fix\n  var hasAttr = typeof oXMLParent.hasAttributes === 'undefined'? oXMLParent.attributes.length > 0: oXMLParent.hasAttributes();\n  if (hasAttr) {\n    var oAttrib;\n    for (var nAttrib = 0; nAttrib < oXMLParent.attributes.length; nAttrib++) {\n      oAttrib = oXMLParent.attributes.item(nAttrib);\n      this[\"@\" + decapitalize(oAttrib.name)] = parseText(oAttrib.value.trim());\n    }\n  }\n};\n\nxml.JXONTree.prototype.attr = function(attr) {\n  return this['@' + decapitalize(attr)];\n};\n\nxml.toJXONTree = function toJXONTree(xmlString){\n  var xmlDoc = xml.strToXMLDoc(xmlString);\n  return new xml.JXONTree(xmlDoc);\n};\n\n/**\n * Helper function to extract the keyvalue of a JXONTree obj\n *\n * @param xmlObj {JXONTree}\n * return the key value or undefined;\n */\nxml.keyValue = function getKeyValue(xmlObj) {\n  if(xmlObj){\n    return xmlObj.keyValue;\n  }\n  return undefined;\n};\n\nxml.attr = function getAttrValue(xmlObj, attr) {\n  if(xmlObj) {\n    return xmlObj['@' + decapitalize(attr)];\n  }\n  return undefined;\n};\n\nxml.encode = function encodeXML(str) {\n  return str.replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&apos;');\n};\n\nxml.decode = function decodeXML(str) {\n  return str.replace(/&apos;/g, \"'\")\n    .replace(/&quot;/g, '\"')\n    .replace(/&gt;/g, '>')\n    .replace(/&lt;/g, '<')\n    .replace(/&amp;/g, '&');\n};\n;\nvideojs.plugin('vastClient', function VASTPlugin(options) {\n  var snapshot;\n  var player = this;\n  var vast = new VASTClient();\n  var adsCanceled = false;\n  var defaultOpts = {\n    // maximum amount of time in ms to wait to receive `adsready` from the ad\n    // implementation after play has been requested. Ad implementations are\n    // expected to load any dynamic libraries and make any requests to determine\n    // ad policies for a video during this time.\n    timeout: 500,\n\n    //TODO:finish this IOS FIX\n    //Whenever you play an add on IOS, the native player kicks in and we loose control of it. On very heavy pages the 'play' event\n    // May occur after the video content has already started. This is wrong if you want to play a preroll ad that needs to happen before the user\n    // starts watching the content. To prevent this usec\n    iosPrerollCancelTimeout: 2000,\n\n    // maximun amount of time for the ad to actually start playing. If this timeout gets\n    // triggered the ads will be cancelled\n    adCancelTimeout: 3000,\n\n    // Boolean flag that configures the player to play a new ad before the user sees the video again\n    // the current video\n    playAdAlways: false,\n\n    // Flag to enable or disable the ads by default.\n    adsEnabled: true,\n\n    // Boolean flag to enable or disable the resize with window.resize or orientationchange\n    autoResize: true,\n\n    // Path to the VPAID flash ad's loader\n    vpaidFlashLoaderPath: '/VPAIDFlash.swf'\n  };\n\n  var settings = extend({}, defaultOpts, options || {});\n\n  if(isUndefined(settings.adTagUrl) && isDefined(settings.url)){\n    settings.adTagUrl = settings.url;\n  }\n\n  if (isString(settings.adTagUrl)) {\n    settings.adTagUrl = echoFn(settings.adTagUrl);\n  }\n\n  if (isDefined(settings.adTagXML) && !isFunction(settings.adTagXML)) {\n    return trackAdError(new VASTError('on VideoJS VAST plugin, the passed adTagXML option does not contain a function'));\n  }\n\n  if (!isDefined(settings.adTagUrl) && !isFunction(settings.adTagXML)) {\n    return trackAdError(new VASTError('on VideoJS VAST plugin, missing adTagUrl on options object'));\n  }\n\n  playerUtils.prepareForAds(player);\n\n  if (settings.playAdAlways) {\n    // No matter what happens we play a new ad before the user sees the video again.\n    player.on('vast.contentEnd', function () {\n      setTimeout(function () {\n        player.trigger('vast.reset');\n      }, 0);\n    });\n  }\n\n  player.on('vast.firstPlay', tryToPlayPrerollAd);\n\n  player.on('vast.reset', function () {\n    //If we are reseting the plugin, we don't want to restore the content\n    snapshot = null;\n    cancelAds();\n  });\n\n  player.vast = {\n    isEnabled: function () {\n      return settings.adsEnabled;\n    },\n\n    enable: function () {\n      settings.adsEnabled = true;\n    },\n\n    disable: function () {\n      settings.adsEnabled = false;\n    }\n  };\n\n  return player.vast;\n\n  /**** Local functions ****/\n  function tryToPlayPrerollAd() {\n    //We remove the poster to prevent flickering whenever the content starts playing\n    playerUtils.removeNativePoster(player);\n\n    playerUtils.once(player, ['vast.adsCancel', 'vast.adEnd'], function () {\n      removeAdUnit();\n      restoreVideoContent();\n    });\n\n    async.waterfall([\n      checkAdsEnabled,\n      preparePlayerForAd,\n      playPrerollAd\n    ], function (error, response) {\n      if (error) {\n        trackAdError(error, response);\n      } else {\n        player.trigger('vast.adEnd');\n      }\n    });\n\n    /*** Local functions ***/\n\n    function removeAdUnit() {\n      if (player.vast && player.vast.adUnit) {\n        player.vast.adUnit = null; //We remove the adUnit\n      }\n    }\n\n    function restoreVideoContent() {\n      setupContentEvents();\n      if (snapshot) {\n        playerUtils.restorePlayerSnapshot(player, snapshot);\n        snapshot = null;\n      }\n    }\n\n    function setupContentEvents() {\n      playerUtils.once(player, ['playing', 'vast.reset', 'vast.firstPlay'], function (evt) {\n        if (evt.type !== 'playing') {\n          return;\n        }\n\n        player.trigger('vast.contentStart');\n\n        playerUtils.once(player, ['ended', 'vast.reset', 'vast.firstPlay'], function (evt) {\n          if (evt.type === 'ended') {\n            player.trigger('vast.contentEnd');\n          }\n        });\n      });\n    }\n\n    function checkAdsEnabled(next) {\n      if (settings.adsEnabled) {\n        return next(null);\n      }\n      next(new VASTError('Ads are not enabled'));\n    }\n\n    function preparePlayerForAd(next) {\n      if (canPlayPrerollAd()) {\n        snapshot = playerUtils.getPlayerSnapshot(player);\n        player.pause();\n        addSpinnerIcon();\n        startAdCancelTimeout();\n        next(null);\n      } else {\n        next(new VASTError('video content has been playing before preroll ad'));\n      }\n    }\n\n    function canPlayPrerollAd() {\n      return !isIPhone() || player.currentTime() <= settings.iosPrerollCancelTimeout;\n    }\n\n    function startAdCancelTimeout() {\n      var adCancelTimeoutId;\n      adsCanceled = false;\n\n      adCancelTimeoutId = setTimeout(function () {\n        trackAdError(new VASTError('timeout while waiting for the video to start playing', 402));\n      }, settings.adCancelTimeout);\n\n      playerUtils.once(player, ['vast.adStart', 'vast.adsCancel'], clearAdCancelTimeout);\n\n      /*** local functions ***/\n      function clearAdCancelTimeout() {\n        if (adCancelTimeoutId) {\n          clearTimeout(adCancelTimeoutId);\n          adCancelTimeoutId = null;\n        }\n      }\n    }\n\n    function addSpinnerIcon() {\n      dom.addClass(player.el(), 'vjs-vast-ad-loading');\n      playerUtils.once(player, ['vast.adStart', 'vast.adsCancel'], removeSpinnerIcon);\n    }\n\n    function removeSpinnerIcon() {\n      //IMPORTANT NOTE: We remove the spinnerIcon asynchronously to give time to the browser to start the video.\n      // If we remove it synchronously we see a flash of the content video before the ad starts playing.\n      setTimeout(function () {\n        dom.removeClass(player.el(), 'vjs-vast-ad-loading');\n      }, 100);\n    }\n\n  }\n\n  function cancelAds() {\n    player.trigger('vast.adsCancel');\n    adsCanceled = true;\n  }\n\n  function playPrerollAd(callback) {\n    async.waterfall([\n      getVastResponse,\n      playAd\n    ], callback);\n  }\n\n  function getVastResponse(callback) {\n    vast.getVASTResponse(settings.adTagUrl ? settings.adTagUrl() : settings.adTagXML, callback);\n  }\n\n  function playAd(vastResponse, callback) {\n    //TODO: Find a better way to stop the play. The 'playPrerollWaterfall' ends in an inconsistent situation\n    //If the state is not 'preroll?' it means the ads were canceled therefore, we break the waterfall\n    if (adsCanceled) {\n      return;\n    }\n\n    var adIntegrator = isVPAID(vastResponse) ? new VPAIDIntegrator(player, settings) : new VASTIntegrator(player);\n    var adFinished = false;\n\n    playerUtils.once(player, ['vast.adStart', 'vast.adsCancel'], function (evt) {\n      if (evt.type === 'vast.adStart') {\n        addAdsLabel();\n      }\n    });\n\n    playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeAdsLabel);\n\n    if (isIDevice()) {\n      preventManualProgress();\n    }\n\n    player.vast.adUnit = adIntegrator.playAd(vastResponse, callback);\n\n    /*** Local functions ****/\n    function addAdsLabel() {\n      if (adFinished || player.controlBar.getChild('AdsLabel')) {\n        return;\n      }\n      player.controlBar.addChild('AdsLabel');\n    }\n\n    function removeAdsLabel() {\n      player.controlBar.removeChild('AdsLabel');\n      adFinished = true;\n    }\n\n    function preventManualProgress() {\n      //IOS video clock is very unreliable and we need a 3 seconds threshold to ensure that the user forwarded/rewound the ad\n      var PROGRESS_THRESHOLD = 3;\n      var previousTime = 0;\n      var tech = player.el().querySelector('.vjs-tech');\n      var skipad_attempts = 0;\n\n      player.on('timeupdate', adTimeupdateHandler);\n      playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel', 'vast.adError'], stopPreventManualProgress);\n\n      /*** Local functions ***/\n      function adTimeupdateHandler() {\n        var currentTime = player.currentTime();\n        var progressDelta = Math.abs(currentTime - previousTime);\n\n        if (progressDelta > PROGRESS_THRESHOLD) {\n          skipad_attempts += 1;\n          if (skipad_attempts >= 2) {\n            player.pause();\n          }\n          player.currentTime(previousTime);\n        } else {\n          previousTime = currentTime;\n        }\n      }\n\n      function stopPreventManualProgress() {\n        player.off('timeupdate', adTimeupdateHandler);\n      }\n    }\n  }\n\n  function trackAdError(error, vastResponse) {\n    player.trigger({type: 'vast.adError', error: error});\n    cancelAds();\n    if (console && console.log) {\n      console.log('AD ERROR:', error.message, error, vastResponse);\n    }\n  }\n\n  function isVPAID(vastResponse) {\n    var i, len;\n    var mediaFiles = vastResponse.mediaFiles;\n    for (i = 0, len = mediaFiles.length; i < len; i++) {\n      if (vastUtil.isVPAID(mediaFiles[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n});\n\n;\nvar vjsComponent = videojs.getComponent('Component');\nvar AdsLabel = videojs.extend(vjsComponent, {\n  /** @constructor */\n  constructor: function (player, options) {\n    vjsComponent.call(this, player, options);\n\n    var that = this;\n\n    // We asynchronously reposition the ads label element\n    setTimeout(function () {\n      var currentTimeComp = player.controlBar &&( player.controlBar.getChild(\"timerControls\") || player.controlBar.getChild(\"currentTimeDisplay\") );\n      if(currentTimeComp) {\n        player.controlBar.el().insertBefore(that.el(), currentTimeComp.el());\n      }\n      dom.removeClass(that.el(), 'vjs-label-hidden');\n    }, 0);\n  }\n});\n\nAdsLabel.prototype.createEl = function(){\n  return vjsComponent.prototype.createEl.call(this, 'div', {\n    className: 'vjs-ads-label vjs-control vjs-label-hidden',\n    innerHTML: 'Advertisement'\n  });\n};\n\nvideojs.registerComponent('AdsLabel', AdsLabel);\n\n;\nvar vjsComponent = videojs.getComponent('Component');\n/**\n * The component that shows a black screen until the ads plugin has decided if it can or it can not play the ad.\n *\n * Note: In case you wonder why instead of this black poster we don't just show the spinner loader.\n *       IOS devices do not work well with animations and the browser chrashes from time to time That is why we chose to\n *       have a secondary black poster.\n *\n *       It also makes it much more easier for the users of the plugin since it does not change the default behaviour of the\n *       spinner and the player works the same way with and without the plugin.\n *\n * @param {vjs.Player|Object} player\n * @param {Object=} options\n * @constructor\n */\nvar BlackPoster = videojs.extend(vjsComponent, {\n  /** @constructor */\n  constructor: function(player, options){\n    vjsComponent.call(this, player, options);\n\n    var posterImg = player.getChild('posterImage');\n\n    //We need to do it asynchronously to be sure that the black poster el is on the dom.\n    setTimeout(function() {\n      if(posterImg) {\n        player.el().insertBefore(this.el(), posterImg.el());\n      }\n    }.bind(this), 0);\n  }\n});\n\n/**\n * Create the black poster div element\n * @return {Element}\n */\nBlackPoster.prototype.createEl = function(){\n  return vjsComponent.prototype.createEl.call(this, 'div', {\n    className: 'vjs-black-poster'\n  });\n};\n\nvideojs.registerComponent('BlackPoster', BlackPoster);\n;\nfunction VPAIDAdUnitWrapper(vpaidAdUnit, opts) {\n  if (!(this instanceof VPAIDAdUnitWrapper)) {\n    return new VPAIDAdUnitWrapper(vpaidAdUnit, opts);\n  }\n  sanityCheck(vpaidAdUnit, opts);\n\n  this.options = extend({}, opts);\n\n  this._adUnit = vpaidAdUnit;\n\n  /*** Local Functions ***/\n  function sanityCheck(adUnit, opts) {\n    if (!adUnit || !VPAIDAdUnitWrapper.checkVPAIDInterface(adUnit)) {\n      throw new VASTError('on VPAIDAdUnitWrapper, the passed VPAID adUnit does not fully implement the VPAID interface');\n    }\n\n    if (!isObject(opts)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper, expected options hash  but got '\" + opts + \"'\");\n    }\n\n    if (!(\"responseTimeout\" in opts) || !isNumber(opts.responseTimeout) ){\n      throw new VASTError(\"on VPAIDAdUnitWrapper, expected responseTimeout in options\");\n    }\n  }\n}\n\nVPAIDAdUnitWrapper.checkVPAIDInterface = function checkVPAIDInterface(VPAIDAdUnit) {\n  //NOTE: skipAd is not part of the method list because it only appears in VPAID 2.0 and we support VPAID 1.0\n  var VPAIDInterfaceMethods = [\n    'handshakeVersion', 'initAd', 'startAd', 'stopAd', 'resizeAd', 'pauseAd', 'expandAd', 'collapseAd'\n  ];\n\n  for (var i = 0, len = VPAIDInterfaceMethods.length; i < len; i++) {\n    if (!VPAIDAdUnit || !isFunction(VPAIDAdUnit[VPAIDInterfaceMethods[i]])) {\n      return false;\n    }\n  }\n\n\n  return canSubscribeToEvents(VPAIDAdUnit) && canUnsubscribeFromEvents(VPAIDAdUnit);\n\n  /*** Local Functions ***/\n\n  function canSubscribeToEvents(adUnit) {\n    return isFunction(adUnit.subscribe) || isFunction(adUnit.addEventListener) || isFunction(adUnit.on);\n  }\n\n  function canUnsubscribeFromEvents(adUnit) {\n    return isFunction(adUnit.unsubscribe) || isFunction(adUnit.removeEventListener) || isFunction(adUnit.off);\n\n  }\n};\n\nVPAIDAdUnitWrapper.prototype.adUnitAsyncCall = function () {\n  var args = arrayLikeObjToArray(arguments);\n  var method = args.shift();\n  var cb = args.pop();\n  var timeoutId;\n\n  sanityCheck(method, cb, this._adUnit);\n  args.push(wrapCallback());\n\n  this._adUnit[method].apply(this._adUnit, args);\n  timeoutId = setTimeout(function () {\n    timeoutId = null;\n    cb(new VASTError(\"on VPAIDAdUnitWrapper, timeout while waiting for a response on call '\" + method + \"'\"));\n    cb = noop;\n  }, this.options.responseTimeout);\n\n  /*** Local functions ***/\n  function sanityCheck(method, cb, adUnit) {\n    if (!isString(method) || !isFunction(adUnit[method])) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.adUnitAsyncCall, invalid method name\");\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.adUnitAsyncCall, missing callback\");\n    }\n  }\n\n  function wrapCallback() {\n    return function () {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      cb.apply(this, arguments);\n    };\n  }\n};\n\nVPAIDAdUnitWrapper.prototype.on = function (evtName, handler) {\n  var addEventListener = this._adUnit.addEventListener || this._adUnit.subscribe || this._adUnit.on;\n  addEventListener.call(this._adUnit, evtName, handler);\n};\n\nVPAIDAdUnitWrapper.prototype.off = function (evtName, handler) {\n  var removeEventListener = this._adUnit.removeEventListener || this._adUnit.unsubscribe || this._adUnit.off;\n  removeEventListener.call(this._adUnit, evtName, handler);\n};\n\nVPAIDAdUnitWrapper.prototype.waitForEvent = function (evtName, cb, context) {\n  var timeoutId;\n  sanityCheck(evtName, cb);\n  context = context || null;\n\n  this.on(evtName, responseListener);\n\n  timeoutId = setTimeout(function () {\n    cb(new VASTError(\"on VPAIDAdUnitWrapper.waitForEvent, timeout while waiting for event '\" + evtName + \"'\"));\n    timeoutId = null;\n    cb = noop;\n  }, this.options.responseTimeout);\n\n  /*** Local functions ***/\n  function sanityCheck(evtName, cb) {\n    if (!isString(evtName)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.waitForEvent, missing evt name\");\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.waitForEvent, missing callback\");\n    }\n  }\n\n  function responseListener() {\n    var args = arrayLikeObjToArray(arguments);\n\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n      timeoutId = null;\n    }\n\n    args.unshift(null);\n    cb.apply(context, args);\n  }\n};\n\n// VPAID METHODS\nVPAIDAdUnitWrapper.prototype.handshakeVersion = function (version, cb) {\n  this.adUnitAsyncCall('handshakeVersion', version, cb);\n};\n\n/* jshint maxparams:6 */\nVPAIDAdUnitWrapper.prototype.initAd = function (width, height, viewMode, desiredBitrate, adUnitData, cb) {\n  this.waitForEvent('AdLoaded', cb);\n  this._adUnit.initAd(width, height, viewMode, desiredBitrate, adUnitData);\n};\n\nVPAIDAdUnitWrapper.prototype.resizeAd = function (width, height, viewMode, cb) {\n  // NOTE: AdSizeChange event is only supported on VPAID 2.0 so for the moment we are not going to use it\n  // and will assume that everything is fine after the async call\n  this.adUnitAsyncCall('resizeAd', width, height, viewMode, cb);\n};\n\nVPAIDAdUnitWrapper.prototype.startAd = function (cb) {\n  this.waitForEvent('AdStarted', cb);\n  this._adUnit.startAd();\n};\n\nVPAIDAdUnitWrapper.prototype.stopAd = function (cb) {\n  this.waitForEvent('AdStopped', cb);\n  this._adUnit.stopAd();\n};\n\nVPAIDAdUnitWrapper.prototype.pauseAd = function (cb) {\n  this.waitForEvent('AdPaused', cb);\n  this._adUnit.pauseAd();\n};\n\nVPAIDAdUnitWrapper.prototype.resumeAd = function (cb) {\n  this.waitForEvent('AdPlaying', cb);\n  this._adUnit.resumeAd();\n};\n\nVPAIDAdUnitWrapper.prototype.expandAd = function (cb) {\n  this.waitForEvent('AdExpandedChange', cb);\n  this._adUnit.expandAd();\n};\n\nVPAIDAdUnitWrapper.prototype.collapseAd = function (cb) {\n  this.waitForEvent('AdExpandedChange', cb);\n  this._adUnit.collapseAd();\n};\n\nVPAIDAdUnitWrapper.prototype.skipAd = function (cb) {\n  this.waitForEvent('AdSkipped', cb);\n  this._adUnit.skipAd();\n};\n\n//VPAID property getters\n[\n  'adLinear',\n  'adWidth',\n  'adHeight',\n  'adExpanded',\n  'adSkippableState',\n  'adRemainingTime',\n  'adDuration',\n  'adVolume',\n  'adCompanions',\n  'adIcons'\n].forEach(function (property) {\n  var getterName = 'get' + capitalize(property);\n\n  VPAIDAdUnitWrapper.prototype[getterName] = function (cb) {\n    this.adUnitAsyncCall(getterName, cb);\n  };\n});\n\n//VPAID property setters\nVPAIDAdUnitWrapper.prototype.setAdVolume = function(volume, cb){\n  this.adUnitAsyncCall('setAdVolume',volume, cb);\n};\n\n;\nfunction VPAIDFlashTech(mediaFile, settings) {\n  if (!(this instanceof VPAIDFlashTech)) {\n    return new VPAIDFlashTech(mediaFile);\n  }\n  sanityCheck(mediaFile);\n  this.name = 'vpaid-flash';\n  this.mediaFile = mediaFile;\n  this.containerEl = null;\n  this.vpaidFlashClient = null;\n  this.settings = settings;\n\n  /*** local functions ***/\n  function sanityCheck(mediaFile) {\n    if (!mediaFile || !isString(mediaFile.src)) {\n      throw new VASTError('on VPAIDFlashTech, invalid MediaFile');\n    }\n  }\n}\n\nVPAIDFlashTech.supports = function (type) {\n  return type === 'application/x-shockwave-flash' && VPAIDFLASHClient.isSupported();\n};\n\nVPAIDFlashTech.prototype.loadAdUnit = function loadFlashCreative(containerEl, objectEl, callback) {\n  var that = this;\n  var flashClientOpts = this.settings && this.settings.vpaidFlashLoaderPath ? {data: this.settings.vpaidFlashLoaderPath} : undefined;\n  sanityCheck(containerEl, callback);\n\n  this.containerEl = containerEl;\n  this.vpaidFlashClient = new VPAIDFLASHClient(containerEl, function (error) {\n    if (error) {\n      return callback(error);\n    }\n\n    that.vpaidFlashClient.loadAdUnit(that.mediaFile.src, callback);\n  }, flashClientOpts);\n\n  /*** Local Functions ***/\n  function sanityCheck(container, cb) {\n\n    if (!dom.isDomElement(container)) {\n      throw new VASTError('on VPAIDFlashTech.loadAdUnit, invalid dom container element');\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError('on VPAIDFlashTech.loadAdUnit, missing valid callback');\n    }\n  }\n};\n\nVPAIDFlashTech.prototype.unloadAdUnit = function () {\n  if (this.vpaidFlashClient) {\n    try{\n      this.vpaidFlashClient.destroy();\n    } catch(e){\n      if(console && isFunction(console.log)){\n        console.log('VAST ERROR: trying to unload the VPAID adunit');\n      }\n    }\n    this.vpaidFlashClient = null;\n  }\n\n  if (this.containerEl) {\n    dom.remove(this.containerEl);\n    this.containerEl = null;\n  }\n};\n\n;\nfunction VPAIDHTML5Tech(mediaFile) {\n\n  if(!(this instanceof VPAIDHTML5Tech)) {\n    return new VPAIDHTML5Tech(mediaFile);\n  }\n\n  sanityCheck(mediaFile);\n\n  this.name = 'vpaid-html5';\n  this.containerEl = null;\n  this.videoEl = null;\n  this.vpaidHTMLClient = null;\n\n  this.mediaFile = mediaFile;\n\n  function sanityCheck(mediaFile) {\n      if (!mediaFile || !isString(mediaFile.src)) {\n        throw new VASTError(VPAIDHTML5Tech.INVALID_MEDIA_FILE);\n      }\n  }\n}\n\nVPAIDHTML5Tech.supports = function (type) {\n  return !isOldIE() && type === 'application/javascript';\n};\n\nVPAIDHTML5Tech.prototype.loadAdUnit = function loadAdUnit(containerEl, videoEl, callback) {\n  sanityCheck(containerEl, videoEl, callback);\n\n  this.containerEl = containerEl;\n  this.videoEl = videoEl;\n  this.vpaidHTMLClient = new VPAIDHTML5Client(containerEl, videoEl, {});\n  this.vpaidHTMLClient.loadAdUnit(this.mediaFile.src, callback);\n\n  function sanityCheck(container, video, cb) {\n    if (!dom.isDomElement(container)) {\n      throw new VASTError(VPAIDHTML5Tech.INVALID_DOM_CONTAINER_EL);\n    }\n\n    if (!dom.isDomElement(video) || video.tagName.toLowerCase() !== 'video') {\n      throw new VASTError(VPAIDHTML5Tech.INVALID_DOM_CONTAINER_EL);\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError(VPAIDHTML5Tech.MISSING_CALLBACK);\n    }\n  }\n};\n\nVPAIDHTML5Tech.prototype.unloadAdUnit = function unloadAdUnit() {\n  if (this.vpaidHTMLClient) {\n    try {\n      this.vpaidHTMLClient.destroy();\n    } catch(e) {\n      if (console && isFunction(console.log)) {\n        console.log('VAST ERROR: trying to unload the VPAID adunit');\n      }\n    }\n\n    this.vpaidHTMLClient = null;\n  }\n\n  if (this.containerEl) {\n    dom.remove(this.containerEl);\n    this.containerEl = null;\n  }\n};\n\nvar PREFIX = 'on VPAIDHTML5Tech';\nVPAIDHTML5Tech.INVALID_MEDIA_FILE = PREFIX + ', invalid MediaFile';\nVPAIDHTML5Tech.INVALID_DOM_CONTAINER_EL = PREFIX + ', invalid container HtmlElement';\nVPAIDHTML5Tech.INVALID_DOM_VIDEO_EL = PREFIX + ', invalid HTMLVideoElement';\nVPAIDHTML5Tech.MISSING_CALLBACK = PREFIX + ', missing valid callback';\n\n\n;\nfunction VPAIDIntegrator(player, settings) {\n  if (!(this instanceof VPAIDIntegrator)) {\n    return new VPAIDIntegrator(player);\n  }\n\n  this.VIEW_MODE = {\n    NORMAL: 'normal',\n    FULLSCREEN: \"fullscreen\",\n    THUMBNAIL: \"thumbnail\"\n  };\n  this.player = player;\n  this.containerEl = createVPAIDContainerEl(player);\n  this.options = {\n    responseTimeout: 5000,\n    VPAID_VERSION: '2.0'\n  };\n  this.settings = settings;\n\n  /*** Local functions ***/\n\n  function createVPAIDContainerEl() {\n    var containerEl = document.createElement('div');\n    dom.addClass(containerEl, 'VPAID-container');\n    player.el().insertBefore(containerEl, player.controlBar.el());\n    return containerEl;\n\n  }\n}\n\n//List of supported VPAID technologies\nVPAIDIntegrator.techs = [\n  VPAIDFlashTech,\n  VPAIDHTML5Tech\n];\n\nVPAIDIntegrator.prototype.playAd = function playVPaidAd(vastResponse, callback) {\n  var that = this;\n  var tech;\n  var player = this.player;\n\n  callback = callback || noop;\n  if (!(vastResponse instanceof VASTResponse)) {\n    return callback(new VASTError('on VASTIntegrator.playAd, missing required VASTResponse'));\n  }\n\n  tech = this._findSupportedTech(vastResponse, this.settings);\n  dom.addClass(player.el(), 'vjs-vpaid-ad');\n\n  player.on('vast.adsCancel', triggerVpaidAdEnd);\n  player.one('vpaid.adEnd', function(){\n    player.off('vast.adsCancel', triggerVpaidAdEnd);\n    removeAdUnit();\n  });\n\n  if (tech) {\n    async.waterfall([\n      function (next) {\n        next(null, tech, vastResponse);\n      },\n      this._loadAdUnit.bind(this),\n      this._playAdUnit.bind(this),\n      this._finishPlaying.bind(this)\n\n    ], function (error, adUnit, vastResponse) {\n      if (error) {\n        that._trackError(vastResponse);\n      }\n      player.trigger('vpaid.adEnd');\n      callback(error, vastResponse);\n    });\n\n    this._adUnit = {\n      _paused: true,\n      type: 'VPAID',\n      pauseAd: function() {\n        player.trigger('vpaid.pauseAd');\n        player.pause(true);//we make sure that the video content gets stopped.\n      },\n      resumeAd: function() {\n          player.trigger('vpaid.resumeAd');\n      },\n      isPaused: function() {\n        return this._paused;\n      },\n      getSrc: function() {\n        return tech.mediaFile;\n      }\n    };\n\n    return this._adUnit;\n  }\n\n  callback(new VASTError('on VPAIDIntegrator.playAd, could not find a supported mediaFile'));\n\n  return null;\n  /*** Local functions ***/\n  function triggerVpaidAdEnd(){\n    player.trigger('vpaid.adEnd');\n  }\n\n  function removeAdUnit() {\n    if (tech) {\n      tech.unloadAdUnit();\n    }\n    dom.removeClass(player.el(), 'vjs-vpaid-ad');\n  }\n};\n\nVPAIDIntegrator.prototype._findSupportedTech = function (vastResponse, settings) {\n  if (!(vastResponse instanceof VASTResponse)) {\n    return null;\n  }\n\n  var vpaidMediaFiles = vastResponse.mediaFiles.filter(vastUtil.isVPAID);\n  var i, len, mediaFile, VPAIDTech;\n\n  for (i = 0, len = vpaidMediaFiles.length; i < len; i += 1) {\n    mediaFile = vpaidMediaFiles[i];\n    VPAIDTech = findSupportedTech(mediaFile);\n    if (VPAIDTech) {\n      return new VPAIDTech(mediaFile, settings);\n    }\n  }\n\n  return null;\n\n  /*** Local functions ***/\n  function findSupportedTech(mediafile) {\n    var type = mediafile.type;\n    var i, len, VPAIDTech;\n\n    for (i = 0, len = VPAIDIntegrator.techs.length; i < len; i += 1) {\n      VPAIDTech = VPAIDIntegrator.techs[i];\n      if (VPAIDTech.supports(type)) {\n        return VPAIDTech;\n      }\n    }\n    return null;\n  }\n};\n\nVPAIDIntegrator.prototype._loadAdUnit = function (tech, vastResponse, next) {\n  var player = this.player;\n  var vjsTechEl = player.el().querySelector('.vjs-tech');\n  var responseTimeout = this.settings.responseTimeout || this.options.responseTimeout;\n  tech.loadAdUnit(this.containerEl, vjsTechEl, function (error, adUnit) {\n    if (error) {\n      return next(error, adUnit, vastResponse);\n    }\n\n    try {\n      var WrappedAdUnit = new VPAIDAdUnitWrapper(adUnit, {src: tech.mediaFile.src, responseTimeout: responseTimeout});\n      var techClass = 'vjs-' + tech.name + '-ad';\n      dom.addClass(player.el(), techClass);\n      player.one('vpaid.adEnd', function() {\n        dom.removeClass(player.el(),techClass);\n      });\n      next(null, WrappedAdUnit, vastResponse);\n    } catch (e) {\n      next(e, adUnit, vastResponse);\n    }\n  });\n};\n\nVPAIDIntegrator.prototype._playAdUnit = function (adUnit, vastResponse, callback) {\n  async.waterfall([\n    function (next) {\n      next(null, adUnit, vastResponse);\n    },\n    this._handshake.bind(this),\n    this._initAd.bind(this),\n    this._setupEvents.bind(this),\n    this._addSkipButton.bind(this),\n    this._linkPlayerControls.bind(this),\n    this._startAd.bind(this)\n  ], callback);\n};\n\nVPAIDIntegrator.prototype._handshake = function handshake(adUnit, vastResponse, next) {\n  adUnit.handshakeVersion(this.options.VPAID_VERSION, function (error, version) {\n    if (error) {\n      return next(error, adUnit, vastResponse);\n    }\n\n    if (version && isSupportedVersion(version)) {\n      return next(null, adUnit, vastResponse);\n    }\n\n    return next(new VASTError('on VPAIDIntegrator._handshake, unsupported version \"' + version + '\"'), adUnit, vastResponse);\n  });\n\n  function isSupportedVersion(version) {\n    var majorNum = major(version);\n    return majorNum >= 1 && majorNum <= 2;\n  }\n\n  function major(version) {\n    var parts = version.split('.');\n    return parseInt(parts[0], 10);\n  }\n};\n\nVPAIDIntegrator.prototype._initAd = function (adUnit, vastResponse, next) {\n  var tech = this.player.el().querySelector('.vjs-tech');\n  var dimension = dom.getDimension(tech);\n  adUnit.initAd(dimension.width, dimension.height, this.VIEW_MODE.NORMAL, -1, {AdParameters: vastResponse.adParameters || ''}, function (error) {\n    next(error, adUnit, vastResponse);\n  });\n};\n\nVPAIDIntegrator.prototype._setupEvents = function (adUnit, vastResponse, next) {\n  var adUnitSrc = adUnit.options.src;\n  var tracker = new VASTTracker(adUnitSrc, vastResponse);\n  var player = this.player;\n  var that = this;\n\n  adUnit.on('AdSkipped', function () {\n    player.trigger('vpaid.AdSkipped');\n    tracker.trackSkip();\n  });\n\n  adUnit.on('AdImpression', function () {\n    player.trigger('vpaid.AdImpression');\n    tracker.trackImpressions();\n  });\n\n  adUnit.on('AdStarted', function () {\n    player.trigger('vpaid.AdStarted');\n    tracker.trackCreativeView();\n    notifyPlayToPlayer();\n  });\n\n  adUnit.on('AdVideoStart', function () {\n    player.trigger('vpaid.AdVideoStart');\n    tracker.trackStart();\n    notifyPlayToPlayer();\n  });\n\n  adUnit.on('AdPlaying', function () {\n    player.trigger('vpaid.AdPlaying');\n    tracker.trackResume();\n    notifyPlayToPlayer();\n  });\n\n  adUnit.on('AdPaused', function () {\n    player.trigger('vpaid.AdPaused');\n    tracker.trackPause();\n    notifyPauseToPlayer();\n  });\n\n  function notifyPlayToPlayer(){\n    if(that._adUnit && that._adUnit.isPaused()){\n      that._adUnit._paused = false;\n    }\n    player.trigger('play');\n\n  }\n\n  function notifyPauseToPlayer() {\n    if(that._adUnit){\n      that._adUnit._paused = true;\n    }\n    player.trigger('pause');\n  }\n\n  adUnit.on('AdVideoFirstQuartile', function () {\n    player.trigger('vpaid.AdVideoFirstQuartile');\n    tracker.trackFirstQuartile();\n  });\n\n  adUnit.on('AdVideoMidpoint', function () {\n    player.trigger('vpaid.AdVideoMidpoint');\n    tracker.trackMidpoint();\n  });\n\n  adUnit.on('AdVideoThirdQuartile', function () {\n    player.trigger('vpaid.AdVideoThirdQuartile');\n    tracker.trackThirdQuartile();\n  });\n\n  adUnit.on('AdVideoComplete', function () {\n    player.trigger('vpaid.AdVideoComplete');\n    tracker.trackComplete();\n  });\n\n  adUnit.on('AdClickThru', function (data) {\n    player.trigger('vpaid.AdClickThru');\n    var url = data.url;\n    var playerHandles = data.playerHandles;\n    var clickThruUrl = isNotEmptyString(url) ? url : generateClickThroughURL(vastResponse.clickThrough);\n\n    tracker.trackClick();\n    if (playerHandles && clickThruUrl) {\n      window.open(clickThruUrl, '_blank');\n    }\n\n    function generateClickThroughURL(clickThroughMacro) {\n      var variables = {\n        ASSETURI: adUnit.options.src,\n        CONTENTPLAYHEAD: 0 //In VPAID there is no method to know the current time from the adUnit\n      };\n\n      return clickThroughMacro ? vastUtil.parseURLMacro(clickThroughMacro, variables) : null;\n    }\n  });\n\n  adUnit.on('AdUserAcceptInvitation', function () {\n    player.trigger('vpaid.AdUserAcceptInvitation');\n    tracker.trackAcceptInvitation();\n    tracker.trackAcceptInvitationLinear();\n  });\n\n  adUnit.on('AdUserClose', function () {\n    player.trigger('vpaid.AdUserClose');\n    tracker.trackClose();\n    tracker.trackCloseLinear();\n  });\n\n  adUnit.on('AdUserMinimize', function () {\n    player.trigger('vpaid.AdUserMinimize');\n    tracker.trackCollapse();\n  });\n\n  adUnit.on('AdError', function () {\n    player.trigger('vpaid.AdError');\n    //NOTE: we track errors code 901, as noted in VAST 3.0\n    tracker.trackErrorWithCode(901);\n  });\n\n  adUnit.on('AdVolumeChange', function () {\n    player.trigger('vpaid.AdVolumeChange');\n    var lastVolume = player.volume();\n    adUnit.getAdVolume(function (error, currentVolume) {\n      if (currentVolume === 0 && lastVolume > 0) {\n        tracker.trackMute();\n      }\n\n      if (currentVolume > 0 && lastVolume === 0) {\n        tracker.trackUnmute();\n      }\n\n      player.volume(currentVolume);\n    });\n  });\n\n  var updateViewSize = resizeAd.bind(this, player, adUnit, this.VIEW_MODE);\n  var updateViewSizeThrottled = throttle(updateViewSize, 100);\n  var autoResize = this.settings.autoResize;\n\n  if (autoResize) {\n    dom.addEventListener(window, 'resize', updateViewSizeThrottled);\n    dom.addEventListener(window, 'orientationchange', updateViewSizeThrottled);\n  }\n\n  player.on('vast.resize', updateViewSize);\n  player.on('vpaid.pauseAd', pauseAdUnit);\n  player.on('vpaid.resumeAd', resumeAdUnit);\n\n  player.one('vpaid.adEnd', function () {\n    player.off('vast.resize', updateViewSize);\n    player.off('vpaid.pauseAd', pauseAdUnit);\n    player.off('vpaid.resumeAd', resumeAdUnit);\n\n    if (autoResize) {\n      dom.removeEventListener(window, 'resize', updateViewSizeThrottled);\n      dom.removeEventListener(window, 'orientationchange', updateViewSizeThrottled);\n    }\n  });\n\n  next(null, adUnit, vastResponse);\n\n  /*** Local Functions ***/\n  function pauseAdUnit() {\n    adUnit.pauseAd(noop);\n  }\n\n  function resumeAdUnit() {\n    adUnit.resumeAd(noop);\n  }\n};\n\nVPAIDIntegrator.prototype._addSkipButton = function (adUnit, vastResponse, next) {\n  var skipButton;\n  var player = this.player;\n\n  adUnit.on('AdSkippableStateChange', updateSkipButtonState);\n\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeSkipButton);\n\n  next(null, adUnit, vastResponse);\n\n  /*** Local function ***/\n  function updateSkipButtonState() {\n    player.trigger('vpaid.AdSkippableStateChange');\n    adUnit.getAdSkippableState(function (error, isSkippable) {\n      if (isSkippable) {\n        if (!skipButton) {\n          addSkipButton(player);\n        }\n      } else {\n        removeSkipButton(player);\n      }\n    });\n  }\n\n  function addSkipButton(player) {\n    skipButton = createSkipButton(player);\n    player.el().appendChild(skipButton);\n  }\n\n  function removeSkipButton() {\n    dom.remove(skipButton);\n    skipButton = null;\n  }\n\n  function createSkipButton() {\n    var skipButton = window.document.createElement(\"div\");\n    dom.addClass(skipButton, \"vast-skip-button\");\n    dom.addClass(skipButton, \"enabled\");\n    skipButton.innerHTML = \"Skip ad\";\n\n    skipButton.onclick = function (e) {\n      adUnit.skipAd(noop);//We skip the adUnit\n\n      //We prevent event propagation to avoid problems with the clickThrough and so on\n      if (window.Event.prototype.stopPropagation !== undefined) {\n        e.stopPropagation();\n      } else {\n        return false;\n      }\n    };\n\n    return skipButton;\n  }\n};\n\nVPAIDIntegrator.prototype._linkPlayerControls = function (adUnit, vastResponse, next) {\n  linkVolumeControl(this.player, adUnit);\n  linkFullScreenControl(this.player, adUnit, this.VIEW_MODE);\n\n  next(null, adUnit, vastResponse);\n\n  /*** Local functions ***/\n  function linkVolumeControl(player, adUnit) {\n    player.on('volumechange', updateAdUnitVolume);\n    adUnit.on('AdVolumeChange', updatePlayerVolume);\n\n    player.one('vpaid.adEnd', function () {\n      player.off('volumechange', updateAdUnitVolume);\n    });\n\n\n    /*** local functions ***/\n    function updateAdUnitVolume() {\n      var vol = player.muted() ? 0 : player.volume();\n      adUnit.setAdVolume(vol, logError);\n    }\n\n    function updatePlayerVolume() {\n      player.trigger('vpaid.AdVolumeChange');\n      adUnit.getAdVolume(function (error, vol) {\n        if (error) {\n          logError(error);\n        } else {\n          player.volume(vol);\n        }\n      });\n    }\n  }\n\n  function linkFullScreenControl(player, adUnit, VIEW_MODE) {\n    var updateViewSize = resizeAd.bind(this, player, adUnit, VIEW_MODE);\n\n    player.on('fullscreenchange', updateViewSize);\n\n    player.one('vpaid.adEnd', function () {\n      player.off('fullscreenchange', updateViewSize);\n    });\n  }\n};\n\nVPAIDIntegrator.prototype._startAd = function (adUnit, vastResponse, next) {\n  var player = this.player;\n\n  adUnit.startAd(function (error) {\n    if (!error) {\n      player.trigger('vast.adStart');\n    }\n    next(error, adUnit, vastResponse);\n  });\n};\n\nVPAIDIntegrator.prototype._finishPlaying = function (adUnit, vastResponse, next) {\n  var player = this.player;\n  adUnit.on('AdStopped', function () {\n   player.trigger('vpaid.AdStopped');\n   finishPlayingAd(null);\n  });\n\n  adUnit.on('AdError', function (error) {\n    var errMsg = error? error.message : 'on VPAIDIntegrator, error while waiting for the adUnit to finish playing';\n    finishPlayingAd(new VASTError(errMsg));\n  });\n\n  /*** local functions ***/\n  function finishPlayingAd(error) {\n    next(error, adUnit, vastResponse);\n  }\n};\n\nVPAIDIntegrator.prototype._trackError = function trackError(response) {\n  vastUtil.track(response.errorURLMacros, {ERRORCODE: 901});\n};\n\nfunction resizeAd(player, adUnit, VIEW_MODE) {\n  var tech = player.el().querySelector('.vjs-tech');\n  var dimension = dom.getDimension(tech);\n  var MODE = player.isFullscreen() ? VIEW_MODE.FULLSCREEN : VIEW_MODE.NORMAL;\n  adUnit.resizeAd(dimension.width, dimension.height, MODE, logError);\n}\n\nfunction logError(error) {\n  if (error && console && console.log) {\n    console.log('ERROR: ' + error.message, error);\n  }\n}\n\n;\nfunction Ad(adJTree) {\n  if (!(this instanceof Ad)) {\n    return new Ad(adJTree);\n  }\n\n  this.id = adJTree.attr('id');\n  this.sequence = adJTree.attr('sequence');\n\n  if(adJTree.inLine) {\n    this.inLine = new InLine(adJTree.inLine);\n  }\n\n  if(adJTree.wrapper){\n    this.wrapper = new Wrapper(adJTree.wrapper);\n  }\n}\n;\n\nfunction Creative(creativeJTree) {\n  if(!(this instanceof Creative)) {\n    return new Creative(creativeJTree);\n  }\n\n  this.id = creativeJTree.attr('id');\n  this.sequence = creativeJTree.attr('sequence');\n  this.adId = creativeJTree.attr('adId');\n  this.apiFramework = creativeJTree.attr('apiFramework');\n\n  if(creativeJTree.linear) {\n    this.linear = new Linear(creativeJTree.linear);\n  }\n}\n;\nfunction InLine(inlineJTree) {\n  if (!(this instanceof InLine)) {\n    return new InLine(inlineJTree);\n  }\n\n  //Required Fields\n  this.adTitle = xml.keyValue(inlineJTree.adTitle);\n  this.adSystem = xml.keyValue(inlineJTree.adSystem);\n  this.impressions = vastUtil.parseImpressions(inlineJTree.impression);\n  this.creatives = vastUtil.parseCreatives(inlineJTree.creatives);\n\n  //Optional Fields\n  this.description = xml.keyValue(inlineJTree.description);\n  this.advertiser = xml.keyValue(inlineJTree.advertiser);\n  this.surveys = parseSurveys(inlineJTree.survey);\n  this.error = xml.keyValue(inlineJTree.error);\n  this.pricing = xml.keyValue(inlineJTree.pricing);\n  this.extensions = inlineJTree.extensions;\n\n  /*** Local Functions ***/\n  function parseSurveys(inlineSurveys) {\n    if (inlineSurveys) {\n      return transformArray(isArray(inlineSurveys) ? inlineSurveys : [inlineSurveys], function (survey) {\n        if(isNotEmptyString(survey.keyValue)){\n          return {\n            uri: survey.keyValue,\n            type: survey.attr('type')\n          };\n        }\n\n        return undefined;\n      });\n    }\n    return [];\n  }\n}\n;\nfunction Linear(linearJTree) {\n  if (!(this instanceof Linear)) {\n    return new Linear(linearJTree);\n  }\n\n  //Required Elements\n  this.duration = vastUtil.parseDuration(xml.keyValue(linearJTree.duration));\n  this.mediaFiles = parseMediaFiles(linearJTree.mediaFiles && linearJTree.mediaFiles.mediaFile);\n\n  //Optional fields\n  this.trackingEvents = parseTrackingEvents(linearJTree.trackingEvents && linearJTree.trackingEvents.tracking, this.duration);\n  this.skipoffset = vastUtil.parseOffset(xml.attr(linearJTree, 'skipoffset'), this.duration);\n\n  if (linearJTree.videoClicks) {\n    this.videoClicks = new VideoClicks(linearJTree.videoClicks);\n  }\n  \n  if(linearJTree.adParameters) {\n    this.adParameters = xml.keyValue(linearJTree.adParameters);\n\n    if(xml.attr(linearJTree.adParameters, 'xmlEncoded')){\n      this.adParameters = xml.decode(this.adParameters);\n    }\n  }\n\n  /*** Local functions ***/\n  function parseTrackingEvents(trackingEvents, duration) {\n    var trackings = [];\n    if (isDefined(trackingEvents)) {\n      trackingEvents = isArray(trackingEvents) ? trackingEvents : [trackingEvents];\n      trackingEvents.forEach(function (trackingData) {\n        trackings.push(new TrackingEvent(trackingData, duration));\n      });\n    }\n    return trackings;\n  }\n\n  function parseMediaFiles(mediaFilesJxonTree) {\n    var mediaFiles = [];\n    if (isDefined(mediaFilesJxonTree)) {\n      mediaFilesJxonTree = isArray(mediaFilesJxonTree) ? mediaFilesJxonTree : [mediaFilesJxonTree];\n\n      mediaFilesJxonTree.forEach(function (mfData) {\n        mediaFiles.push(new MediaFile(mfData));\n      });\n    }\n    return mediaFiles;\n  }\n}\n;\nfunction MediaFile(mediaFileJTree) {\n  if (!(this instanceof MediaFile)) {\n    return new MediaFile(mediaFileJTree);\n  }\n\n  //Required attributes\n  this.src = xml.keyValue(mediaFileJTree);\n  this.delivery = mediaFileJTree.attr('delivery');\n  this.type = mediaFileJTree.attr('type');\n  this.width = mediaFileJTree.attr('width');\n  this.height = mediaFileJTree.attr('height');\n\n  //Optional attributes\n  this.codec = mediaFileJTree.attr('codec');\n  this.id = mediaFileJTree.attr('id');\n  this.bitrate = mediaFileJTree.attr('bitrate');\n  this.minBitrate = mediaFileJTree.attr('minBitrate');\n  this.maxBitrate = mediaFileJTree.attr('maxBitrate');\n  this.scalable = mediaFileJTree.attr('scalable');\n  this.maintainAspectRatio = mediaFileJTree.attr('maintainAspectRatio');\n  this.apiFramework = mediaFileJTree.attr('apiFramework');\n}\n;\nfunction TrackingEvent(trackingJTree, duration) {\n  if (!(this instanceof TrackingEvent)) {\n    return new TrackingEvent(trackingJTree, duration);\n  }\n\n  this.name = trackingJTree.attr('event');\n  this.uri = xml.keyValue(trackingJTree);\n\n  if('progress' === this.name) {\n    this.offset = vastUtil.parseOffset(trackingJTree.attr('offset'), duration);\n  }\n}\n\n;\nfunction VASTClient(options) {\n  if (!(this instanceof VASTClient)) {\n    return new VASTClient(options);\n  }\n  var defaultOptions = {\n    WRAPPER_LIMIT: 5\n  };\n\n  options = options || {};\n  this.settings = extend({}, options, defaultOptions);\n  this.errorURLMacros = [];\n}\n\nVASTClient.prototype.getVASTResponse = function getVASTResponse(adTagUrl, callback) {\n  var that = this;\n\n  var error = sanityCheck(adTagUrl, callback);\n  if (error) {\n    if (isFunction(callback)) {\n      return callback(error);\n    }\n    throw error;\n  }\n\n  async.waterfall([\n      this._getVASTAd.bind(this, adTagUrl),\n      buildVASTResponse\n    ],\n    callback);\n\n  /*** Local functions ***/\n  function buildVASTResponse(adsChain, cb) {\n    try {\n      var response = that._buildVASTResponse(adsChain);\n      cb(null, response);\n    } catch (e) {\n      cb(e);\n    }\n  }\n\n  function sanityCheck(adTagUrl, cb) {\n    if (!adTagUrl) {\n      return new VASTError('on VASTClient.getVASTResponse, missing ad tag URL');\n    }\n\n    if (!isFunction(cb)) {\n      return new VASTError('on VASTClient.getVASTResponse, missing callback function');\n    }\n  }\n};\n\nVASTClient.prototype._getVASTAd = function (adTagUrl, callback) {\n  var that = this;\n\n  getAdWaterfall(adTagUrl, function (error, vastTree) {\n    var waterfallAds = vastTree && isArray(vastTree.ads) ? vastTree.ads : null;\n    if (error) {\n      that._trackError(error, waterfallAds);\n      return callback(error, waterfallAds);\n    }\n\n    getAd(waterfallAds.shift(), [], waterfallHandler);\n\n    /*** Local functions ***/\n    function waterfallHandler(error, adChain) {\n      if (error) {\n        that._trackError(error, adChain);\n        if (waterfallAds.length > 0) {\n          getAd(waterfallAds.shift(),[], waterfallHandler);\n        } else {\n          callback(error, adChain);\n        }\n      } else {\n        callback(null, adChain);\n      }\n    }\n  });\n\n  /*** Local functions ***/\n  function getAdWaterfall(adTagUrl, callback) {\n    var requestVastXML = that._requestVASTXml.bind(that, adTagUrl);\n    async.waterfall([\n      requestVastXML,\n      buildVastWaterfall\n    ], callback);\n  }\n\n  function buildVastWaterfall(xmlStr, callback) {\n    var vastTree;\n    try {\n      vastTree = xml.toJXONTree(xmlStr);\n      vastTree.ads = isArray(vastTree.ad) ? vastTree.ad : [vastTree.ad];\n      callback(validateVASTTree(vastTree), vastTree);\n    } catch (e) {\n      callback(new VASTError(\"on VASTClient.getVASTAd.buildVastWaterfall, error parsing xml\", 100), null);\n    }\n  }\n\n  function validateVASTTree(vastTree) {\n    var vastVersion = xml.attr(vastTree, 'version');\n\n    if (!vastTree.ad) {\n      return new VASTError('on VASTClient.getVASTAd.validateVASTTree, no Ad in VAST tree', 303);\n    }\n\n    if (vastVersion && (vastVersion != 3 && vastVersion != 2)) {\n      return new VASTError('on VASTClient.getVASTAd.validateVASTTree, not supported VAST version \"' + vastVersion + '\"', 102);\n    }\n\n    return null;\n  }\n\n  function getAd(adTagUrl, adChain, callback) {\n    if (adChain.length >= that.WRAPPER_LIMIT) {\n      return callback(new VASTError(\"on VASTClient.getVASTAd.getAd, players wrapper limit reached (the limit is \" + that.WRAPPER_LIMIT + \")\", 302), adChain);\n    }\n\n    async.waterfall([\n      function (next) {\n        if (isString(adTagUrl)) {\n          requestVASTAd(adTagUrl, next);\n        } else {\n          next(null, adTagUrl);\n        }\n      },\n      buildAd\n    ], function (error, ad) {\n      if (ad) {\n        adChain.push(ad);\n      }\n\n      if (error) {\n        return callback(error, adChain);\n      }\n\n      if (ad.wrapper) {\n        return getAd(ad.wrapper.VASTAdTagURI, adChain, callback);\n      }\n\n      return callback(null, adChain);\n    });\n  }\n\n  function buildAd(adJxonTree, callback) {\n    try {\n      var ad = new Ad(adJxonTree);\n      callback(validateAd(ad), ad);\n    } catch (e) {\n      callback(new VASTError('on VASTClient.getVASTAd.buildAd, error parsing xml', 100), null);\n    }\n  }\n\n  function validateAd(ad) {\n    var wrapper = ad.wrapper;\n    var inLine = ad.inLine;\n    var errMsgPrefix = 'on VASTClient.getVASTAd.validateAd, ';\n\n    if (inLine && wrapper) {\n      return new VASTError(errMsgPrefix +\"InLine and Wrapper both found on the same Ad\", 101);\n    }\n\n    if (!inLine && !wrapper) {\n      return new VASTError(errMsgPrefix + \"nor wrapper nor inline elements found on the Ad\", 101);\n    }\n\n    if (inLine && inLine.creatives.length === 0) {\n      return new VASTError(errMsgPrefix + \"missing creative in InLine element\", 101);\n    }\n\n    if (wrapper && !wrapper.VASTAdTagURI) {\n      return new VASTError(errMsgPrefix + \"missing 'VASTAdTagURI' in wrapper\", 101);\n    }\n  }\n\n  function requestVASTAd(adTagUrl, callback) {\n    that._requestVASTXml(adTagUrl, function (error, xmlStr) {\n      if (error) {\n        return callback(error);\n      }\n      try {\n        var vastTree = xml.toJXONTree(xmlStr);\n        callback(validateVASTTree(vastTree), vastTree.ad);\n      } catch (e) {\n        callback(new VASTError(\"on VASTClient.getVASTAd.requestVASTAd, error parsing xml\", 100));\n      }\n    });\n  }\n};\n\nVASTClient.prototype._requestVASTXml = function requestVASTXml(adTagUrl, callback) {\n  try {\n    if (isFunction(adTagUrl)) {\n      adTagUrl(requestHandler);\n    } else {\n      http.get(adTagUrl, requestHandler, {\n        withCredentials: true\n      });\n    }\n  } catch (e) {\n    callback(e);\n  }\n\n  /*** Local functions ***/\n  function requestHandler(error, response, status) {\n    if (error) {\n      var errMsg = isDefined(status) ?\n      \"on VASTClient.requestVastXML, HTTP request error with status '\" + status + \"'\" :\n        \"on VASTClient.requestVastXML, Error getting the the VAST XML with he passed adTagXML fn\";\n      return callback(new VASTError(errMsg, 301), null);\n    }\n\n    callback(null, response);\n  }\n};\n\nVASTClient.prototype._buildVASTResponse = function buildVASTResponse(adsChain) {\n  var response = new VASTResponse();\n  addAdsToResponse(response, adsChain);\n  validateResponse(response);\n\n  return response;\n\n  //*** Local function ****\n  function addAdsToResponse(response, ads) {\n    ads.forEach(function (ad) {\n      response.addAd(ad);\n    });\n  }\n\n  function validateResponse(response) {\n    var progressEvents = response.trackingEvents.progress;\n\n    if (!response.hasLinear()) {\n      throw new VASTError(\"on VASTClient._buildVASTResponse, Received an Ad type that is not supported\", 200);\n    }\n\n    if (response.duration === undefined) {\n      throw new VASTError(\"on VASTClient._buildVASTResponse, Missing duration field in VAST response\", 101);\n    }\n\n    if (progressEvents) {\n      progressEvents.forEach(function (progressEvent) {\n        if (!isNumber(progressEvent.offset)) {\n          throw new VASTError(\"on VASTClient._buildVASTResponse, missing or wrong offset attribute on progress tracking event\", 101);\n        }\n      });\n    }\n  }\n};\n\nVASTClient.prototype._trackError = function (error, adChain) {\n  if (!isArray(adChain) || adChain.length === 0) { //There is nothing to track\n    return;\n  }\n\n  var errorURLMacros = [];\n  adChain.forEach(addErrorUrlMacros);\n  vastUtil.track(errorURLMacros, {ERRORCODE: error.code || 900});  //900 <== Undefined error\n\n  /*** Local functions  ***/\n  function addErrorUrlMacros(ad) {\n    if (ad.wrapper && ad.wrapper.error) {\n      errorURLMacros.push(ad.wrapper.error);\n    }\n\n    if (ad.inLine && ad.inLine.error) {\n      errorURLMacros.push(ad.inLine.error);\n    }\n  }\n};\n\n;\nvar VAST = {};\n\nfunction VASTError(message, code) {\n  this.message = 'VAST Error: ' + (message || '');\n  if (code) {\n    this.code = code;\n  }\n}\n\nVASTError.prototype = new Error();\nVASTError.prototype.name = \"VAST Error\";\n;\n/**\n * Inner helper class that deals with the logic of the individual steps needed to setup an ad in the player.\n *\n * @param player {object} instance of the player that will play the ad. It assumes that the videojs-contrib-ads plugin\n *                        has been initialized when you use its utility functions.\n *\n * @constructor\n */\nfunction VASTIntegrator(player) {\n  if (!(this instanceof VASTIntegrator)) {\n    return new VASTIntegrator(player);\n  }\n\n  this.player = player;\n}\n\nVASTIntegrator.prototype.playAd = function playAd(vastResponse, callback) {\n  var that = this;\n  callback = callback || noop;\n\n  if (!(vastResponse instanceof VASTResponse)) {\n    return callback(new VASTError('On VASTIntegrator, missing required VASTResponse'));\n  }\n\n  async.waterfall([\n    function (next) {\n      next(null, vastResponse);\n    },\n    this._selectAdSource.bind(this),\n    this._createVASTTracker.bind(this),\n    this._addClickThrough.bind(this),\n    this._addSkipButton.bind(this),\n    this._setupEvents.bind(this),\n    this._playSelectedAd.bind(this)\n  ], function (error, response) {\n    if (error && response) {\n      that._trackError(error, response);\n    }\n    callback(error, response);\n  });\n\n  this._adUnit = {\n    _src: null,\n    type: 'VAST',\n    pauseAd: function () {\n      that.player.pause(true);\n    },\n\n    resumeAd: function () {\n      that.player.play(true);\n    },\n\n    isPaused: function () {\n      return that.player.paused(true);\n    },\n\n    getSrc: function () {\n      return this._src;\n    }\n  };\n\n  return this._adUnit;\n};\n\nVASTIntegrator.prototype._selectAdSource = function selectAdSource(response, callback) {\n  var source;\n\n  var playerWidth = dom.getDimension(this.player.el()).width;\n  response.mediaFiles.sort(function compareTo(a, b) {\n    var deltaA = Math.abs(playerWidth - a.width);\n    var deltaB = Math.abs(playerWidth - b.width);\n    return deltaA - deltaB;\n  });\n\n  source = this.player.selectSource(response.mediaFiles).source;\n\n  if (source) {\n    if (this._adUnit) {\n      this._adUnit._src = source;\n    }\n    return callback(null, source, response);\n  }\n\n  // code 403 <== Couldn't find MediaFile that is supported by this video player\n  callback(new VASTError(\"Could not find Ad mediafile supported by this player\", 403), response);\n};\n\nVASTIntegrator.prototype._createVASTTracker = function createVASTTracker(adMediaFile, response, callback) {\n  try {\n    callback(null, adMediaFile, new VASTTracker(adMediaFile.src, response), response);\n  } catch (e) {\n    callback(e, response);\n  }\n};\n\nVASTIntegrator.prototype._setupEvents = function setupEvents(adMediaFile, tracker, response, callback) {\n  var previouslyMuted;\n  var player = this.player;\n  player.on('fullscreenchange', trackFullscreenChange);\n  player.on('vast.adStart', trackImpressions);\n  player.on('pause', trackPause);\n  player.on('timeupdate', trackProgress);\n  player.on('volumechange', trackVolumeChange);\n\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], unbindEvents);\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel', 'vast.adSkip'], function(evt){\n    if(evt.type === 'vast.adEnd'){\n      tracker.trackComplete();\n    }\n  });\n\n  return callback(null, adMediaFile, response);\n\n  /*** Local Functions ***/\n  function unbindEvents() {\n    player.off('fullscreenchange', trackFullscreenChange);\n    player.off('vast.adStart', trackImpressions);\n    player.off('pause', trackPause);\n    player.off('timeupdate', trackProgress);\n    player.off('volumechange', trackVolumeChange);\n  }\n\n  function trackFullscreenChange() {\n    if (player.isFullscreen()) {\n      tracker.trackFullscreen();\n    } else {\n      tracker.trackExitFullscreen();\n    }\n  }\n\n  function trackPause() {\n    //NOTE: whenever a video ends the video Element triggers a 'pause' event before the 'ended' event.\n    //      We should not track this pause event because it makes the VAST tracking confusing again we use a\n    //      Threshold of 2 seconds to prevent false positives on IOS.\n    if (Math.abs(player.duration() - player.currentTime()) < 2) {\n      return;\n    }\n\n    tracker.trackPause();\n    playerUtils.once(player, ['play', 'vast.adEnd', 'vast.adsCancel'], function (evt) {\n      if(evt.type === 'play'){\n        tracker.trackResume();\n      }\n    });\n  }\n\n  function trackProgress() {\n    var currentTimeInMs = player.currentTime() * 1000;\n    tracker.trackProgress(currentTimeInMs);\n  }\n\n  function trackImpressions() {\n    tracker.trackImpressions();\n    tracker.trackCreativeView();\n  }\n\n  function trackVolumeChange() {\n    var muted = player.muted();\n    if (muted) {\n      tracker.trackMute();\n    } else if (previouslyMuted) {\n      tracker.trackUnmute();\n    }\n    previouslyMuted = muted;\n  }\n};\n\nVASTIntegrator.prototype._addSkipButton = function addSkipButton(source, tracker, response, callback) {\n  var skipOffsetInSec;\n\n  if (isNumber(response.skipoffset)) {\n    skipOffsetInSec = response.skipoffset / 1000;\n    addSkipButtonToPlayer(this.player, skipOffsetInSec);\n  }\n  callback(null, source, tracker, response);\n\n  /*** Local function ***/\n  function addSkipButtonToPlayer(player, skipOffset) {\n    var skipButton = createSkipButton(player);\n    var updateSkipButton = updateSkipButtonState.bind(this, skipButton, skipOffset, player);\n\n    player.el().appendChild(skipButton);\n    player.on('timeupdate', updateSkipButton);\n\n    playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeSkipButton);\n\n    function removeSkipButton() {\n      player.off('timeupdate', updateSkipButton);\n      dom.remove(skipButton);\n    }\n  }\n\n  function createSkipButton(player) {\n    var skipButton = window.document.createElement(\"div\");\n    dom.addClass(skipButton, \"vast-skip-button\");\n\n    skipButton.onclick = function (e) {\n      if (dom.hasClass(skipButton, 'enabled')) {\n        tracker.trackSkip();\n        player.trigger('vast.adSkip');\n      }\n\n      //We prevent event propagation to avoid problems with the clickThrough and so on\n      if (window.Event.prototype.stopPropagation !== undefined) {\n        e.stopPropagation();\n      } else {\n        return false;\n      }\n    };\n\n    return skipButton;\n  }\n\n  function updateSkipButtonState(skipButton, skipOffset, player) {\n    var timeLeft = Math.ceil(skipOffset - player.currentTime());\n    if (timeLeft > 0) {\n      skipButton.innerHTML = \"Skip in \" + toFixedDigits(timeLeft, 2) + \"...\";\n    } else {\n      if (!dom.hasClass(skipButton, 'enabled')) {\n        dom.addClass(skipButton, 'enabled');\n        skipButton.innerHTML = \"Skip ad\";\n      }\n    }\n  }\n};\n\nVASTIntegrator.prototype._addClickThrough = function addClickThrough(mediaFile, tracker, response, callback) {\n  var player = this.player;\n  var blocker = createClickThroughBlocker(player, tracker, response);\n  var updateBlocker = updateBlockerURL.bind(this, blocker, response, player);\n\n  player.el().insertBefore(blocker, player.controlBar.el());\n  player.on('timeupdate', updateBlocker);\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeBlocker);\n\n  return callback(null, mediaFile, tracker, response);\n\n  /*** Local Functions ***/\n\n  function createClickThroughBlocker(player, tracker, response) {\n    var blocker = window.document.createElement(\"a\");\n    var clickThroughMacro = response.clickThrough;\n\n    dom.addClass(blocker, 'vast-blocker');\n    blocker.href = generateClickThroughURL(clickThroughMacro, player);\n\n    if (isString(clickThroughMacro)) {\n      blocker.target = \"_blank\";\n    }\n\n    blocker.onclick = function (e) {\n      if (player.paused()) {\n        player.play();\n\n        //We prevent event propagation to avoid problems with the player's normal pause mechanism\n        if (window.Event.prototype.stopPropagation !== undefined) {\n          e.stopPropagation();\n        }\n        return false;\n      }\n\n      player.pause();\n      tracker.trackClick();\n    };\n\n    return blocker;\n  }\n\n  function updateBlockerURL(blocker, response, player) {\n    blocker.href = generateClickThroughURL(response.clickThrough, player);\n  }\n\n  function generateClickThroughURL(clickThroughMacro, player) {\n    var variables = {\n      ASSETURI: mediaFile.src,\n      CONTENTPLAYHEAD: vastUtil.formatProgress(player.currentTime() * 1000)\n    };\n\n    return clickThroughMacro ? vastUtil.parseURLMacro(clickThroughMacro, variables) : '#';\n  }\n\n  function removeBlocker() {\n    player.off('timeupdate', updateBlocker);\n    dom.remove(blocker);\n  }\n};\n\nVASTIntegrator.prototype._playSelectedAd = function playSelectedAd(source, response, callback) {\n  var player = this.player;\n\n  player.preload(\"auto\"); //without preload=auto the durationchange event is never fired\n  player.src(source);\n\n  playerUtils.once(player, ['durationchange', 'error', 'vast.adsCancel'], function (evt) {\n    if (evt.type === 'durationchange') {\n      playAd();\n    } else if(evt.type === 'error') {\n      callback(new VASTError(\"on VASTIntegrator, Player is unable to play the Ad\", 400), response);\n    }\n    //NOTE: If the ads get canceled we do nothing/\n  });\n\n  /**** local functions ******/\n  function playAd() {\n    player.play();\n    playerUtils.once(player, ['playing', 'vast.adsCancel'], function (evt) {\n      if(evt.type === 'vast.adsCancel'){\n        return;\n      }\n\n      player.trigger('vast.adStart');\n\n      playerUtils.once(player, ['ended', 'vast.adsCancel', 'vast.adSkip'], function (evt) {\n        if(evt.type === 'ended' || evt.type === 'vast.adSkip'){\n          callback(null, response);\n        }\n        //NOTE: if the ads get cancel we do nothing\n      });\n    });\n  }\n};\n\nVASTIntegrator.prototype._trackError = function trackError(error, response) {\n  vastUtil.track(response.errorURLMacros, {ERRORCODE: error.code || 900});\n};\n\n;\n(function (window) {\n  \"use strict\";\n\n\n  function VASTResponse() {\n    if (!(this instanceof VASTResponse)) {\n      return new VASTResponse();\n    }\n\n    this._linearAdded = false;\n    this.ads = [];\n    this.errorURLMacros = [];\n    this.impressions = [];\n    this.clickTrackings = [];\n    this.customClicks = [];\n    this.trackingEvents = {};\n    this.mediaFiles = [];\n    this.clickThrough = undefined;\n    this.adTitle = '';\n    this.duration = undefined;\n    this.skipoffset = undefined;\n  }\n\n  VASTResponse.prototype.addAd = function (ad) {\n    var inLine, wrapper;\n\n    if (ad instanceof Ad) {\n      inLine = ad.inLine;\n      wrapper = ad.wrapper;\n\n      this.ads.push(ad);\n\n      if (inLine) {\n        this._addInLine(inLine);\n      }\n\n      if (wrapper) {\n        this._addWrapper(wrapper);\n      }\n    }\n  };\n\n  VASTResponse.prototype._addErrorTrackUrl = function (error) {\n    var errorURL = error instanceof xml.JXONTree ? xml.keyValue(error) : error;\n    if (errorURL) {\n      this.errorURLMacros.push(errorURL);\n    }\n  };\n\n  VASTResponse.prototype._addImpressions = function (impressions) {\n    isArray(impressions) && appendToArray(this.impressions, impressions);\n  };\n\n  VASTResponse.prototype._addClickThrough = function (clickThrough) {\n    if (isNotEmptyString(clickThrough)) {\n      this.clickThrough = clickThrough;\n    }\n  };\n\n  VASTResponse.prototype._addClickTrackings = function (clickTrackings) {\n    isArray(clickTrackings) && appendToArray(this.clickTrackings, clickTrackings);\n  };\n\n  VASTResponse.prototype._addCustomClicks = function (customClicks) {\n    isArray(customClicks) && appendToArray(this.customClicks, customClicks);\n  };\n\n  VASTResponse.prototype._addTrackingEvents = function (trackingEvents) {\n    var eventsMap = this.trackingEvents;\n\n    if (trackingEvents) {\n      trackingEvents = isArray(trackingEvents) ? trackingEvents : [trackingEvents];\n      trackingEvents.forEach(function (trackingEvent) {\n        if (!eventsMap[trackingEvent.name]) {\n          eventsMap[trackingEvent.name] = [];\n        }\n        eventsMap[trackingEvent.name].push(trackingEvent);\n      });\n    }\n  };\n\n  VASTResponse.prototype._addTitle = function (title) {\n    if (isNotEmptyString(title)) {\n      this.adTitle = title;\n    }\n  };\n\n  VASTResponse.prototype._addDuration = function (duration) {\n    if (isNumber(duration)) {\n      this.duration = duration;\n    }\n  };\n\n  VASTResponse.prototype._addVideoClicks = function (videoClicks) {\n    if (videoClicks instanceof VideoClicks) {\n      this._addClickThrough(videoClicks.clickThrough);\n      this._addClickTrackings(videoClicks.clickTrackings);\n      this._addCustomClicks(videoClicks.customClicks);\n    }\n  };\n\n  VASTResponse.prototype._addMediaFiles = function (mediaFiles) {\n    isArray(mediaFiles) && appendToArray(this.mediaFiles, mediaFiles);\n  };\n\n  VASTResponse.prototype._addSkipoffset = function (offset) {\n    if (offset) {\n      this.skipoffset = offset;\n    }\n  };\n\n  VASTResponse.prototype._addAdParameters = function (adParameters) {\n    if (adParameters) {\n      this.adParameters = adParameters;\n    }\n  };\n\n  VASTResponse.prototype._addLinear = function (linear) {\n    if (linear instanceof Linear) {\n      this._addDuration(linear.duration);\n      this._addTrackingEvents(linear.trackingEvents);\n      this._addVideoClicks(linear.videoClicks);\n      this._addMediaFiles(linear.mediaFiles);\n      this._addSkipoffset(linear.skipoffset);\n      this._addAdParameters(linear.adParameters);\n      this._linearAdded = true;\n    }\n  };\n\n  VASTResponse.prototype._addInLine = function (inLine) {\n    var that = this;\n\n    if (inLine instanceof InLine) {\n      this._addTitle(inLine.adTitle);\n      this._addErrorTrackUrl(inLine.error);\n      this._addImpressions(inLine.impressions);\n\n      inLine.creatives.forEach(function (creative) {\n        if (creative.linear) {\n          that._addLinear(creative.linear);\n        }\n      });\n    }\n  };\n\n  VASTResponse.prototype._addWrapper = function (wrapper) {\n    var that = this;\n\n    if (wrapper instanceof Wrapper) {\n      this._addErrorTrackUrl(wrapper.error);\n      this._addImpressions(wrapper.impressions);\n\n      wrapper.creatives.forEach(function (creative) {\n        var linear = creative.linear;\n        if (linear) {\n          that._addVideoClicks(linear.videoClicks);\n          that.clickThrough = undefined;//We ensure that no clickThrough has been added\n          that._addTrackingEvents(linear.trackingEvents);\n        }\n      });\n    }\n  };\n\n  VASTResponse.prototype.hasLinear = function(){\n    return this._linearAdded;\n  };\n\n  function appendToArray(array, items) {\n    items.forEach(function (item) {\n      array.push(item);\n    });\n  }\n\n  window.VASTResponse = VASTResponse;\n})(window);\n\n;\nfunction VASTTracker(assetURI, vastResponse) {\n  if (!(this instanceof VASTTracker)) {\n    return new VASTTracker(assetURI, vastResponse);\n  }\n\n  sanityCheck(assetURI, vastResponse);\n  this.response = vastResponse;\n  this.assetURI = assetURI;\n  this.progress = 0;\n  this.quartiles = {\n    firstQuartile: {tracked: false, time: Math.round(25 * vastResponse.duration) / 100},\n    midpoint: {tracked: false, time: Math.round(50 * vastResponse.duration) / 100},\n    thirdQuartile: {tracked: false, time: Math.round(75 * vastResponse.duration) / 100}\n  };\n\n  /*** Local Functions ***/\n  function sanityCheck(assetURI, vastResponse) {\n    if (!isString(assetURI) || isEmptyString(assetURI)) {\n      throw new VASTError('on VASTTracker constructor, missing required the URI of the ad asset being played');\n    }\n\n    if (!(vastResponse instanceof VASTResponse)) {\n      throw new VASTError('on VASTTracker constructor, missing required VAST response');\n    }\n  }\n}\n\nVASTTracker.prototype.trackURLs = function trackURLs(urls, variables) {\n  if (isArray(urls) && urls.length > 0) {\n    variables = extend({\n      ASSETURI: this.assetURI,\n      CONTENTPLAYHEAD: vastUtil.formatProgress(this.progress)\n    }, variables || {});\n\n    vastUtil.track(urls, variables);\n  }\n};\n\nVASTTracker.prototype.trackEvent = function trackEvent(eventName, trackOnce) {\n  this.trackURLs(getEventUris(this.response.trackingEvents[eventName]));\n  if (trackOnce) {\n    this.response.trackingEvents[eventName] = undefined;\n  }\n\n  /*** Local function ***/\n  function getEventUris(trackingEvents) {\n    var uris;\n\n    if (trackingEvents) {\n      uris = [];\n      trackingEvents.forEach(function (event) {\n        uris.push(event.uri);\n      });\n    }\n    return uris;\n  }\n};\n\nVASTTracker.prototype.trackProgress = function trackProgress(newProgressInMs) {\n  var events = [];\n  var ONCE = true;\n  var ALWAYS = false;\n  var trackingEvents = this.response.trackingEvents;\n\n  if (isNumber(newProgressInMs)) {\n    addTrackEvent('start', ONCE, newProgressInMs > 0);\n    addTrackEvent('rewind', ALWAYS, hasRewound(this.progress, newProgressInMs));\n    addQuartileEvents.call(this, newProgressInMs);\n    trackProgressEvents.call(this, newProgressInMs);\n    trackEvents.call(this);\n    this.progress = newProgressInMs;\n  }\n\n  /*** Local function ***/\n  function hasRewound(currentProgress, newProgress) {\n    var REWIND_THRESHOLD = 3000; //IOS video clock is very unreliable and we need a 3 seconds threshold to ensure that there was a rewind an that it was on purpose.\n    return currentProgress > newProgressInMs && Math.abs(newProgress - currentProgress) > REWIND_THRESHOLD;\n  }\n\n  function addTrackEvent(eventName, trackOnce, canBeAdded) {\n    if (trackingEvents[eventName] && canBeAdded) {\n      events.push({\n        name: eventName,\n        trackOnce: !!trackOnce\n      });\n    }\n  }\n\n  function addQuartileEvents(progress) {\n    var quartiles = this.quartiles;\n    var firstQuartile = this.quartiles.firstQuartile;\n    var midpoint = this.quartiles.midpoint;\n    var thirdQuartile = this.quartiles.thirdQuartile;\n\n    if (!firstQuartile.tracked) {\n      trackQuartile('firstQuartile', progress);\n    } else if (!midpoint.tracked) {\n      trackQuartile('midpoint', progress);\n    } else {\n      trackQuartile('thirdQuartile', progress);\n    }\n\n    /*** Local function ***/\n    function trackQuartile(quartileName, progress){\n      var quartile = quartiles[quartileName];\n      if(canBeTracked(quartile, progress)){\n        quartile.tracked = true;\n        addTrackEvent(quartileName, ONCE, true);\n      }\n    }\n  }\n\n  function canBeTracked(quartile, progress) {\n    var quartileTime = quartile.time;\n    //We only fire the quartile event if the progress is bigger than the quartile time by 5 seconds at most.\n    return progress >= quartileTime && progress <= (quartileTime + 5000);\n  }\n\n  function trackProgressEvents(progress) {\n    if (!isArray(trackingEvents.progress)) {\n      return; //Nothing to track\n    }\n\n    var pendingProgressEvts = [];\n    var that = this;\n\n    trackingEvents.progress.forEach(function (evt) {\n      if (evt.offset <= progress) {\n        that.trackURLs([evt.uri]);\n      } else {\n        pendingProgressEvts.push(evt);\n      }\n    });\n    trackingEvents.progress = pendingProgressEvts;\n  }\n\n  function trackEvents() {\n    events.forEach(function (event) {\n      this.trackEvent(event.name, event.trackOnce);\n    }, this);\n  }\n};\n\n[\n  'rewind',\n  'fullscreen',\n  'exitFullscreen',\n  'pause',\n  'resume',\n  'mute',\n  'unmute',\n  'acceptInvitation',\n  'acceptInvitationLinear',\n  'collapse',\n  'expand'\n].forEach(function (eventName) {\n    VASTTracker.prototype['track' + capitalize(eventName)] = function () {\n      this.trackEvent(eventName);\n    };\n  });\n\n[\n  'start',\n  'skip',\n  'close',\n  'closeLinear'\n].forEach(function (eventName) {\n    VASTTracker.prototype['track' + capitalize(eventName)] = function () {\n      this.trackEvent(eventName, true);\n    };\n  });\n\n[\n  'firstQuartile',\n  'midpoint',\n  'thirdQuartile'\n].forEach(function (quartile) {\n    VASTTracker.prototype['track' + capitalize(quartile)] = function () {\n      this.quartiles[quartile].tracked = true;\n      this.trackEvent(quartile, true);\n    };\n  });\n\nVASTTracker.prototype.trackComplete = function () {\n  if(this.quartiles.thirdQuartile.tracked){\n    this.trackEvent('complete', true);\n  }\n};\n\nVASTTracker.prototype.trackErrorWithCode = function trackErrorWithCode(errorcode) {\n  if (isNumber(errorcode)) {\n    this.trackURLs(this.response.errorURLMacros, {ERRORCODE: errorcode});\n  }\n};\n\nVASTTracker.prototype.trackImpressions = function trackImpressions() {\n  this.trackURLs(this.response.impressions);\n};\n\nVASTTracker.prototype.trackCreativeView = function trackCreativeView() {\n  this.trackEvent('creativeView');\n};\n\nVASTTracker.prototype.trackClick = function trackClick() {\n  this.trackURLs(this.response.clickTrackings);\n};\n\n;\nfunction VideoClicks(videoClickJTree) {\n  if (!(this instanceof VideoClicks)) {\n    return new VideoClicks(videoClickJTree);\n  }\n\n  this.clickThrough = xml.keyValue(videoClickJTree.clickThrough);\n  this.clickTrackings = parseClickTrackings(videoClickJTree.clickTracking);\n  this.customClicks = parseClickTrackings(videoClickJTree.customClick);\n\n  /*** Local functions ***/\n  function parseClickTrackings(trackingData) {\n    var clickTrackings = [];\n    if (trackingData) {\n      trackingData = isArray(trackingData) ? trackingData : [trackingData];\n      trackingData.forEach(function (clickTrackingData) {\n        clickTrackings.push(xml.keyValue(clickTrackingData));\n      });\n    }\n    return clickTrackings;\n  }\n}\n;\nfunction Wrapper(wrapperJTree) {\n  if(!(this instanceof Wrapper)) {\n    return new Wrapper(wrapperJTree);\n  }\n\n  //Required elements\n  this.adSystem = xml.keyValue(wrapperJTree.adSystem);\n  this.impressions = vastUtil.parseImpressions(wrapperJTree.impression);\n  this.VASTAdTagURI = xml.keyValue(wrapperJTree.vASTAdTagURI);\n\n  //Optional elements\n  this.creatives = vastUtil.parseCreatives(wrapperJTree.creatives);\n  this.error = xml.keyValue(wrapperJTree.error);\n  this.extensions = wrapperJTree.extensions;\n\n  //Optional attrs\n  this.followAdditionalWrappers = isDefined(xml.attr(wrapperJTree, 'followAdditionalWrappers'))? xml.attr(wrapperJTree, 'followAdditionalWrappers'): true;\n  this.allowMultipleAds = xml.attr(wrapperJTree, 'allowMultipleAds');\n  this.fallbackOnNoAd = xml.attr(wrapperJTree, 'fallbackOnNoAd');\n}\n\n\n\n;\n\"use strict\";\n\nvar vastUtil = {\n\n  track: function track(URLMacros, variables) {\n    var sources = vastUtil.parseURLMacros(URLMacros, variables);\n    var trackImgs = [];\n    sources.forEach(function (src) {\n      var img = new Image();\n      img.src = src;\n      trackImgs.push(img);\n    });\n    return trackImgs;\n  },\n\n  parseURLMacros: function parseMacros(URLMacros, variables) {\n    var parsedURLs = [];\n\n    variables = variables || {};\n\n    if (!(variables[\"CACHEBUSTING\"])) {\n      variables[\"CACHEBUSTING\"] = Math.round(Math.random() * 1.0e+10);\n    }\n\n    URLMacros.forEach(function (URLMacro) {\n      parsedURLs.push(vastUtil._parseURLMacro(URLMacro, variables));\n    });\n\n    return parsedURLs;\n  },\n\n  parseURLMacro: function parseMacro(URLMacro, variables) {\n    variables = variables || {};\n\n    if (!(variables[\"CACHEBUSTING\"])) {\n      variables[\"CACHEBUSTING\"] = Math.round(Math.random() * 1.0e+10);\n    }\n\n    return vastUtil._parseURLMacro(URLMacro, variables);\n  },\n\n  _parseURLMacro: function parseMacro(URLMacro, variables) {\n    variables = variables || {};\n\n    forEach(variables, function (value, key) {\n      URLMacro = URLMacro.replace(new RegExp(\"\\\\[\" + key + \"\\\\\\]\", 'gm'), value);\n    });\n\n    return URLMacro;\n  },\n\n  parseDuration: function parseDuration(durationStr) {\n    var durationRegex = /(\\d\\d):(\\d\\d):(\\d\\d)(\\.(\\d\\d\\d))?/;\n    var match, durationInMs;\n\n    if (isString(durationStr)) {\n      match = durationStr.match(durationRegex);\n      if (match) {\n        durationInMs = parseHoursToMs(match[1]) + parseMinToMs(match[2]) + parseSecToMs(match[3]) + parseInt(match[5] || 0);\n      }\n    }\n\n    return isNaN(durationInMs) ? null : durationInMs;\n\n    /*** local functions ***/\n    function parseHoursToMs(hourStr) {\n      return parseInt(hourStr, 10) * 60 * 60 * 1000;\n    }\n\n    function parseMinToMs(minStr) {\n      return parseInt(minStr, 10) * 60 * 1000;\n    }\n\n    function parseSecToMs(secStr) {\n      return parseInt(secStr, 10) * 1000;\n    }\n  },\n\n  parseImpressions: function parseImpressions(impressions) {\n    if (impressions) {\n      impressions = isArray(impressions) ? impressions : [impressions];\n      return transformArray(impressions, function (impression) {\n        if (isNotEmptyString(impression.keyValue)) {\n          return impression.keyValue;\n        }\n        return undefined;\n      });\n    }\n    return [];\n  },\n\n  parseCreatives: function parseCreatives(creativesJTree) {\n    var creatives = [];\n    var creativesData;\n    if (isDefined(creativesJTree) && isDefined(creativesJTree.creative)) {\n      creativesData = isArray(creativesJTree.creative) ? creativesJTree.creative : [creativesJTree.creative];\n      creativesData.forEach(function (creative) {\n        creatives.push(new Creative(creative));\n      });\n    }\n    return creatives;\n  },\n\n  //We assume that the progress is going to arrive in milliseconds\n  formatProgress: function formatProgress(progress) {\n    var hours, minutes, seconds, milliseconds;\n    hours = progress / (60 * 60 * 1000);\n    hours = Math.floor(hours);\n    minutes = (progress / (60 * 1000)) % 60;\n    minutes = Math.floor(minutes);\n    seconds = (progress / 1000) % 60;\n    seconds = Math.floor(seconds);\n    milliseconds = progress % 1000;\n    return toFixedDigits(hours, 2) + ':' + toFixedDigits(minutes, 2) + ':' + toFixedDigits(seconds, 2) + '.' + toFixedDigits(milliseconds, 3);\n  },\n\n  parseOffset:   function parseOffset(offset, duration) {\n    if(isPercentage(offset)){\n      return calculatePercentage(offset, duration);\n    }\n    return vastUtil.parseDuration(offset);\n\n    /*** Local function ***/\n    function isPercentage(offset) {\n      var percentageRegex = /^\\d+(\\.\\d+)?%$/g;\n      return percentageRegex.test(offset);\n    }\n\n    function calculatePercentage(percentStr, duration) {\n      if(duration) {\n        return calcPercent(duration, parseFloat(percentStr.replace('%', '')));\n      }\n      return null;\n    }\n\n    function calcPercent(quantity, percent){\n      return quantity * percent / 100;\n    }\n  },\n\n  isVPAID: function isVPAIDMediaFile(mediaFile) {\n    return !!mediaFile && mediaFile.apiFramework === 'VPAID';\n  }\n};})(window, document, videojs);","/*jshint unused:false */\n\"use strict\";\n\nvar NODE_TYPE_ELEMENT = 1;\n\nfunction noop(){ }\n\nfunction isNull(o) {\n  return o === null;\n}\n\nfunction isDefined(o){\n  return o !== undefined;\n}\n\nfunction isUndefined(o){\n  return o === undefined;\n}\n\nfunction isObject(obj) {\n  return typeof obj === 'object';\n}\n\nfunction isFunction(str){\n  return typeof str === 'function';\n}\n\nfunction isNumber(num){\n  return typeof num === 'number';\n}\n\nfunction isWindow(obj) {\n  return isObject(obj) && obj.window === obj;\n}\n\nfunction isArray(array){\n  return Object.prototype.toString.call( array ) === '[object Array]';\n}\n\nfunction isArrayLike(obj) {\n  if (obj === null || isWindow(obj) || isFunction(obj) || isUndefined(obj)) {\n    return false;\n  }\n\n  var length = obj.length;\n\n  if (obj.nodeType === NODE_TYPE_ELEMENT && length) {\n    return true;\n  }\n\n  return isString(obj) || isArray(obj) || length === 0 ||\n    typeof length === 'number' && length > 0 && (length - 1) in obj;\n}\n\nfunction isString(str){\n  return typeof str === 'string';\n}\n\nfunction isEmptyString(str) {\n  return isString(str) && str.length === 0;\n}\n\nfunction isNotEmptyString(str) {\n  return isString(str) && str.length !== 0;\n}\n\nfunction arrayLikeObjToArray(args) {\n  return Array.prototype.slice.call(args);\n}\n\nfunction forEach(obj, iterator, context) {\n  var key, length;\n  if (obj) {\n    if (isFunction(obj)) {\n      for (key in obj) {\n        // Need to check if hasOwnProperty exists,\n        // as on IE8 the result of querySelectorAll is an object without a hasOwnProperty function\n        if (key !== 'prototype' && key !== 'length' && key !== 'name' && (!obj.hasOwnProperty || obj.hasOwnProperty(key))) {\n          iterator.call(context, obj[key], key, obj);\n        }\n      }\n    } else if (isArray(obj)) {\n      var isPrimitive = typeof obj !== 'object';\n      for (key = 0, length = obj.length; key < length; key++) {\n        if (isPrimitive || key in obj) {\n          iterator.call(context, obj[key], key, obj);\n        }\n      }\n    } else if (obj.forEach && obj.forEach !== forEach) {\n      obj.forEach(iterator, context, obj);\n    } else {\n      for (key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          iterator.call(context, obj[key], key, obj);\n        }\n      }\n    }\n  }\n  return obj;\n}\n\nvar SNAKE_CASE_REGEXP = /[A-Z]/g;\nfunction snake_case(name, separator) {\n  separator = separator || '_';\n  return name.replace(SNAKE_CASE_REGEXP, function(letter, pos) {\n    return (pos ? separator : '') + letter.toLowerCase();\n  });\n}\n\nfunction isValidEmail(email){\n  if(!isString(email)){\n    return false;\n  }\n  var EMAIL_REGEXP = /^[a-z0-9!#$%&'*+\\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)+$/i;\n  return EMAIL_REGEXP.test(email.trim());\n}\n\nfunction extend (obj) {\n  var arg, i, k;\n  for (i = 1; i < arguments.length; i++) {\n    arg = arguments[i];\n    for (k in arg) {\n      if (arg.hasOwnProperty(k)) {\n        if(isObject(obj[k]) && !isNull(obj[k]) && isObject(arg[k])){\n          obj[k] = extend({}, obj[k], arg[k]);\n        }else {\n          obj[k] = arg[k];\n        }\n      }\n    }\n  }\n  return obj;\n}\n\nfunction capitalize(s){\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction decapitalize(s) {\n  return s.charAt(0).toLowerCase() + s.slice(1);\n}\n\n/**\n * This method works the same way array.prototype.map works but if the transformer returns undefine, then\n * it won't be added to the transformed Array.\n */\nfunction transformArray(array, transformer) {\n  var transformedArray = [];\n\n  array.forEach(function(item, index){\n    var transformedItem = transformer(item, index);\n    if(isDefined(transformedItem)) {\n      transformedArray.push(transformedItem);\n    }\n  });\n\n  return transformedArray;\n}\n\nfunction toFixedDigits(num, digits) {\n  var formattedNum = num + '';\n  digits = isNumber(digits) ? digits : 0;\n  num = isNumber(num) ? num : parseInt(num, 10);\n  if(isNumber(num) && !isNaN(num)){\n    formattedNum = num + '';\n    while(formattedNum.length < digits) {\n      formattedNum = '0' + formattedNum;\n    }\n    return formattedNum;\n  }\n  return NaN + '';\n}\n\nfunction throttle(callback, delay) {\n  var previousCall = new Date().getTime() - (delay + 1);\n  return function() {\n    var time = new Date().getTime();\n    if ((time - previousCall) >= delay) {\n      previousCall = time;\n      callback.apply(this, arguments);\n    }\n  };\n}\n\nfunction debounce (callback, wait) {\n  var timeoutId;\n\n  return function (){\n    if(timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(function(){\n      callback.apply(this, arguments);\n      timeoutId = undefined;\n    }, wait);\n  };\n}\n\n// a function designed to blow up the stack in a naive way\n// but it is ok for videoJs children components\nfunction treeSearch(root, getChildren, found){\n  var children = getChildren(root);\n  for (var i = 0; i < children.length; i++){\n    if (found(children[i])) {\n      return children[i];\n    }\n    else {\n      var el = treeSearch(children[i], getChildren, found);\n      if (el){\n        return el;\n      }\n    }\n  }\n}\n\nfunction echoFn(val) {\n  return function () {\n    return val;\n  };\n}\n\n//Note: Supported formats come from http://www.w3.org/TR/NOTE-datetime\n// and the iso8601 regex comes from http://www.pelagodesign.com/blog/2009/05/20/iso-8601-date-validation-that-doesnt-suck/\nfunction isISO8601(value) {\n  if(isNumber(value)){\n    value = value + '';  //we make sure that we are working with strings\n  }\n\n  if(!isString(value)){\n    return false;\n  }\n\n  /*jslint maxlen: 500 */\n  var iso8086Regex = /^([\\+-]?\\d{4}(?!\\d{2}\\b))((-?)((0[1-9]|1[0-2])(\\3([12]\\d|0[1-9]|3[01]))?|W([0-4]\\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\\d|[12]\\d{2}|3([0-5]\\d|6[1-6])))([T\\s]((([01]\\d|2[0-3])((:?)[0-5]\\d)?|24\\:?00)([\\.,]\\d+(?!:))?)?(\\17[0-5]\\d([\\.,]\\d+)?)?([zZ]|([\\+-])([01]\\d|2[0-3]):?([0-5]\\d)?)?)?)?$/;\n  return iso8086Regex.test(value.trim());\n}\n\n/**\n * Checks if the Browser is IE9 and below\n * @returns {boolean}\n */\nfunction isOldIE() {\n  var version = getInternetExplorerVersion(navigator);\n  if (version === -1) {\n    return false;\n  }\n\n  return version < 10;\n}\n\n/**\n * Returns the version of Internet Explorer or a -1 (indicating the use of another browser).\n * Source: https://msdn.microsoft.com/en-us/library/ms537509(v=vs.85).aspx\n * @returns {number} the version of Internet Explorer or a -1 (indicating the use of another browser).\n */\nfunction getInternetExplorerVersion(navigator) {\n  var rv = -1;\n\n  if (navigator.appName == 'Microsoft Internet Explorer') {\n    var ua = navigator.userAgent;\n    var re = new RegExp(\"MSIE ([0-9]{1,}[\\.0-9]{0,})\");\n    var res = re.exec(ua);\n    if (res !== null) {\n      rv = parseFloat(res[1]);\n    }\n  }\n\n  return rv;\n}\n\n/*** Mobile Utility functions ***/\nvar _UA = navigator.userAgent;\nfunction isIDevice() {\n  return /iP(hone|ad)/.test(_UA);\n}\n\nfunction isMobile() {\n  return /iP(hone|ad|od)|Android|Windows Phone/.test(_UA);\n}\n\nfunction isIPhone() {\n  return /iP(hone|od)/.test(_UA);\n}\n\nfunction isAndroid() {\n  return /Android/.test(_UA);\n}\n","\"use strict\";\n\nfunction HttpRequestError(message) {\n  this.message = 'HttpRequest Error: ' + (message || '');\n}\nHttpRequestError.prototype = new Error();\nHttpRequestError.prototype.name = \"HttpRequest Error\";\n\nfunction HttpRequest(createXhr) {\n  if (!isFunction(createXhr)) {\n    throw new HttpRequestError('Missing XMLHttpRequest factory method');\n  }\n\n  this.createXhr = createXhr;\n}\n\nHttpRequest.prototype.run = function (method, url, callback, options) {\n  sanityCheck(url, callback, options);\n  var timeout, timeoutId;\n  var xhr = this.createXhr();\n  options = options || {};\n  timeout = isNumber(options.timeout) ? options.timeout : 0;\n\n  xhr.open(method, urlParts(url).href, true);\n\n  if (options.headers) {\n    setHeaders(xhr, options.headers);\n  }\n\n  if (options.withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.onload = function () {\n    var statusText, response, status;\n\n    /**\n     * The only way to do a secure request on IE8 and IE9 is with the XDomainRequest object. Unfortunately, microsoft is\n     * so nice that decided that the status property and the 'getAllResponseHeaders' method where not needed so we have to\n     * fake them. If the request gets done with an XDomainRequest instance, we will assume that there are no headers and\n     * the status will always be 200. If you don't like it, DO NOT USE ANCIENT BROWSERS!!!\n     *\n     * For mor info go to: https://msdn.microsoft.com/en-us/library/cc288060(v=vs.85).aspx\n     */\n    if (!xhr.getAllResponseHeaders) {\n      xhr.getAllResponseHeaders = function () {\n        return null;\n      };\n    }\n\n    if (!xhr.status) {\n      xhr.status = 200;\n    }\n\n    if (isDefined(timeoutId)) {\n      clearTimeout(timeoutId);\n      timeoutId = undefined;\n    }\n\n    statusText = xhr.statusText || '';\n\n    // responseText is the old-school way of retrieving response (supported by IE8 & 9)\n    // response/responseType properties were introduced in XHR Level2 spec (supported by IE10)\n    response = ('response' in xhr) ? xhr.response : xhr.responseText;\n\n    // normalize IE9 bug (http://bugs.jquery.com/ticket/1450)\n    status = xhr.status === 1223 ? 204 : xhr.status;\n\n    callback(\n      status,\n      response,\n      xhr.getAllResponseHeaders(),\n      statusText);\n  };\n\n  xhr.onerror = requestError;\n  xhr.onabort = requestError;\n\n  xhr.send();\n\n  if (timeout > 0) {\n    timeoutId = setTimeout(function () {\n      xhr && xhr.abort();\n    }, timeout);\n  }\n\n  function sanityCheck(url, callback, options) {\n    if (!isString(url) || isEmptyString(url)) {\n      throw new HttpRequestError(\"Invalid url '\" + url + \"'\");\n    }\n\n    if (!isFunction(callback)) {\n      throw new HttpRequestError(\"Invalid handler '\" + callback + \"' for the http request\");\n    }\n\n    if (isDefined(options) && !isObject(options)) {\n      throw new HttpRequestError(\"Invalid options map '\" + options + \"'\");\n    }\n  }\n\n  function setHeaders(xhr, headers) {\n    forEach(headers, function (value, key) {\n      if (isDefined(value)) {\n        xhr.setRequestHeader(key, value);\n      }\n    });\n  }\n\n  function requestError() {\n    callback(-1, null, null, '');\n  }\n};\n\nHttpRequest.prototype.get = function (url, callback, options) {\n  this.run('GET', url, processResponse, options);\n\n  function processResponse(status, response, headersString, statusText) {\n    if (isSuccess(status)) {\n      callback(null, response, status, headersString, statusText);\n    } else {\n      callback(new HttpRequestError(statusText), response, status, headersString, statusText);\n    }\n  }\n\n  function isSuccess(status) {\n    return 200 <= status && status < 300;\n  }\n};\n\nfunction createXhr() {\n  var xhr = new XMLHttpRequest();\n  if (!(\"withCredentials\" in xhr)) {\n    // XDomainRequest for IE.\n    xhr = new XDomainRequest();\n  }\n  return xhr;\n}\n\nvar http = new HttpRequest(createXhr);\n","'use strict';\n\n/**\n * documentMode is an IE-only property\n * http://msdn.microsoft.com/en-us/library/ie/cc196988(v=vs.85).aspx\n */\nvar msie = document.documentMode;\n\n/**\n *\n * IMPORTANT NOTE: This function comes from angularJs and was originally called urlResolve\n *                 you can take a look at the original code here https://github.com/angular/angular.js/blob/master/src/ng/urlUtils.js\n *\n * Implementation Notes for non-IE browsers\n * ----------------------------------------\n * Assigning a URL to the href property of an anchor DOM node, even one attached to the DOM,\n * results both in the normalizing and parsing of the URL.  Normalizing means that a relative\n * URL will be resolved into an absolute URL in the context of the application document.\n * Parsing means that the anchor node's host, hostname, protocol, port, pathname and related\n * properties are all populated to reflect the normalized URL.  This approach has wide\n * compatibility - Safari 1+, Mozilla 1+, Opera 7+,e etc.  See\n * http://www.aptana.com/reference/html/api/HTMLAnchorElement.html\n *\n * Implementation Notes for IE\n * ---------------------------\n * IE >= 8 and <= 10 normalizes the URL when assigned to the anchor node similar to the other\n * browsers.  However, the parsed components will not be set if the URL assigned did not specify\n * them.  (e.g. if you assign a.href = \"foo\", then a.protocol, a.host, etc. will be empty.)  We\n * work around that by performing the parsing in a 2nd step by taking a previously normalized\n * URL (e.g. by assigning to a.href) and assigning it a.href again.  This correctly populates the\n * properties such as protocol, hostname, port, etc.\n *\n * IE7 does not normalize the URL when assigned to an anchor node.  (Apparently, it does, if one\n * uses the inner HTML approach to assign the URL as part of an HTML snippet -\n * http://stackoverflow.com/a/472729)  However, setting img[src] does normalize the URL.\n * Unfortunately, setting img[src] to something like \"javascript:foo\" on IE throws an exception.\n * Since the primary usage for normalizing URLs is to sanitize such URLs, we can't use that\n * method and IE < 8 is unsupported.\n *\n * References:\n *   http://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement\n *   http://www.aptana.com/reference/html/api/HTMLAnchorElement.html\n *   http://url.spec.whatwg.org/#urlutils\n *   https://github.com/angular/angular.js/pull/2902\n *   http://james.padolsey.com/javascript/parsing-urls-with-the-dom/\n *\n * @kind function\n * @param {string} url The URL to be parsed.\n * @description Normalizes and parses a URL.\n * @returns {object} Returns the normalized URL as a dictionary.\n *\n *   | member name   | Description    |\n *   |---------------|----------------|\n *   | href          | A normalized version of the provided URL if it was not an absolute URL |\n *   | protocol      | The protocol including the trailing colon                              |\n *   | host          | The host and port (if the port is non-default) of the normalizedUrl    |\n *   | search        | The search params, minus the question mark                             |\n *   | hash          | The hash string, minus the hash symbol\n *   | hostname      | The hostname\n *   | port          | The port, without \":\"\n *   | pathname      | The pathname, beginning with \"/\"\n *\n */\n\nvar urlParsingNode = document.createElement(\"a\");\n\nfunction urlParts(url) {\n  var href = url;\n\n  if (msie) {\n    // Normalize before parse.  Refer Implementation Notes on why this is\n    // done in two steps on IE.\n    urlParsingNode.setAttribute(\"href\", href);\n    href = urlParsingNode.href;\n  }\n\n  urlParsingNode.setAttribute('href', href);\n\n  // urlParsingNode provides the UrlUtils interface - http://url.spec.whatwg.org/#urlutils\n  return {\n    href: urlParsingNode.href,\n    protocol: urlParsingNode.protocol ? urlParsingNode.protocol.replace(/:$/, '') : '',\n    host: urlParsingNode.host,\n    search: urlParsingNode.search ? urlParsingNode.search.replace(/^\\?/, '') : '',\n    hash: urlParsingNode.hash ? urlParsingNode.hash.replace(/^#/, '') : '',\n    hostname: urlParsingNode.hostname,\n    port: isNotEmptyString(urlParsingNode.port)? urlParsingNode.port: 80,\n    pathname: (urlParsingNode.pathname.charAt(0) === '/')\n      ? urlParsingNode.pathname\n      : '/' + urlParsingNode.pathname\n  };\n}\n\n\n/**\n * This function accepts a query string (search part of a url) and returns a dictionary with\n * the different key value pairs\n * @param {string} qs queryString\n */\nfunction queryStringToObj(qs, cond) {\n  var pairs, qsObj;\n\n  cond = isFunction(cond)? cond : function() {\n    return true;\n  };\n\n  qs = qs.trim().replace(/^\\?/, '');\n  pairs = qs.split('&');\n  qsObj = {};\n\n  forEach(pairs, function (pair) {\n    var keyValue, key, value;\n    if (pair !== '') {\n      keyValue = pair.split('=');\n      key = keyValue[0];\n      value = keyValue[1];\n      if(cond(key, value)){\n        qsObj[key] = value;\n      }\n    }\n  });\n\n  return qsObj;\n}\n\n/**\n * This function accepts an object and serializes it into a query string without the leading '?'\n * @param obj\n * @returns {string}\n */\nfunction objToQueryString(obj) {\n  var pairs = [];\n  forEach(obj, function (value, key) {\n    pairs.push(key + '=' + value);\n  });\n  return pairs.join('&');\n}\n\n","function VPAIDAdUnitWrapper(vpaidAdUnit, opts) {\n  if (!(this instanceof VPAIDAdUnitWrapper)) {\n    return new VPAIDAdUnitWrapper(vpaidAdUnit, opts);\n  }\n  sanityCheck(vpaidAdUnit, opts);\n\n  this.options = extend({}, opts);\n\n  this._adUnit = vpaidAdUnit;\n\n  /*** Local Functions ***/\n  function sanityCheck(adUnit, opts) {\n    if (!adUnit || !VPAIDAdUnitWrapper.checkVPAIDInterface(adUnit)) {\n      throw new VASTError('on VPAIDAdUnitWrapper, the passed VPAID adUnit does not fully implement the VPAID interface');\n    }\n\n    if (!isObject(opts)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper, expected options hash  but got '\" + opts + \"'\");\n    }\n\n    if (!(\"responseTimeout\" in opts) || !isNumber(opts.responseTimeout) ){\n      throw new VASTError(\"on VPAIDAdUnitWrapper, expected responseTimeout in options\");\n    }\n  }\n}\n\nVPAIDAdUnitWrapper.checkVPAIDInterface = function checkVPAIDInterface(VPAIDAdUnit) {\n  //NOTE: skipAd is not part of the method list because it only appears in VPAID 2.0 and we support VPAID 1.0\n  var VPAIDInterfaceMethods = [\n    'handshakeVersion', 'initAd', 'startAd', 'stopAd', 'resizeAd', 'pauseAd', 'expandAd', 'collapseAd'\n  ];\n\n  for (var i = 0, len = VPAIDInterfaceMethods.length; i < len; i++) {\n    if (!VPAIDAdUnit || !isFunction(VPAIDAdUnit[VPAIDInterfaceMethods[i]])) {\n      return false;\n    }\n  }\n\n\n  return canSubscribeToEvents(VPAIDAdUnit) && canUnsubscribeFromEvents(VPAIDAdUnit);\n\n  /*** Local Functions ***/\n\n  function canSubscribeToEvents(adUnit) {\n    return isFunction(adUnit.subscribe) || isFunction(adUnit.addEventListener) || isFunction(adUnit.on);\n  }\n\n  function canUnsubscribeFromEvents(adUnit) {\n    return isFunction(adUnit.unsubscribe) || isFunction(adUnit.removeEventListener) || isFunction(adUnit.off);\n\n  }\n};\n\nVPAIDAdUnitWrapper.prototype.adUnitAsyncCall = function () {\n  var args = arrayLikeObjToArray(arguments);\n  var method = args.shift();\n  var cb = args.pop();\n  var timeoutId;\n\n  sanityCheck(method, cb, this._adUnit);\n  args.push(wrapCallback());\n\n  this._adUnit[method].apply(this._adUnit, args);\n  timeoutId = setTimeout(function () {\n    timeoutId = null;\n    cb(new VASTError(\"on VPAIDAdUnitWrapper, timeout while waiting for a response on call '\" + method + \"'\"));\n    cb = noop;\n  }, this.options.responseTimeout);\n\n  /*** Local functions ***/\n  function sanityCheck(method, cb, adUnit) {\n    if (!isString(method) || !isFunction(adUnit[method])) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.adUnitAsyncCall, invalid method name\");\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.adUnitAsyncCall, missing callback\");\n    }\n  }\n\n  function wrapCallback() {\n    return function () {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      cb.apply(this, arguments);\n    };\n  }\n};\n\nVPAIDAdUnitWrapper.prototype.on = function (evtName, handler) {\n  var addEventListener = this._adUnit.addEventListener || this._adUnit.subscribe || this._adUnit.on;\n  addEventListener.call(this._adUnit, evtName, handler);\n};\n\nVPAIDAdUnitWrapper.prototype.off = function (evtName, handler) {\n  var removeEventListener = this._adUnit.removeEventListener || this._adUnit.unsubscribe || this._adUnit.off;\n  removeEventListener.call(this._adUnit, evtName, handler);\n};\n\nVPAIDAdUnitWrapper.prototype.waitForEvent = function (evtName, cb, context) {\n  var timeoutId;\n  sanityCheck(evtName, cb);\n  context = context || null;\n\n  this.on(evtName, responseListener);\n\n  timeoutId = setTimeout(function () {\n    cb(new VASTError(\"on VPAIDAdUnitWrapper.waitForEvent, timeout while waiting for event '\" + evtName + \"'\"));\n    timeoutId = null;\n    cb = noop;\n  }, this.options.responseTimeout);\n\n  /*** Local functions ***/\n  function sanityCheck(evtName, cb) {\n    if (!isString(evtName)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.waitForEvent, missing evt name\");\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError(\"on VPAIDAdUnitWrapper.waitForEvent, missing callback\");\n    }\n  }\n\n  function responseListener() {\n    var args = arrayLikeObjToArray(arguments);\n\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n      timeoutId = null;\n    }\n\n    args.unshift(null);\n    cb.apply(context, args);\n  }\n};\n\n// VPAID METHODS\nVPAIDAdUnitWrapper.prototype.handshakeVersion = function (version, cb) {\n  this.adUnitAsyncCall('handshakeVersion', version, cb);\n};\n\n/* jshint maxparams:6 */\nVPAIDAdUnitWrapper.prototype.initAd = function (width, height, viewMode, desiredBitrate, adUnitData, cb) {\n  this.waitForEvent('AdLoaded', cb);\n  this._adUnit.initAd(width, height, viewMode, desiredBitrate, adUnitData);\n};\n\nVPAIDAdUnitWrapper.prototype.resizeAd = function (width, height, viewMode, cb) {\n  // NOTE: AdSizeChange event is only supported on VPAID 2.0 so for the moment we are not going to use it\n  // and will assume that everything is fine after the async call\n  this.adUnitAsyncCall('resizeAd', width, height, viewMode, cb);\n};\n\nVPAIDAdUnitWrapper.prototype.startAd = function (cb) {\n  this.waitForEvent('AdStarted', cb);\n  this._adUnit.startAd();\n};\n\nVPAIDAdUnitWrapper.prototype.stopAd = function (cb) {\n  this.waitForEvent('AdStopped', cb);\n  this._adUnit.stopAd();\n};\n\nVPAIDAdUnitWrapper.prototype.pauseAd = function (cb) {\n  this.waitForEvent('AdPaused', cb);\n  this._adUnit.pauseAd();\n};\n\nVPAIDAdUnitWrapper.prototype.resumeAd = function (cb) {\n  this.waitForEvent('AdPlaying', cb);\n  this._adUnit.resumeAd();\n};\n\nVPAIDAdUnitWrapper.prototype.expandAd = function (cb) {\n  this.waitForEvent('AdExpandedChange', cb);\n  this._adUnit.expandAd();\n};\n\nVPAIDAdUnitWrapper.prototype.collapseAd = function (cb) {\n  this.waitForEvent('AdExpandedChange', cb);\n  this._adUnit.collapseAd();\n};\n\nVPAIDAdUnitWrapper.prototype.skipAd = function (cb) {\n  this.waitForEvent('AdSkipped', cb);\n  this._adUnit.skipAd();\n};\n\n//VPAID property getters\n[\n  'adLinear',\n  'adWidth',\n  'adHeight',\n  'adExpanded',\n  'adSkippableState',\n  'adRemainingTime',\n  'adDuration',\n  'adVolume',\n  'adCompanions',\n  'adIcons'\n].forEach(function (property) {\n  var getterName = 'get' + capitalize(property);\n\n  VPAIDAdUnitWrapper.prototype[getterName] = function (cb) {\n    this.adUnitAsyncCall(getterName, cb);\n  };\n});\n\n//VPAID property setters\nVPAIDAdUnitWrapper.prototype.setAdVolume = function(volume, cb){\n  this.adUnitAsyncCall('setAdVolume',volume, cb);\n};\n","function VPAIDFlashTech(mediaFile, settings) {\n  if (!(this instanceof VPAIDFlashTech)) {\n    return new VPAIDFlashTech(mediaFile);\n  }\n  sanityCheck(mediaFile);\n  this.name = 'vpaid-flash';\n  this.mediaFile = mediaFile;\n  this.containerEl = null;\n  this.vpaidFlashClient = null;\n  this.settings = settings;\n\n  /*** local functions ***/\n  function sanityCheck(mediaFile) {\n    if (!mediaFile || !isString(mediaFile.src)) {\n      throw new VASTError('on VPAIDFlashTech, invalid MediaFile');\n    }\n  }\n}\n\nVPAIDFlashTech.supports = function (type) {\n  return type === 'application/x-shockwave-flash' && VPAIDFLASHClient.isSupported();\n};\n\nVPAIDFlashTech.prototype.loadAdUnit = function loadFlashCreative(containerEl, objectEl, callback) {\n  var that = this;\n  var flashClientOpts = this.settings && this.settings.vpaidFlashLoaderPath ? {data: this.settings.vpaidFlashLoaderPath} : undefined;\n  sanityCheck(containerEl, callback);\n\n  this.containerEl = containerEl;\n  this.vpaidFlashClient = new VPAIDFLASHClient(containerEl, function (error) {\n    if (error) {\n      return callback(error);\n    }\n\n    that.vpaidFlashClient.loadAdUnit(that.mediaFile.src, callback);\n  }, flashClientOpts);\n\n  /*** Local Functions ***/\n  function sanityCheck(container, cb) {\n\n    if (!dom.isDomElement(container)) {\n      throw new VASTError('on VPAIDFlashTech.loadAdUnit, invalid dom container element');\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError('on VPAIDFlashTech.loadAdUnit, missing valid callback');\n    }\n  }\n};\n\nVPAIDFlashTech.prototype.unloadAdUnit = function () {\n  if (this.vpaidFlashClient) {\n    try{\n      this.vpaidFlashClient.destroy();\n    } catch(e){\n      if(console && isFunction(console.log)){\n        console.log('VAST ERROR: trying to unload the VPAID adunit');\n      }\n    }\n    this.vpaidFlashClient = null;\n  }\n\n  if (this.containerEl) {\n    dom.remove(this.containerEl);\n    this.containerEl = null;\n  }\n};\n","function VPAIDHTML5Tech(mediaFile) {\n\n  if(!(this instanceof VPAIDHTML5Tech)) {\n    return new VPAIDHTML5Tech(mediaFile);\n  }\n\n  sanityCheck(mediaFile);\n\n  this.name = 'vpaid-html5';\n  this.containerEl = null;\n  this.videoEl = null;\n  this.vpaidHTMLClient = null;\n\n  this.mediaFile = mediaFile;\n\n  function sanityCheck(mediaFile) {\n      if (!mediaFile || !isString(mediaFile.src)) {\n        throw new VASTError(VPAIDHTML5Tech.INVALID_MEDIA_FILE);\n      }\n  }\n}\n\nVPAIDHTML5Tech.supports = function (type) {\n  return !isOldIE() && type === 'application/javascript';\n};\n\nVPAIDHTML5Tech.prototype.loadAdUnit = function loadAdUnit(containerEl, videoEl, callback) {\n  sanityCheck(containerEl, videoEl, callback);\n\n  this.containerEl = containerEl;\n  this.videoEl = videoEl;\n  this.vpaidHTMLClient = new VPAIDHTML5Client(containerEl, videoEl, {});\n  this.vpaidHTMLClient.loadAdUnit(this.mediaFile.src, callback);\n\n  function sanityCheck(container, video, cb) {\n    if (!dom.isDomElement(container)) {\n      throw new VASTError(VPAIDHTML5Tech.INVALID_DOM_CONTAINER_EL);\n    }\n\n    if (!dom.isDomElement(video) || video.tagName.toLowerCase() !== 'video') {\n      throw new VASTError(VPAIDHTML5Tech.INVALID_DOM_CONTAINER_EL);\n    }\n\n    if (!isFunction(cb)) {\n      throw new VASTError(VPAIDHTML5Tech.MISSING_CALLBACK);\n    }\n  }\n};\n\nVPAIDHTML5Tech.prototype.unloadAdUnit = function unloadAdUnit() {\n  if (this.vpaidHTMLClient) {\n    try {\n      this.vpaidHTMLClient.destroy();\n    } catch(e) {\n      if (console && isFunction(console.log)) {\n        console.log('VAST ERROR: trying to unload the VPAID adunit');\n      }\n    }\n\n    this.vpaidHTMLClient = null;\n  }\n\n  if (this.containerEl) {\n    dom.remove(this.containerEl);\n    this.containerEl = null;\n  }\n};\n\nvar PREFIX = 'on VPAIDHTML5Tech';\nVPAIDHTML5Tech.INVALID_MEDIA_FILE = PREFIX + ', invalid MediaFile';\nVPAIDHTML5Tech.INVALID_DOM_CONTAINER_EL = PREFIX + ', invalid container HtmlElement';\nVPAIDHTML5Tech.INVALID_DOM_VIDEO_EL = PREFIX + ', invalid HTMLVideoElement';\nVPAIDHTML5Tech.MISSING_CALLBACK = PREFIX + ', missing valid callback';\n\n","function VPAIDIntegrator(player, settings) {\n  if (!(this instanceof VPAIDIntegrator)) {\n    return new VPAIDIntegrator(player);\n  }\n\n  this.VIEW_MODE = {\n    NORMAL: 'normal',\n    FULLSCREEN: \"fullscreen\",\n    THUMBNAIL: \"thumbnail\"\n  };\n  this.player = player;\n  this.containerEl = createVPAIDContainerEl(player);\n  this.options = {\n    responseTimeout: 5000,\n    VPAID_VERSION: '2.0'\n  };\n  this.settings = settings;\n\n  /*** Local functions ***/\n\n  function createVPAIDContainerEl() {\n    var containerEl = document.createElement('div');\n    dom.addClass(containerEl, 'VPAID-container');\n    player.el().insertBefore(containerEl, player.controlBar.el());\n    return containerEl;\n\n  }\n}\n\n//List of supported VPAID technologies\nVPAIDIntegrator.techs = [\n  VPAIDFlashTech,\n  VPAIDHTML5Tech\n];\n\nVPAIDIntegrator.prototype.playAd = function playVPaidAd(vastResponse, callback) {\n  var that = this;\n  var tech;\n  var player = this.player;\n\n  callback = callback || noop;\n  if (!(vastResponse instanceof VASTResponse)) {\n    return callback(new VASTError('on VASTIntegrator.playAd, missing required VASTResponse'));\n  }\n\n  tech = this._findSupportedTech(vastResponse, this.settings);\n  dom.addClass(player.el(), 'vjs-vpaid-ad');\n\n  player.on('vast.adsCancel', triggerVpaidAdEnd);\n  player.one('vpaid.adEnd', function(){\n    player.off('vast.adsCancel', triggerVpaidAdEnd);\n    removeAdUnit();\n  });\n\n  if (tech) {\n    async.waterfall([\n      function (next) {\n        next(null, tech, vastResponse);\n      },\n      this._loadAdUnit.bind(this),\n      this._playAdUnit.bind(this),\n      this._finishPlaying.bind(this)\n\n    ], function (error, adUnit, vastResponse) {\n      if (error) {\n        that._trackError(vastResponse);\n      }\n      player.trigger('vpaid.adEnd');\n      callback(error, vastResponse);\n    });\n\n    this._adUnit = {\n      _paused: true,\n      type: 'VPAID',\n      pauseAd: function() {\n        player.trigger('vpaid.pauseAd');\n        player.pause(true);//we make sure that the video content gets stopped.\n      },\n      resumeAd: function() {\n          player.trigger('vpaid.resumeAd');\n      },\n      isPaused: function() {\n        return this._paused;\n      },\n      getSrc: function() {\n        return tech.mediaFile;\n      }\n    };\n\n    return this._adUnit;\n  }\n\n  callback(new VASTError('on VPAIDIntegrator.playAd, could not find a supported mediaFile'));\n\n  return null;\n  /*** Local functions ***/\n  function triggerVpaidAdEnd(){\n    player.trigger('vpaid.adEnd');\n  }\n\n  function removeAdUnit() {\n    if (tech) {\n      tech.unloadAdUnit();\n    }\n    dom.removeClass(player.el(), 'vjs-vpaid-ad');\n  }\n};\n\nVPAIDIntegrator.prototype._findSupportedTech = function (vastResponse, settings) {\n  if (!(vastResponse instanceof VASTResponse)) {\n    return null;\n  }\n\n  var vpaidMediaFiles = vastResponse.mediaFiles.filter(vastUtil.isVPAID);\n  var i, len, mediaFile, VPAIDTech;\n\n  for (i = 0, len = vpaidMediaFiles.length; i < len; i += 1) {\n    mediaFile = vpaidMediaFiles[i];\n    VPAIDTech = findSupportedTech(mediaFile);\n    if (VPAIDTech) {\n      return new VPAIDTech(mediaFile, settings);\n    }\n  }\n\n  return null;\n\n  /*** Local functions ***/\n  function findSupportedTech(mediafile) {\n    var type = mediafile.type;\n    var i, len, VPAIDTech;\n\n    for (i = 0, len = VPAIDIntegrator.techs.length; i < len; i += 1) {\n      VPAIDTech = VPAIDIntegrator.techs[i];\n      if (VPAIDTech.supports(type)) {\n        return VPAIDTech;\n      }\n    }\n    return null;\n  }\n};\n\nVPAIDIntegrator.prototype._loadAdUnit = function (tech, vastResponse, next) {\n  var player = this.player;\n  var vjsTechEl = player.el().querySelector('.vjs-tech');\n  var responseTimeout = this.settings.responseTimeout || this.options.responseTimeout;\n  tech.loadAdUnit(this.containerEl, vjsTechEl, function (error, adUnit) {\n    if (error) {\n      return next(error, adUnit, vastResponse);\n    }\n\n    try {\n      var WrappedAdUnit = new VPAIDAdUnitWrapper(adUnit, {src: tech.mediaFile.src, responseTimeout: responseTimeout});\n      var techClass = 'vjs-' + tech.name + '-ad';\n      dom.addClass(player.el(), techClass);\n      player.one('vpaid.adEnd', function() {\n        dom.removeClass(player.el(),techClass);\n      });\n      next(null, WrappedAdUnit, vastResponse);\n    } catch (e) {\n      next(e, adUnit, vastResponse);\n    }\n  });\n};\n\nVPAIDIntegrator.prototype._playAdUnit = function (adUnit, vastResponse, callback) {\n  async.waterfall([\n    function (next) {\n      next(null, adUnit, vastResponse);\n    },\n    this._handshake.bind(this),\n    this._initAd.bind(this),\n    this._setupEvents.bind(this),\n    this._addSkipButton.bind(this),\n    this._linkPlayerControls.bind(this),\n    this._startAd.bind(this)\n  ], callback);\n};\n\nVPAIDIntegrator.prototype._handshake = function handshake(adUnit, vastResponse, next) {\n  adUnit.handshakeVersion(this.options.VPAID_VERSION, function (error, version) {\n    if (error) {\n      return next(error, adUnit, vastResponse);\n    }\n\n    if (version && isSupportedVersion(version)) {\n      return next(null, adUnit, vastResponse);\n    }\n\n    return next(new VASTError('on VPAIDIntegrator._handshake, unsupported version \"' + version + '\"'), adUnit, vastResponse);\n  });\n\n  function isSupportedVersion(version) {\n    var majorNum = major(version);\n    return majorNum >= 1 && majorNum <= 2;\n  }\n\n  function major(version) {\n    var parts = version.split('.');\n    return parseInt(parts[0], 10);\n  }\n};\n\nVPAIDIntegrator.prototype._initAd = function (adUnit, vastResponse, next) {\n  var tech = this.player.el().querySelector('.vjs-tech');\n  var dimension = dom.getDimension(tech);\n  adUnit.initAd(dimension.width, dimension.height, this.VIEW_MODE.NORMAL, -1, {AdParameters: vastResponse.adParameters || ''}, function (error) {\n    next(error, adUnit, vastResponse);\n  });\n};\n\nVPAIDIntegrator.prototype._setupEvents = function (adUnit, vastResponse, next) {\n  var adUnitSrc = adUnit.options.src;\n  var tracker = new VASTTracker(adUnitSrc, vastResponse);\n  var player = this.player;\n  var that = this;\n\n  adUnit.on('AdSkipped', function () {\n    player.trigger('vpaid.AdSkipped');\n    tracker.trackSkip();\n  });\n\n  adUnit.on('AdImpression', function () {\n    player.trigger('vpaid.AdImpression');\n    tracker.trackImpressions();\n  });\n\n  adUnit.on('AdStarted', function () {\n    player.trigger('vpaid.AdStarted');\n    tracker.trackCreativeView();\n    notifyPlayToPlayer();\n  });\n\n  adUnit.on('AdVideoStart', function () {\n    player.trigger('vpaid.AdVideoStart');\n    tracker.trackStart();\n    notifyPlayToPlayer();\n  });\n\n  adUnit.on('AdPlaying', function () {\n    player.trigger('vpaid.AdPlaying');\n    tracker.trackResume();\n    notifyPlayToPlayer();\n  });\n\n  adUnit.on('AdPaused', function () {\n    player.trigger('vpaid.AdPaused');\n    tracker.trackPause();\n    notifyPauseToPlayer();\n  });\n\n  function notifyPlayToPlayer(){\n    if(that._adUnit && that._adUnit.isPaused()){\n      that._adUnit._paused = false;\n    }\n    player.trigger('play');\n\n  }\n\n  function notifyPauseToPlayer() {\n    if(that._adUnit){\n      that._adUnit._paused = true;\n    }\n    player.trigger('pause');\n  }\n\n  adUnit.on('AdVideoFirstQuartile', function () {\n    player.trigger('vpaid.AdVideoFirstQuartile');\n    tracker.trackFirstQuartile();\n  });\n\n  adUnit.on('AdVideoMidpoint', function () {\n    player.trigger('vpaid.AdVideoMidpoint');\n    tracker.trackMidpoint();\n  });\n\n  adUnit.on('AdVideoThirdQuartile', function () {\n    player.trigger('vpaid.AdVideoThirdQuartile');\n    tracker.trackThirdQuartile();\n  });\n\n  adUnit.on('AdVideoComplete', function () {\n    player.trigger('vpaid.AdVideoComplete');\n    tracker.trackComplete();\n  });\n\n  adUnit.on('AdClickThru', function (data) {\n    player.trigger('vpaid.AdClickThru');\n    var url = data.url;\n    var playerHandles = data.playerHandles;\n    var clickThruUrl = isNotEmptyString(url) ? url : generateClickThroughURL(vastResponse.clickThrough);\n\n    tracker.trackClick();\n    if (playerHandles && clickThruUrl) {\n      window.open(clickThruUrl, '_blank');\n    }\n\n    function generateClickThroughURL(clickThroughMacro) {\n      var variables = {\n        ASSETURI: adUnit.options.src,\n        CONTENTPLAYHEAD: 0 //In VPAID there is no method to know the current time from the adUnit\n      };\n\n      return clickThroughMacro ? vastUtil.parseURLMacro(clickThroughMacro, variables) : null;\n    }\n  });\n\n  adUnit.on('AdUserAcceptInvitation', function () {\n    player.trigger('vpaid.AdUserAcceptInvitation');\n    tracker.trackAcceptInvitation();\n    tracker.trackAcceptInvitationLinear();\n  });\n\n  adUnit.on('AdUserClose', function () {\n    player.trigger('vpaid.AdUserClose');\n    tracker.trackClose();\n    tracker.trackCloseLinear();\n  });\n\n  adUnit.on('AdUserMinimize', function () {\n    player.trigger('vpaid.AdUserMinimize');\n    tracker.trackCollapse();\n  });\n\n  adUnit.on('AdError', function () {\n    player.trigger('vpaid.AdError');\n    //NOTE: we track errors code 901, as noted in VAST 3.0\n    tracker.trackErrorWithCode(901);\n  });\n\n  adUnit.on('AdVolumeChange', function () {\n    player.trigger('vpaid.AdVolumeChange');\n    var lastVolume = player.volume();\n    adUnit.getAdVolume(function (error, currentVolume) {\n      if (currentVolume === 0 && lastVolume > 0) {\n        tracker.trackMute();\n      }\n\n      if (currentVolume > 0 && lastVolume === 0) {\n        tracker.trackUnmute();\n      }\n\n      player.volume(currentVolume);\n    });\n  });\n\n  var updateViewSize = resizeAd.bind(this, player, adUnit, this.VIEW_MODE);\n  var updateViewSizeThrottled = throttle(updateViewSize, 100);\n  var autoResize = this.settings.autoResize;\n\n  if (autoResize) {\n    dom.addEventListener(window, 'resize', updateViewSizeThrottled);\n    dom.addEventListener(window, 'orientationchange', updateViewSizeThrottled);\n  }\n\n  player.on('vast.resize', updateViewSize);\n  player.on('vpaid.pauseAd', pauseAdUnit);\n  player.on('vpaid.resumeAd', resumeAdUnit);\n\n  player.one('vpaid.adEnd', function () {\n    player.off('vast.resize', updateViewSize);\n    player.off('vpaid.pauseAd', pauseAdUnit);\n    player.off('vpaid.resumeAd', resumeAdUnit);\n\n    if (autoResize) {\n      dom.removeEventListener(window, 'resize', updateViewSizeThrottled);\n      dom.removeEventListener(window, 'orientationchange', updateViewSizeThrottled);\n    }\n  });\n\n  next(null, adUnit, vastResponse);\n\n  /*** Local Functions ***/\n  function pauseAdUnit() {\n    adUnit.pauseAd(noop);\n  }\n\n  function resumeAdUnit() {\n    adUnit.resumeAd(noop);\n  }\n};\n\nVPAIDIntegrator.prototype._addSkipButton = function (adUnit, vastResponse, next) {\n  var skipButton;\n  var player = this.player;\n\n  adUnit.on('AdSkippableStateChange', updateSkipButtonState);\n\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeSkipButton);\n\n  next(null, adUnit, vastResponse);\n\n  /*** Local function ***/\n  function updateSkipButtonState() {\n    player.trigger('vpaid.AdSkippableStateChange');\n    adUnit.getAdSkippableState(function (error, isSkippable) {\n      if (isSkippable) {\n        if (!skipButton) {\n          addSkipButton(player);\n        }\n      } else {\n        removeSkipButton(player);\n      }\n    });\n  }\n\n  function addSkipButton(player) {\n    skipButton = createSkipButton(player);\n    player.el().appendChild(skipButton);\n  }\n\n  function removeSkipButton() {\n    dom.remove(skipButton);\n    skipButton = null;\n  }\n\n  function createSkipButton() {\n    var skipButton = window.document.createElement(\"div\");\n    dom.addClass(skipButton, \"vast-skip-button\");\n    dom.addClass(skipButton, \"enabled\");\n    skipButton.innerHTML = \"Skip ad\";\n\n    skipButton.onclick = function (e) {\n      adUnit.skipAd(noop);//We skip the adUnit\n\n      //We prevent event propagation to avoid problems with the clickThrough and so on\n      if (window.Event.prototype.stopPropagation !== undefined) {\n        e.stopPropagation();\n      } else {\n        return false;\n      }\n    };\n\n    return skipButton;\n  }\n};\n\nVPAIDIntegrator.prototype._linkPlayerControls = function (adUnit, vastResponse, next) {\n  linkVolumeControl(this.player, adUnit);\n  linkFullScreenControl(this.player, adUnit, this.VIEW_MODE);\n\n  next(null, adUnit, vastResponse);\n\n  /*** Local functions ***/\n  function linkVolumeControl(player, adUnit) {\n    player.on('volumechange', updateAdUnitVolume);\n    adUnit.on('AdVolumeChange', updatePlayerVolume);\n\n    player.one('vpaid.adEnd', function () {\n      player.off('volumechange', updateAdUnitVolume);\n    });\n\n\n    /*** local functions ***/\n    function updateAdUnitVolume() {\n      var vol = player.muted() ? 0 : player.volume();\n      adUnit.setAdVolume(vol, logError);\n    }\n\n    function updatePlayerVolume() {\n      player.trigger('vpaid.AdVolumeChange');\n      adUnit.getAdVolume(function (error, vol) {\n        if (error) {\n          logError(error);\n        } else {\n          player.volume(vol);\n        }\n      });\n    }\n  }\n\n  function linkFullScreenControl(player, adUnit, VIEW_MODE) {\n    var updateViewSize = resizeAd.bind(this, player, adUnit, VIEW_MODE);\n\n    player.on('fullscreenchange', updateViewSize);\n\n    player.one('vpaid.adEnd', function () {\n      player.off('fullscreenchange', updateViewSize);\n    });\n  }\n};\n\nVPAIDIntegrator.prototype._startAd = function (adUnit, vastResponse, next) {\n  var player = this.player;\n\n  adUnit.startAd(function (error) {\n    if (!error) {\n      player.trigger('vast.adStart');\n    }\n    next(error, adUnit, vastResponse);\n  });\n};\n\nVPAIDIntegrator.prototype._finishPlaying = function (adUnit, vastResponse, next) {\n  var player = this.player;\n  adUnit.on('AdStopped', function () {\n   player.trigger('vpaid.AdStopped');\n   finishPlayingAd(null);\n  });\n\n  adUnit.on('AdError', function (error) {\n    var errMsg = error? error.message : 'on VPAIDIntegrator, error while waiting for the adUnit to finish playing';\n    finishPlayingAd(new VASTError(errMsg));\n  });\n\n  /*** local functions ***/\n  function finishPlayingAd(error) {\n    next(error, adUnit, vastResponse);\n  }\n};\n\nVPAIDIntegrator.prototype._trackError = function trackError(response) {\n  vastUtil.track(response.errorURLMacros, {ERRORCODE: 901});\n};\n\nfunction resizeAd(player, adUnit, VIEW_MODE) {\n  var tech = player.el().querySelector('.vjs-tech');\n  var dimension = dom.getDimension(tech);\n  var MODE = player.isFullscreen() ? VIEW_MODE.FULLSCREEN : VIEW_MODE.NORMAL;\n  adUnit.resizeAd(dimension.width, dimension.height, MODE, logError);\n}\n\nfunction logError(error) {\n  if (error && console && console.log) {\n    console.log('ERROR: ' + error.message, error);\n  }\n}\n","function Ad(adJTree) {\n  if (!(this instanceof Ad)) {\n    return new Ad(adJTree);\n  }\n\n  this.id = adJTree.attr('id');\n  this.sequence = adJTree.attr('sequence');\n\n  if(adJTree.inLine) {\n    this.inLine = new InLine(adJTree.inLine);\n  }\n\n  if(adJTree.wrapper){\n    this.wrapper = new Wrapper(adJTree.wrapper);\n  }\n}","\nfunction Creative(creativeJTree) {\n  if(!(this instanceof Creative)) {\n    return new Creative(creativeJTree);\n  }\n\n  this.id = creativeJTree.attr('id');\n  this.sequence = creativeJTree.attr('sequence');\n  this.adId = creativeJTree.attr('adId');\n  this.apiFramework = creativeJTree.attr('apiFramework');\n\n  if(creativeJTree.linear) {\n    this.linear = new Linear(creativeJTree.linear);\n  }\n}","function InLine(inlineJTree) {\n  if (!(this instanceof InLine)) {\n    return new InLine(inlineJTree);\n  }\n\n  //Required Fields\n  this.adTitle = xml.keyValue(inlineJTree.adTitle);\n  this.adSystem = xml.keyValue(inlineJTree.adSystem);\n  this.impressions = vastUtil.parseImpressions(inlineJTree.impression);\n  this.creatives = vastUtil.parseCreatives(inlineJTree.creatives);\n\n  //Optional Fields\n  this.description = xml.keyValue(inlineJTree.description);\n  this.advertiser = xml.keyValue(inlineJTree.advertiser);\n  this.surveys = parseSurveys(inlineJTree.survey);\n  this.error = xml.keyValue(inlineJTree.error);\n  this.pricing = xml.keyValue(inlineJTree.pricing);\n  this.extensions = inlineJTree.extensions;\n\n  /*** Local Functions ***/\n  function parseSurveys(inlineSurveys) {\n    if (inlineSurveys) {\n      return transformArray(isArray(inlineSurveys) ? inlineSurveys : [inlineSurveys], function (survey) {\n        if(isNotEmptyString(survey.keyValue)){\n          return {\n            uri: survey.keyValue,\n            type: survey.attr('type')\n          };\n        }\n\n        return undefined;\n      });\n    }\n    return [];\n  }\n}","function Linear(linearJTree) {\n  if (!(this instanceof Linear)) {\n    return new Linear(linearJTree);\n  }\n\n  //Required Elements\n  this.duration = vastUtil.parseDuration(xml.keyValue(linearJTree.duration));\n  this.mediaFiles = parseMediaFiles(linearJTree.mediaFiles && linearJTree.mediaFiles.mediaFile);\n\n  //Optional fields\n  this.trackingEvents = parseTrackingEvents(linearJTree.trackingEvents && linearJTree.trackingEvents.tracking, this.duration);\n  this.skipoffset = vastUtil.parseOffset(xml.attr(linearJTree, 'skipoffset'), this.duration);\n\n  if (linearJTree.videoClicks) {\n    this.videoClicks = new VideoClicks(linearJTree.videoClicks);\n  }\n  \n  if(linearJTree.adParameters) {\n    this.adParameters = xml.keyValue(linearJTree.adParameters);\n\n    if(xml.attr(linearJTree.adParameters, 'xmlEncoded')){\n      this.adParameters = xml.decode(this.adParameters);\n    }\n  }\n\n  /*** Local functions ***/\n  function parseTrackingEvents(trackingEvents, duration) {\n    var trackings = [];\n    if (isDefined(trackingEvents)) {\n      trackingEvents = isArray(trackingEvents) ? trackingEvents : [trackingEvents];\n      trackingEvents.forEach(function (trackingData) {\n        trackings.push(new TrackingEvent(trackingData, duration));\n      });\n    }\n    return trackings;\n  }\n\n  function parseMediaFiles(mediaFilesJxonTree) {\n    var mediaFiles = [];\n    if (isDefined(mediaFilesJxonTree)) {\n      mediaFilesJxonTree = isArray(mediaFilesJxonTree) ? mediaFilesJxonTree : [mediaFilesJxonTree];\n\n      mediaFilesJxonTree.forEach(function (mfData) {\n        mediaFiles.push(new MediaFile(mfData));\n      });\n    }\n    return mediaFiles;\n  }\n}","function MediaFile(mediaFileJTree) {\n  if (!(this instanceof MediaFile)) {\n    return new MediaFile(mediaFileJTree);\n  }\n\n  //Required attributes\n  this.src = xml.keyValue(mediaFileJTree);\n  this.delivery = mediaFileJTree.attr('delivery');\n  this.type = mediaFileJTree.attr('type');\n  this.width = mediaFileJTree.attr('width');\n  this.height = mediaFileJTree.attr('height');\n\n  //Optional attributes\n  this.codec = mediaFileJTree.attr('codec');\n  this.id = mediaFileJTree.attr('id');\n  this.bitrate = mediaFileJTree.attr('bitrate');\n  this.minBitrate = mediaFileJTree.attr('minBitrate');\n  this.maxBitrate = mediaFileJTree.attr('maxBitrate');\n  this.scalable = mediaFileJTree.attr('scalable');\n  this.maintainAspectRatio = mediaFileJTree.attr('maintainAspectRatio');\n  this.apiFramework = mediaFileJTree.attr('apiFramework');\n}","function TrackingEvent(trackingJTree, duration) {\n  if (!(this instanceof TrackingEvent)) {\n    return new TrackingEvent(trackingJTree, duration);\n  }\n\n  this.name = trackingJTree.attr('event');\n  this.uri = xml.keyValue(trackingJTree);\n\n  if('progress' === this.name) {\n    this.offset = vastUtil.parseOffset(trackingJTree.attr('offset'), duration);\n  }\n}\n","function VASTClient(options) {\n  if (!(this instanceof VASTClient)) {\n    return new VASTClient(options);\n  }\n  var defaultOptions = {\n    WRAPPER_LIMIT: 5\n  };\n\n  options = options || {};\n  this.settings = extend({}, options, defaultOptions);\n  this.errorURLMacros = [];\n}\n\nVASTClient.prototype.getVASTResponse = function getVASTResponse(adTagUrl, callback) {\n  var that = this;\n\n  var error = sanityCheck(adTagUrl, callback);\n  if (error) {\n    if (isFunction(callback)) {\n      return callback(error);\n    }\n    throw error;\n  }\n\n  async.waterfall([\n      this._getVASTAd.bind(this, adTagUrl),\n      buildVASTResponse\n    ],\n    callback);\n\n  /*** Local functions ***/\n  function buildVASTResponse(adsChain, cb) {\n    try {\n      var response = that._buildVASTResponse(adsChain);\n      cb(null, response);\n    } catch (e) {\n      cb(e);\n    }\n  }\n\n  function sanityCheck(adTagUrl, cb) {\n    if (!adTagUrl) {\n      return new VASTError('on VASTClient.getVASTResponse, missing ad tag URL');\n    }\n\n    if (!isFunction(cb)) {\n      return new VASTError('on VASTClient.getVASTResponse, missing callback function');\n    }\n  }\n};\n\nVASTClient.prototype._getVASTAd = function (adTagUrl, callback) {\n  var that = this;\n\n  getAdWaterfall(adTagUrl, function (error, vastTree) {\n    var waterfallAds = vastTree && isArray(vastTree.ads) ? vastTree.ads : null;\n    if (error) {\n      that._trackError(error, waterfallAds);\n      return callback(error, waterfallAds);\n    }\n\n    getAd(waterfallAds.shift(), [], waterfallHandler);\n\n    /*** Local functions ***/\n    function waterfallHandler(error, adChain) {\n      if (error) {\n        that._trackError(error, adChain);\n        if (waterfallAds.length > 0) {\n          getAd(waterfallAds.shift(),[], waterfallHandler);\n        } else {\n          callback(error, adChain);\n        }\n      } else {\n        callback(null, adChain);\n      }\n    }\n  });\n\n  /*** Local functions ***/\n  function getAdWaterfall(adTagUrl, callback) {\n    var requestVastXML = that._requestVASTXml.bind(that, adTagUrl);\n    async.waterfall([\n      requestVastXML,\n      buildVastWaterfall\n    ], callback);\n  }\n\n  function buildVastWaterfall(xmlStr, callback) {\n    var vastTree;\n    try {\n      vastTree = xml.toJXONTree(xmlStr);\n      vastTree.ads = isArray(vastTree.ad) ? vastTree.ad : [vastTree.ad];\n      callback(validateVASTTree(vastTree), vastTree);\n    } catch (e) {\n      callback(new VASTError(\"on VASTClient.getVASTAd.buildVastWaterfall, error parsing xml\", 100), null);\n    }\n  }\n\n  function validateVASTTree(vastTree) {\n    var vastVersion = xml.attr(vastTree, 'version');\n\n    if (!vastTree.ad) {\n      return new VASTError('on VASTClient.getVASTAd.validateVASTTree, no Ad in VAST tree', 303);\n    }\n\n    if (vastVersion && (vastVersion != 3 && vastVersion != 2)) {\n      return new VASTError('on VASTClient.getVASTAd.validateVASTTree, not supported VAST version \"' + vastVersion + '\"', 102);\n    }\n\n    return null;\n  }\n\n  function getAd(adTagUrl, adChain, callback) {\n    if (adChain.length >= that.WRAPPER_LIMIT) {\n      return callback(new VASTError(\"on VASTClient.getVASTAd.getAd, players wrapper limit reached (the limit is \" + that.WRAPPER_LIMIT + \")\", 302), adChain);\n    }\n\n    async.waterfall([\n      function (next) {\n        if (isString(adTagUrl)) {\n          requestVASTAd(adTagUrl, next);\n        } else {\n          next(null, adTagUrl);\n        }\n      },\n      buildAd\n    ], function (error, ad) {\n      if (ad) {\n        adChain.push(ad);\n      }\n\n      if (error) {\n        return callback(error, adChain);\n      }\n\n      if (ad.wrapper) {\n        return getAd(ad.wrapper.VASTAdTagURI, adChain, callback);\n      }\n\n      return callback(null, adChain);\n    });\n  }\n\n  function buildAd(adJxonTree, callback) {\n    try {\n      var ad = new Ad(adJxonTree);\n      callback(validateAd(ad), ad);\n    } catch (e) {\n      callback(new VASTError('on VASTClient.getVASTAd.buildAd, error parsing xml', 100), null);\n    }\n  }\n\n  function validateAd(ad) {\n    var wrapper = ad.wrapper;\n    var inLine = ad.inLine;\n    var errMsgPrefix = 'on VASTClient.getVASTAd.validateAd, ';\n\n    if (inLine && wrapper) {\n      return new VASTError(errMsgPrefix +\"InLine and Wrapper both found on the same Ad\", 101);\n    }\n\n    if (!inLine && !wrapper) {\n      return new VASTError(errMsgPrefix + \"nor wrapper nor inline elements found on the Ad\", 101);\n    }\n\n    if (inLine && inLine.creatives.length === 0) {\n      return new VASTError(errMsgPrefix + \"missing creative in InLine element\", 101);\n    }\n\n    if (wrapper && !wrapper.VASTAdTagURI) {\n      return new VASTError(errMsgPrefix + \"missing 'VASTAdTagURI' in wrapper\", 101);\n    }\n  }\n\n  function requestVASTAd(adTagUrl, callback) {\n    that._requestVASTXml(adTagUrl, function (error, xmlStr) {\n      if (error) {\n        return callback(error);\n      }\n      try {\n        var vastTree = xml.toJXONTree(xmlStr);\n        callback(validateVASTTree(vastTree), vastTree.ad);\n      } catch (e) {\n        callback(new VASTError(\"on VASTClient.getVASTAd.requestVASTAd, error parsing xml\", 100));\n      }\n    });\n  }\n};\n\nVASTClient.prototype._requestVASTXml = function requestVASTXml(adTagUrl, callback) {\n  try {\n    if (isFunction(adTagUrl)) {\n      adTagUrl(requestHandler);\n    } else {\n      http.get(adTagUrl, requestHandler, {\n        withCredentials: true\n      });\n    }\n  } catch (e) {\n    callback(e);\n  }\n\n  /*** Local functions ***/\n  function requestHandler(error, response, status) {\n    if (error) {\n      var errMsg = isDefined(status) ?\n      \"on VASTClient.requestVastXML, HTTP request error with status '\" + status + \"'\" :\n        \"on VASTClient.requestVastXML, Error getting the the VAST XML with he passed adTagXML fn\";\n      return callback(new VASTError(errMsg, 301), null);\n    }\n\n    callback(null, response);\n  }\n};\n\nVASTClient.prototype._buildVASTResponse = function buildVASTResponse(adsChain) {\n  var response = new VASTResponse();\n  addAdsToResponse(response, adsChain);\n  validateResponse(response);\n\n  return response;\n\n  //*** Local function ****\n  function addAdsToResponse(response, ads) {\n    ads.forEach(function (ad) {\n      response.addAd(ad);\n    });\n  }\n\n  function validateResponse(response) {\n    var progressEvents = response.trackingEvents.progress;\n\n    if (!response.hasLinear()) {\n      throw new VASTError(\"on VASTClient._buildVASTResponse, Received an Ad type that is not supported\", 200);\n    }\n\n    if (response.duration === undefined) {\n      throw new VASTError(\"on VASTClient._buildVASTResponse, Missing duration field in VAST response\", 101);\n    }\n\n    if (progressEvents) {\n      progressEvents.forEach(function (progressEvent) {\n        if (!isNumber(progressEvent.offset)) {\n          throw new VASTError(\"on VASTClient._buildVASTResponse, missing or wrong offset attribute on progress tracking event\", 101);\n        }\n      });\n    }\n  }\n};\n\nVASTClient.prototype._trackError = function (error, adChain) {\n  if (!isArray(adChain) || adChain.length === 0) { //There is nothing to track\n    return;\n  }\n\n  var errorURLMacros = [];\n  adChain.forEach(addErrorUrlMacros);\n  vastUtil.track(errorURLMacros, {ERRORCODE: error.code || 900});  //900 <== Undefined error\n\n  /*** Local functions  ***/\n  function addErrorUrlMacros(ad) {\n    if (ad.wrapper && ad.wrapper.error) {\n      errorURLMacros.push(ad.wrapper.error);\n    }\n\n    if (ad.inLine && ad.inLine.error) {\n      errorURLMacros.push(ad.inLine.error);\n    }\n  }\n};\n","var VAST = {};\n\nfunction VASTError(message, code) {\n  this.message = 'VAST Error: ' + (message || '');\n  if (code) {\n    this.code = code;\n  }\n}\n\nVASTError.prototype = new Error();\nVASTError.prototype.name = \"VAST Error\";","/**\n * Inner helper class that deals with the logic of the individual steps needed to setup an ad in the player.\n *\n * @param player {object} instance of the player that will play the ad. It assumes that the videojs-contrib-ads plugin\n *                        has been initialized when you use its utility functions.\n *\n * @constructor\n */\nfunction VASTIntegrator(player) {\n  if (!(this instanceof VASTIntegrator)) {\n    return new VASTIntegrator(player);\n  }\n\n  this.player = player;\n}\n\nVASTIntegrator.prototype.playAd = function playAd(vastResponse, callback) {\n  var that = this;\n  callback = callback || noop;\n\n  if (!(vastResponse instanceof VASTResponse)) {\n    return callback(new VASTError('On VASTIntegrator, missing required VASTResponse'));\n  }\n\n  async.waterfall([\n    function (next) {\n      next(null, vastResponse);\n    },\n    this._selectAdSource.bind(this),\n    this._createVASTTracker.bind(this),\n    this._addClickThrough.bind(this),\n    this._addSkipButton.bind(this),\n    this._setupEvents.bind(this),\n    this._playSelectedAd.bind(this)\n  ], function (error, response) {\n    if (error && response) {\n      that._trackError(error, response);\n    }\n    callback(error, response);\n  });\n\n  this._adUnit = {\n    _src: null,\n    type: 'VAST',\n    pauseAd: function () {\n      that.player.pause(true);\n    },\n\n    resumeAd: function () {\n      that.player.play(true);\n    },\n\n    isPaused: function () {\n      return that.player.paused(true);\n    },\n\n    getSrc: function () {\n      return this._src;\n    }\n  };\n\n  return this._adUnit;\n};\n\nVASTIntegrator.prototype._selectAdSource = function selectAdSource(response, callback) {\n  var source;\n\n  var playerWidth = dom.getDimension(this.player.el()).width;\n  response.mediaFiles.sort(function compareTo(a, b) {\n    var deltaA = Math.abs(playerWidth - a.width);\n    var deltaB = Math.abs(playerWidth - b.width);\n    return deltaA - deltaB;\n  });\n\n  source = this.player.selectSource(response.mediaFiles).source;\n\n  if (source) {\n    if (this._adUnit) {\n      this._adUnit._src = source;\n    }\n    return callback(null, source, response);\n  }\n\n  // code 403 <== Couldn't find MediaFile that is supported by this video player\n  callback(new VASTError(\"Could not find Ad mediafile supported by this player\", 403), response);\n};\n\nVASTIntegrator.prototype._createVASTTracker = function createVASTTracker(adMediaFile, response, callback) {\n  try {\n    callback(null, adMediaFile, new VASTTracker(adMediaFile.src, response), response);\n  } catch (e) {\n    callback(e, response);\n  }\n};\n\nVASTIntegrator.prototype._setupEvents = function setupEvents(adMediaFile, tracker, response, callback) {\n  var previouslyMuted;\n  var player = this.player;\n  player.on('fullscreenchange', trackFullscreenChange);\n  player.on('vast.adStart', trackImpressions);\n  player.on('pause', trackPause);\n  player.on('timeupdate', trackProgress);\n  player.on('volumechange', trackVolumeChange);\n\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], unbindEvents);\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel', 'vast.adSkip'], function(evt){\n    if(evt.type === 'vast.adEnd'){\n      tracker.trackComplete();\n    }\n  });\n\n  return callback(null, adMediaFile, response);\n\n  /*** Local Functions ***/\n  function unbindEvents() {\n    player.off('fullscreenchange', trackFullscreenChange);\n    player.off('vast.adStart', trackImpressions);\n    player.off('pause', trackPause);\n    player.off('timeupdate', trackProgress);\n    player.off('volumechange', trackVolumeChange);\n  }\n\n  function trackFullscreenChange() {\n    if (player.isFullscreen()) {\n      tracker.trackFullscreen();\n    } else {\n      tracker.trackExitFullscreen();\n    }\n  }\n\n  function trackPause() {\n    //NOTE: whenever a video ends the video Element triggers a 'pause' event before the 'ended' event.\n    //      We should not track this pause event because it makes the VAST tracking confusing again we use a\n    //      Threshold of 2 seconds to prevent false positives on IOS.\n    if (Math.abs(player.duration() - player.currentTime()) < 2) {\n      return;\n    }\n\n    tracker.trackPause();\n    playerUtils.once(player, ['play', 'vast.adEnd', 'vast.adsCancel'], function (evt) {\n      if(evt.type === 'play'){\n        tracker.trackResume();\n      }\n    });\n  }\n\n  function trackProgress() {\n    var currentTimeInMs = player.currentTime() * 1000;\n    tracker.trackProgress(currentTimeInMs);\n  }\n\n  function trackImpressions() {\n    tracker.trackImpressions();\n    tracker.trackCreativeView();\n  }\n\n  function trackVolumeChange() {\n    var muted = player.muted();\n    if (muted) {\n      tracker.trackMute();\n    } else if (previouslyMuted) {\n      tracker.trackUnmute();\n    }\n    previouslyMuted = muted;\n  }\n};\n\nVASTIntegrator.prototype._addSkipButton = function addSkipButton(source, tracker, response, callback) {\n  var skipOffsetInSec;\n\n  if (isNumber(response.skipoffset)) {\n    skipOffsetInSec = response.skipoffset / 1000;\n    addSkipButtonToPlayer(this.player, skipOffsetInSec);\n  }\n  callback(null, source, tracker, response);\n\n  /*** Local function ***/\n  function addSkipButtonToPlayer(player, skipOffset) {\n    var skipButton = createSkipButton(player);\n    var updateSkipButton = updateSkipButtonState.bind(this, skipButton, skipOffset, player);\n\n    player.el().appendChild(skipButton);\n    player.on('timeupdate', updateSkipButton);\n\n    playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeSkipButton);\n\n    function removeSkipButton() {\n      player.off('timeupdate', updateSkipButton);\n      dom.remove(skipButton);\n    }\n  }\n\n  function createSkipButton(player) {\n    var skipButton = window.document.createElement(\"div\");\n    dom.addClass(skipButton, \"vast-skip-button\");\n\n    skipButton.onclick = function (e) {\n      if (dom.hasClass(skipButton, 'enabled')) {\n        tracker.trackSkip();\n        player.trigger('vast.adSkip');\n      }\n\n      //We prevent event propagation to avoid problems with the clickThrough and so on\n      if (window.Event.prototype.stopPropagation !== undefined) {\n        e.stopPropagation();\n      } else {\n        return false;\n      }\n    };\n\n    return skipButton;\n  }\n\n  function updateSkipButtonState(skipButton, skipOffset, player) {\n    var timeLeft = Math.ceil(skipOffset - player.currentTime());\n    if (timeLeft > 0) {\n      skipButton.innerHTML = \"Skip in \" + toFixedDigits(timeLeft, 2) + \"...\";\n    } else {\n      if (!dom.hasClass(skipButton, 'enabled')) {\n        dom.addClass(skipButton, 'enabled');\n        skipButton.innerHTML = \"Skip ad\";\n      }\n    }\n  }\n};\n\nVASTIntegrator.prototype._addClickThrough = function addClickThrough(mediaFile, tracker, response, callback) {\n  var player = this.player;\n  var blocker = createClickThroughBlocker(player, tracker, response);\n  var updateBlocker = updateBlockerURL.bind(this, blocker, response, player);\n\n  player.el().insertBefore(blocker, player.controlBar.el());\n  player.on('timeupdate', updateBlocker);\n  playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeBlocker);\n\n  return callback(null, mediaFile, tracker, response);\n\n  /*** Local Functions ***/\n\n  function createClickThroughBlocker(player, tracker, response) {\n    var blocker = window.document.createElement(\"a\");\n    var clickThroughMacro = response.clickThrough;\n\n    dom.addClass(blocker, 'vast-blocker');\n    blocker.href = generateClickThroughURL(clickThroughMacro, player);\n\n    if (isString(clickThroughMacro)) {\n      blocker.target = \"_blank\";\n    }\n\n    blocker.onclick = function (e) {\n      if (player.paused()) {\n        player.play();\n\n        //We prevent event propagation to avoid problems with the player's normal pause mechanism\n        if (window.Event.prototype.stopPropagation !== undefined) {\n          e.stopPropagation();\n        }\n        return false;\n      }\n\n      player.pause();\n      tracker.trackClick();\n    };\n\n    return blocker;\n  }\n\n  function updateBlockerURL(blocker, response, player) {\n    blocker.href = generateClickThroughURL(response.clickThrough, player);\n  }\n\n  function generateClickThroughURL(clickThroughMacro, player) {\n    var variables = {\n      ASSETURI: mediaFile.src,\n      CONTENTPLAYHEAD: vastUtil.formatProgress(player.currentTime() * 1000)\n    };\n\n    return clickThroughMacro ? vastUtil.parseURLMacro(clickThroughMacro, variables) : '#';\n  }\n\n  function removeBlocker() {\n    player.off('timeupdate', updateBlocker);\n    dom.remove(blocker);\n  }\n};\n\nVASTIntegrator.prototype._playSelectedAd = function playSelectedAd(source, response, callback) {\n  var player = this.player;\n\n  player.preload(\"auto\"); //without preload=auto the durationchange event is never fired\n  player.src(source);\n\n  playerUtils.once(player, ['durationchange', 'error', 'vast.adsCancel'], function (evt) {\n    if (evt.type === 'durationchange') {\n      playAd();\n    } else if(evt.type === 'error') {\n      callback(new VASTError(\"on VASTIntegrator, Player is unable to play the Ad\", 400), response);\n    }\n    //NOTE: If the ads get canceled we do nothing/\n  });\n\n  /**** local functions ******/\n  function playAd() {\n    player.play();\n    playerUtils.once(player, ['playing', 'vast.adsCancel'], function (evt) {\n      if(evt.type === 'vast.adsCancel'){\n        return;\n      }\n\n      player.trigger('vast.adStart');\n\n      playerUtils.once(player, ['ended', 'vast.adsCancel', 'vast.adSkip'], function (evt) {\n        if(evt.type === 'ended' || evt.type === 'vast.adSkip'){\n          callback(null, response);\n        }\n        //NOTE: if the ads get cancel we do nothing\n      });\n    });\n  }\n};\n\nVASTIntegrator.prototype._trackError = function trackError(error, response) {\n  vastUtil.track(response.errorURLMacros, {ERRORCODE: error.code || 900});\n};\n","function VASTTracker(assetURI, vastResponse) {\n  if (!(this instanceof VASTTracker)) {\n    return new VASTTracker(assetURI, vastResponse);\n  }\n\n  sanityCheck(assetURI, vastResponse);\n  this.response = vastResponse;\n  this.assetURI = assetURI;\n  this.progress = 0;\n  this.quartiles = {\n    firstQuartile: {tracked: false, time: Math.round(25 * vastResponse.duration) / 100},\n    midpoint: {tracked: false, time: Math.round(50 * vastResponse.duration) / 100},\n    thirdQuartile: {tracked: false, time: Math.round(75 * vastResponse.duration) / 100}\n  };\n\n  /*** Local Functions ***/\n  function sanityCheck(assetURI, vastResponse) {\n    if (!isString(assetURI) || isEmptyString(assetURI)) {\n      throw new VASTError('on VASTTracker constructor, missing required the URI of the ad asset being played');\n    }\n\n    if (!(vastResponse instanceof VASTResponse)) {\n      throw new VASTError('on VASTTracker constructor, missing required VAST response');\n    }\n  }\n}\n\nVASTTracker.prototype.trackURLs = function trackURLs(urls, variables) {\n  if (isArray(urls) && urls.length > 0) {\n    variables = extend({\n      ASSETURI: this.assetURI,\n      CONTENTPLAYHEAD: vastUtil.formatProgress(this.progress)\n    }, variables || {});\n\n    vastUtil.track(urls, variables);\n  }\n};\n\nVASTTracker.prototype.trackEvent = function trackEvent(eventName, trackOnce) {\n  this.trackURLs(getEventUris(this.response.trackingEvents[eventName]));\n  if (trackOnce) {\n    this.response.trackingEvents[eventName] = undefined;\n  }\n\n  /*** Local function ***/\n  function getEventUris(trackingEvents) {\n    var uris;\n\n    if (trackingEvents) {\n      uris = [];\n      trackingEvents.forEach(function (event) {\n        uris.push(event.uri);\n      });\n    }\n    return uris;\n  }\n};\n\nVASTTracker.prototype.trackProgress = function trackProgress(newProgressInMs) {\n  var events = [];\n  var ONCE = true;\n  var ALWAYS = false;\n  var trackingEvents = this.response.trackingEvents;\n\n  if (isNumber(newProgressInMs)) {\n    addTrackEvent('start', ONCE, newProgressInMs > 0);\n    addTrackEvent('rewind', ALWAYS, hasRewound(this.progress, newProgressInMs));\n    addQuartileEvents.call(this, newProgressInMs);\n    trackProgressEvents.call(this, newProgressInMs);\n    trackEvents.call(this);\n    this.progress = newProgressInMs;\n  }\n\n  /*** Local function ***/\n  function hasRewound(currentProgress, newProgress) {\n    var REWIND_THRESHOLD = 3000; //IOS video clock is very unreliable and we need a 3 seconds threshold to ensure that there was a rewind an that it was on purpose.\n    return currentProgress > newProgressInMs && Math.abs(newProgress - currentProgress) > REWIND_THRESHOLD;\n  }\n\n  function addTrackEvent(eventName, trackOnce, canBeAdded) {\n    if (trackingEvents[eventName] && canBeAdded) {\n      events.push({\n        name: eventName,\n        trackOnce: !!trackOnce\n      });\n    }\n  }\n\n  function addQuartileEvents(progress) {\n    var quartiles = this.quartiles;\n    var firstQuartile = this.quartiles.firstQuartile;\n    var midpoint = this.quartiles.midpoint;\n    var thirdQuartile = this.quartiles.thirdQuartile;\n\n    if (!firstQuartile.tracked) {\n      trackQuartile('firstQuartile', progress);\n    } else if (!midpoint.tracked) {\n      trackQuartile('midpoint', progress);\n    } else {\n      trackQuartile('thirdQuartile', progress);\n    }\n\n    /*** Local function ***/\n    function trackQuartile(quartileName, progress){\n      var quartile = quartiles[quartileName];\n      if(canBeTracked(quartile, progress)){\n        quartile.tracked = true;\n        addTrackEvent(quartileName, ONCE, true);\n      }\n    }\n  }\n\n  function canBeTracked(quartile, progress) {\n    var quartileTime = quartile.time;\n    //We only fire the quartile event if the progress is bigger than the quartile time by 5 seconds at most.\n    return progress >= quartileTime && progress <= (quartileTime + 5000);\n  }\n\n  function trackProgressEvents(progress) {\n    if (!isArray(trackingEvents.progress)) {\n      return; //Nothing to track\n    }\n\n    var pendingProgressEvts = [];\n    var that = this;\n\n    trackingEvents.progress.forEach(function (evt) {\n      if (evt.offset <= progress) {\n        that.trackURLs([evt.uri]);\n      } else {\n        pendingProgressEvts.push(evt);\n      }\n    });\n    trackingEvents.progress = pendingProgressEvts;\n  }\n\n  function trackEvents() {\n    events.forEach(function (event) {\n      this.trackEvent(event.name, event.trackOnce);\n    }, this);\n  }\n};\n\n[\n  'rewind',\n  'fullscreen',\n  'exitFullscreen',\n  'pause',\n  'resume',\n  'mute',\n  'unmute',\n  'acceptInvitation',\n  'acceptInvitationLinear',\n  'collapse',\n  'expand'\n].forEach(function (eventName) {\n    VASTTracker.prototype['track' + capitalize(eventName)] = function () {\n      this.trackEvent(eventName);\n    };\n  });\n\n[\n  'start',\n  'skip',\n  'close',\n  'closeLinear'\n].forEach(function (eventName) {\n    VASTTracker.prototype['track' + capitalize(eventName)] = function () {\n      this.trackEvent(eventName, true);\n    };\n  });\n\n[\n  'firstQuartile',\n  'midpoint',\n  'thirdQuartile'\n].forEach(function (quartile) {\n    VASTTracker.prototype['track' + capitalize(quartile)] = function () {\n      this.quartiles[quartile].tracked = true;\n      this.trackEvent(quartile, true);\n    };\n  });\n\nVASTTracker.prototype.trackComplete = function () {\n  if(this.quartiles.thirdQuartile.tracked){\n    this.trackEvent('complete', true);\n  }\n};\n\nVASTTracker.prototype.trackErrorWithCode = function trackErrorWithCode(errorcode) {\n  if (isNumber(errorcode)) {\n    this.trackURLs(this.response.errorURLMacros, {ERRORCODE: errorcode});\n  }\n};\n\nVASTTracker.prototype.trackImpressions = function trackImpressions() {\n  this.trackURLs(this.response.impressions);\n};\n\nVASTTracker.prototype.trackCreativeView = function trackCreativeView() {\n  this.trackEvent('creativeView');\n};\n\nVASTTracker.prototype.trackClick = function trackClick() {\n  this.trackURLs(this.response.clickTrackings);\n};\n","function VideoClicks(videoClickJTree) {\n  if (!(this instanceof VideoClicks)) {\n    return new VideoClicks(videoClickJTree);\n  }\n\n  this.clickThrough = xml.keyValue(videoClickJTree.clickThrough);\n  this.clickTrackings = parseClickTrackings(videoClickJTree.clickTracking);\n  this.customClicks = parseClickTrackings(videoClickJTree.customClick);\n\n  /*** Local functions ***/\n  function parseClickTrackings(trackingData) {\n    var clickTrackings = [];\n    if (trackingData) {\n      trackingData = isArray(trackingData) ? trackingData : [trackingData];\n      trackingData.forEach(function (clickTrackingData) {\n        clickTrackings.push(xml.keyValue(clickTrackingData));\n      });\n    }\n    return clickTrackings;\n  }\n}","function Wrapper(wrapperJTree) {\n  if(!(this instanceof Wrapper)) {\n    return new Wrapper(wrapperJTree);\n  }\n\n  //Required elements\n  this.adSystem = xml.keyValue(wrapperJTree.adSystem);\n  this.impressions = vastUtil.parseImpressions(wrapperJTree.impression);\n  this.VASTAdTagURI = xml.keyValue(wrapperJTree.vASTAdTagURI);\n\n  //Optional elements\n  this.creatives = vastUtil.parseCreatives(wrapperJTree.creatives);\n  this.error = xml.keyValue(wrapperJTree.error);\n  this.extensions = wrapperJTree.extensions;\n\n  //Optional attrs\n  this.followAdditionalWrappers = isDefined(xml.attr(wrapperJTree, 'followAdditionalWrappers'))? xml.attr(wrapperJTree, 'followAdditionalWrappers'): true;\n  this.allowMultipleAds = xml.attr(wrapperJTree, 'allowMultipleAds');\n  this.fallbackOnNoAd = xml.attr(wrapperJTree, 'fallbackOnNoAd');\n}\n\n\n","//Small subset of async\nvar async = {};\n\nasync.setImmediate = function (fn) {\n  setTimeout(fn, 0);\n};\n\nasync.iterator = function (tasks) {\n  var makeCallback = function (index) {\n    var fn = function () {\n      if (tasks.length) {\n        tasks[index].apply(null, arguments);\n      }\n      return fn.next();\n    };\n    fn.next = function () {\n      return (index < tasks.length - 1) ? makeCallback(index + 1) : null;\n    };\n    return fn;\n  };\n  return makeCallback(0);\n};\n\n\nasync.waterfall = function (tasks, callback) {\n  callback = callback || function () { };\n  if (!isArray(tasks)) {\n    var err = new Error('First argument to waterfall must be an array of functions');\n    return callback(err);\n  }\n  if (!tasks.length) {\n    return callback();\n  }\n  var wrapIterator = function (iterator) {\n    return function (err) {\n      if (err) {\n        callback.apply(null, arguments);\n        callback = function () {\n        };\n      }\n      else {\n        var args = Array.prototype.slice.call(arguments, 1);\n        var next = iterator.next();\n        if (next) {\n          args.push(wrapIterator(next));\n        }\n        else {\n          args.push(callback);\n        }\n        async.setImmediate(function () {\n          iterator.apply(null, args);\n        });\n      }\n    };\n  };\n  wrapIterator(async.iterator(tasks))();\n};\n\nasync.when = function (condition, callback) {\n  if (!isFunction(callback)) {\n    throw new Error(\"async.when error: missing callback argument\");\n  }\n\n  var isAllowed = isFunction(condition) ? condition : function () {\n    return !!condition;\n  };\n\n  return function () {\n    var args = arrayLikeObjToArray(arguments);\n    var next = args.pop();\n\n    if (isAllowed.apply(null, args)) {\n      return callback.apply(this, arguments);\n    }\n\n    args.unshift(null);\n    return next.apply(null, args);\n  };\n};\n\n\n","\"use strict\";\n\nvar dom = {};\n\ndom.isVisible = function isVisible(el) {\n  var style = window.getComputedStyle(el);\n  return style.visibility !== 'hidden';\n};\n\ndom.isHidden = function isHidden(el) {\n  var style = window.getComputedStyle(el);\n  return style.display === 'none';\n};\n\ndom.isShown = function isShown(el) {\n  return !dom.isHidden(el);\n};\n\ndom.hide = function hide(el) {\n  el.__prev_style_display_ = el.style.display;\n  el.style.display = 'none';\n};\n\ndom.show = function show(el) {\n  if (dom.isHidden(el)) {\n    el.style.display = el.__prev_style_display_;\n  }\n  el.__prev_style_display_ = undefined;\n};\n\ndom.hasClass = function hasClass(el, cssClass) {\n  var classes, i, len;\n\n  if (isNotEmptyString(cssClass)) {\n    if (el.classList) {\n      return el.classList.contains(cssClass);\n    }\n\n    classes = isString(el.getAttribute('class')) ? el.getAttribute('class').split(/\\s+/) : [];\n    cssClass = (cssClass || '');\n\n    for (i = 0, len = classes.length; i < len; i += 1) {\n      if (classes[i] === cssClass) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\ndom.addClass = function (el, cssClass) {\n  var classes;\n\n  if (isNotEmptyString(cssClass)) {\n    if (el.classList) {\n      return el.classList.add(cssClass);\n    }\n\n    classes = isString(el.getAttribute('class')) ? el.getAttribute('class').split(/\\s+/) : [];\n    if (isString(cssClass) && isNotEmptyString(cssClass.replace(/\\s+/, ''))) {\n      classes.push(cssClass);\n      el.setAttribute('class', classes.join(' '));\n    }\n  }\n};\n\ndom.removeClass = function (el, cssClass) {\n  var classes;\n\n  if (isNotEmptyString(cssClass)) {\n    if (el.classList) {\n      return el.classList.remove(cssClass);\n    }\n\n    classes = isString(el.getAttribute('class')) ? el.getAttribute('class').split(/\\s+/) : [];\n    var newClasses = [];\n    var i, len;\n    if (isString(cssClass) && isNotEmptyString(cssClass.replace(/\\s+/, ''))) {\n\n      for (i = 0, len = classes.length; i < len; i += 1) {\n        if (cssClass !== classes[i]) {\n          newClasses.push(classes[i]);\n        }\n      }\n      el.setAttribute('class', newClasses.join(' '));\n    }\n  }\n};\n\ndom.addEventListener = function addEventListener(el, type, handler) {\n  if(isArray(el)){\n    forEach(el, function(e) {\n      dom.addEventListener(e, type, handler);\n    });\n    return;\n  }\n\n  if(isArray(type)){\n    forEach(type, function(t) {\n      dom.addEventListener(el, t, handler);\n    });\n    return;\n  }\n\n  if (el.addEventListener) {\n    el.addEventListener(type, handler, false);\n  } else if (el.attachEvent) {\n    // WARNING!!! this is a very naive implementation !\n    // the event object that should be passed to the handler\n    // would not be there for IE8\n    // we should use \"window.event\" and then \"event.srcElement\"\n    // instead of \"event.target\"\n    el.attachEvent(\"on\" + type, handler);\n  }\n};\n\ndom.removeEventListener = function removeEventListener(el, type, handler) {\n  if(isArray(el)){\n    forEach(el, function(e) {\n      dom.removeEventListener(e, type, handler);\n    });\n    return;\n  }\n\n  if(isArray(type)){\n    forEach(type, function(t) {\n      dom.removeEventListener(el, t, handler);\n    });\n    return;\n  }\n\n  if (el.removeEventListener) {\n    el.removeEventListener(type, handler, false);\n  } else if (el.detachEvent) {\n    el.detachEvent(\"on\" + type, handler);\n  } else {\n    el[\"on\" + type] = null;\n  }\n};\n\ndom.dispatchEvent = function dispatchEvent(el, event) {\n  if (el.dispatchEvent) {\n    el.dispatchEvent(event);\n  } else {\n    el.fireEvent(\"on\" + event.eventType, event);\n  }\n};\n\ndom.isDescendant = function isDescendant(parent, child) {\n  var node = child.parentNode;\n  while (node !== null) {\n    if (node === parent) {\n      return true;\n    }\n    node = node.parentNode;\n  }\n  return false;\n};\n\ndom.getTextContent = function getTextContent(el){\n  return el.textContent || el.text;\n};\n\ndom.prependChild = function prependChild(parent, child) {\n  if(child.parentNode){\n    child.parentNode.removeChild(child);\n  }\n  return parent.insertBefore(child, parent.firstChild);\n};\n\ndom.remove = function removeNode(node){\n  if(node && node.parentNode){\n    node.parentNode.removeChild(node);\n  }\n};\n\ndom.isDomElement = function isDomElement(o) {\n  return o instanceof Element;\n};\n\ndom.click = function(el, handler) {\n  dom.addEventListener(el, 'click', handler);\n};\n\ndom.once = function(el, type, handler) {\n  function handlerWrap() {\n    handler.apply(null, arguments);\n    dom.removeEventListener(el, type, handlerWrap);\n  }\n\n  dom.addEventListener(el, type, handlerWrap);\n};\n\n//Note: there is no getBoundingClientRect on iPad so we need a fallback\ndom.getDimension = function getDimension(element) {\n  var rect;\n\n  //On IE9 and below getBoundingClientRect does not work consistently\n  if(!isOldIE() && element.getBoundingClientRect) {\n    rect = element.getBoundingClientRect();\n    return {\n      width: rect.width,\n      height: rect.height\n    };\n  }\n\n  return {\n    width: element.offsetWidth,\n    height: element.offsetHeight\n  };\n};\n","var playerUtils = {};\n\n/**\n * Returns an object that captures the portions of player state relevant to\n * video playback. The result of this function can be passed to\n * restorePlayerSnapshot with a player to return the player to the state it\n * was in when this function was invoked.\n * @param {object} player The videojs player object\n */\nplayerUtils.getPlayerSnapshot = function getPlayerSnapshot(player) {\n  var tech = player.el().querySelector('.vjs-tech');\n  var snapshot = {\n    ended: player.ended(),\n    src: player.currentSrc(),\n    currentTime: player.currentTime(),\n    type: player.currentType(),\n    playing: !player.paused(),\n    suppressedTracks: getSuppressedTracks(player)\n  };\n\n  if (tech) {\n    snapshot.nativePoster = tech.poster;\n    snapshot.style = tech.getAttribute('style');\n  }\n\n  return snapshot;\n\n  /**** Local Functions ****/\n  function getSuppressedTracks(player) {\n    var tracks = player.remoteTextTracks ? player.remoteTextTracks() : [];\n\n    if (tracks && isArray(tracks.tracks_)) {\n      tracks = tracks.tracks_;\n    }\n\n    if (!isArray(tracks)) {\n      tracks = [];\n    }\n\n    var suppressedTracks = [];\n    tracks.forEach(function (track) {\n      suppressedTracks.push({\n        track: track,\n        mode: track.mode\n      });\n      track.mode = 'disabled';\n    });\n\n    return suppressedTracks;\n  }\n};\n\n/**\n * Attempts to modify the specified player so that its state is equivalent to\n * the state of the snapshot.\n * @param {object} snapshot - the player state to apply\n */\nplayerUtils.restorePlayerSnapshot = function restorePlayerSnapshot(player, snapshot) {\n  var tech = player.el().querySelector('.vjs-tech');\n  var attempts = 20; // the number of remaining attempts to restore the snapshot\n\n  if (snapshot.nativePoster) {\n    tech.poster = snapshot.nativePoster;\n  }\n\n  if ('style' in snapshot) {\n    // overwrite all css style properties to restore state precisely\n    tech.setAttribute('style', snapshot.style || '');\n  }\n\n  if (hasSrcChanged(player, snapshot)) {\n    // on ios7, fiddling with textTracks too early will cause safari to crash\n    player.one('contentloadedmetadata', restoreTracks);\n\n    player.one('canplay', tryToResume);\n    ensureCanplayEvtGetsFired();\n\n    // if the src changed for ad playback, reset it\n    player.src({src: snapshot.src, type: snapshot.type});\n\n    // safari requires a call to `load` to pick up a changed source\n    player.load();\n\n  } else {\n    restoreTracks();\n\n    if (snapshot.playing) {\n      player.play();\n    }\n  }\n\n  /*** Local Functions ***/\n\n  /**\n   * Sometimes firefox does not trigger the 'canplay' evt.\n   * This code ensure that it always gets triggered triggered.\n   */\n  function ensureCanplayEvtGetsFired() {\n    var timeoutId = setTimeout(function() {\n      player.trigger('canplay');\n    }, 1000);\n\n    player.one('canplay', function(){\n      clearTimeout(timeoutId);\n    });\n  }\n\n  /**\n   * Determine whether the player needs to be restored to its state\n   * before ad playback began. With a custom ad display or burned-in\n   * ads, the content player state hasn't been modified and so no\n   * restoration is required\n   */\n  function hasSrcChanged(player, snapshot) {\n    if (player.src()) {\n      return player.src() !== snapshot.src;\n    }\n    // the player was configured through source element children\n    return player.currentSrc() !== snapshot.src;\n  }\n\n  function restoreTracks() {\n    var suppressedTracks = snapshot.suppressedTracks;\n    suppressedTracks.forEach(function (trackSnapshot) {\n      trackSnapshot.track.mode = trackSnapshot.mode;\n    });\n  }\n\n  /**\n   * Determine if the video element has loaded enough of the snapshot source\n   * to be ready to apply the rest of the state\n   */\n  function tryToResume() {\n    if (playerUtils.isReadyToResume(tech)) {\n      // if some period of the video is seekable, resume playback\n      return resume();\n    }\n\n    // delay a bit and then check again unless we're out of attempts\n    if (attempts--) {\n      setTimeout(tryToResume, 50);\n    } else {\n      (function () {\n        try {\n          resume();\n        } catch (e) {\n          videojs.log.warn('Failed to resume the content after an advertisement', e);\n        }\n      })();\n    }\n\n\n    /*** Local functions ***/\n    function resume() {\n      player.currentTime(snapshot.currentTime);\n\n      if (snapshot.playing) {\n        player.play();\n      }\n    }\n\n  }\n};\n\nplayerUtils.isReadyToResume = function (tech) {\n  if (tech.readyState > 1) {\n    // some browsers and media aren't \"seekable\".\n    // readyState greater than 1 allows for seeking without exceptions\n    return true;\n  }\n\n  if (tech.seekable === undefined) {\n    // if the tech doesn't expose the seekable time ranges, try to\n    // resume playback immediately\n    return true;\n  }\n\n  if (tech.seekable.length > 0) {\n    // if some period of the video is seekable, resume playback\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * This function prepares the player to display ads.\n * Adding convenience events like the 'vast.firsPlay' that gets fired when the video is first played\n * and ads the blackPoster to the player to prevent content from being displayed before the preroll ad.\n *\n * @param player\n */\nplayerUtils.prepareForAds = function (player) {\n  var blackPoster = player.addChild('blackPoster');\n  var _firstPlay = true;\n  var volumeSnapshot;\n\n\n  monkeyPatchPlayerApi();\n\n  player.on('play', tryToTriggerFirstPlay);\n  player.on('vast.reset', resetFirstPlay);//Every time we change the sources we reset the first play.\n  player.on('vast.firstPlay', restoreContentVolume);\n  player.on('error', hideBlackPoster);//If there is an error in the player we remove the blackposter to show the err msg\n  player.on('vast.adStart', hideBlackPoster);\n  player.on('vast.adsCancel', hideBlackPoster);\n  player.on('vast.adError', hideBlackPoster);\n  player.on('vast.adStart', addStyles);\n  player.on('vast.adEnd', removeStyles);\n  player.on('vast.adsCancel', removeStyles);\n\n  /*** Local Functions ***/\n\n  /**\n   What this function does is ugly and horrible and I should think twice before calling myself a good developer. With that said,\n   it is the best solution I could find to mute the video until the 'play' event happens (on mobile devices) and the plugin can decide whether\n   to play the ad or not.\n\n   We also need this monkeypatch to be able to pause and resume an ad using the player's API\n\n   If you have a better solution please do tell me.\n   */\n  function monkeyPatchPlayerApi() {\n\n    /**\n     * Monkey patch needed to handle firstPlay and resume of playing ad.\n     *\n     * @param callOrigPlay necessary flag to prevent infinite loop when you are restoring a VAST ad.\n     * @returns {player}\n     */\n    var origPlay = player.play;\n    player.play = function (callOrigPlay) {\n      if (isFirstPlay()) {\n        firstPlay.call(this);\n      } else {\n        resume.call(this, callOrigPlay);\n      }\n\n      return this;\n\n      /*** local functions ***/\n      function firstPlay() {\n        if (!isIPhone()) {\n          volumeSnapshot = saveVolumeSnapshot();\n          player.muted(true);\n        }\n\n        origPlay.apply(this, arguments);\n      }\n\n      function resume(callOrigPlay) {\n        if (isAdPlaying() && !callOrigPlay) {\n          player.vast.adUnit.resumeAd();\n        } else {\n          origPlay.apply(this, arguments);\n        }\n      }\n    };\n\n\n    /**\n     * Needed monkey patch to handle pause of playing ad.\n     *\n     * @param callOrigPlay necessary flag to prevent infinite loop when you are pausing a VAST ad.\n     * @returns {player}\n     */\n    var origPause = player.pause;\n    player.pause = function (callOrigPause) {\n      if (isAdPlaying() && !callOrigPause) {\n        player.vast.adUnit.pauseAd();\n      } else {\n        origPause.apply(this, arguments);\n      }\n      return this;\n    };\n\n\n    /**\n     * Needed monkey patch to handle paused state of the player when ads are playing.\n     *\n     * @param callOrigPlay necessary flag to prevent infinite loop when you are pausing a VAST ad.\n     * @returns {player}\n     */\n    var origPaused = player.paused;\n    player.paused = function (callOrigPaused) {\n      if (isAdPlaying() && !callOrigPaused) {\n        return player.vast.adUnit.isPaused();\n      }\n      return origPaused.apply(this, arguments);\n    };\n  }\n\n  function isAdPlaying() {\n    return player.vast && player.vast.adUnit;\n  }\n\n  function tryToTriggerFirstPlay() {\n    if (isFirstPlay()) {\n      _firstPlay = false;\n      player.trigger('vast.firstPlay');\n    }\n  }\n\n  function resetFirstPlay() {\n    _firstPlay = true;\n    blackPoster.show();\n    restoreContentVolume();\n  }\n\n  function isFirstPlay() {\n    return _firstPlay;\n  }\n\n  function saveVolumeSnapshot() {\n    return {\n      muted: player.muted(),\n      volume: player.volume()\n    };\n  }\n\n  function restoreContentVolume() {\n    if (volumeSnapshot) {\n      player.currentTime(0);\n      restoreVolumeSnapshot(volumeSnapshot);\n      volumeSnapshot = null;\n    }\n  }\n\n  function restoreVolumeSnapshot(snapshot) {\n    if (isObject(snapshot)) {\n      player.volume(snapshot.volume);\n      player.muted(snapshot.muted);\n    }\n  }\n\n  function hideBlackPoster() {\n    if (!dom.hasClass(blackPoster.el(), 'vjs-hidden')) {\n      blackPoster.hide();\n    }\n  }\n\n  function addStyles() {\n    dom.addClass(player.el(), 'vjs-ad-playing');\n  }\n\n  function removeStyles() {\n    dom.removeClass(player.el(), 'vjs-ad-playing');\n  }\n};\n\n/**\n * Remove the poster attribute from the video element tech, if present. When\n * reusing a video element for multiple videos, the poster image will briefly\n * reappear while the new source loads. Removing the attribute ahead of time\n * prevents the poster from showing up between videos.\n * @param {object} player The videojs player object\n */\nplayerUtils.removeNativePoster = function (player) {\n  var tech = player.el().querySelector('.vjs-tech');\n  if (tech) {\n    tech.removeAttribute('poster');\n  }\n};\n\n/**\n * Helper function to listen to many events until one of them gets fired, then we\n * execute the handler and unsubscribe all the event listeners;\n *\n * @param player specific player from where to listen for the events\n * @param events array of events\n * @param handler function to execute once one of the events fires\n */\nplayerUtils.once = function once(player, events, handler) {\n  function listener() {\n    handler.apply(null, arguments);\n\n    events.forEach(function (event) {\n      player.off(event, listener);\n    });\n  }\n\n  events.forEach(function (event) {\n    player.on(event, listener);\n  });\n};\n","var xml = {};\n\nxml.strToXMLDoc = function strToXMLDoc(stringContainingXMLSource){\n  //IE 8\n  if(typeof window.DOMParser === 'undefined'){\n    var xmlDocument = new ActiveXObject('Microsoft.XMLDOM');\n    xmlDocument.async = false;\n    xmlDocument.loadXML(stringContainingXMLSource);\n    return xmlDocument;\n  }\n\n  return parseString(stringContainingXMLSource);\n\n  function parseString(stringContainingXMLSource){\n    var parser = new DOMParser();\n    var parsedDocument;\n\n    //Note: This try catch is to deal with the fact that on IE parser.parseFromString does throw an error but the rest of the browsers don't.\n    try {\n      parsedDocument = parser.parseFromString(stringContainingXMLSource, \"application/xml\");\n\n      if(isParseError(parsedDocument) || isEmptyString(stringContainingXMLSource)){\n        throw new Error();\n      }\n    }catch(e){\n      throw new Error(\"xml.strToXMLDOC: Error parsing the string: '\" + stringContainingXMLSource + \"'\");\n    }\n\n    return parsedDocument;\n  }\n\n  function isParseError(parsedDocument) {\n    try { // parser and parsererrorNS could be cached on startup for efficiency\n      var parser = new DOMParser(),\n        errorneousParse = parser.parseFromString('INVALID', 'text/xml'),\n        parsererrorNS = errorneousParse.getElementsByTagName(\"parsererror\")[0].namespaceURI;\n\n      if (parsererrorNS === 'http://www.w3.org/1999/xhtml') {\n        // In PhantomJS the parseerror element doesn't seem to have a special namespace, so we are just guessing here :(\n        return parsedDocument.getElementsByTagName(\"parsererror\").length > 0;\n      }\n\n      return parsedDocument.getElementsByTagNameNS(parsererrorNS, 'parsererror').length > 0;\n    } catch (e) {\n      //Note on IE parseString throws an error by itself and it will never reach this code. Because it will have failed before\n    }\n  }\n};\n\nxml.parseText = function parseText (sValue) {\n  if (/^\\s*$/.test(sValue)) { return null; }\n  if (/^(?:true|false)$/i.test(sValue)) { return sValue.toLowerCase() === \"true\"; }\n  if (isFinite(sValue)) { return parseFloat(sValue); }\n  if (isISO8601(sValue)) { return new Date(sValue); }\n  return sValue.trim();\n};\n\nxml.JXONTree = function JXONTree (oXMLParent) {\n  var parseText = xml.parseText;\n\n  //The document object is an especial object that it may miss some functions or attrs depending on the browser.\n  //To prevent this problem with create the JXONTree using the root childNode which is a fully fleshed node on all supported\n  //browsers.\n  if(oXMLParent.documentElement){\n    return new xml.JXONTree(oXMLParent.documentElement);\n  }\n\n  if (oXMLParent.hasChildNodes()) {\n    var sCollectedTxt = \"\";\n    for (var oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {\n      oNode = oXMLParent.childNodes.item(nItem);\n      /*jshint bitwise: false*/\n      if ((oNode.nodeType - 1 | 1) === 3) { sCollectedTxt += oNode.nodeType === 3 ? oNode.nodeValue.trim() : oNode.nodeValue; }\n      else if (oNode.nodeType === 1 && !oNode.prefix) {\n        sProp = decapitalize(oNode.nodeName);\n        vContent = new xml.JXONTree(oNode);\n        if (this.hasOwnProperty(sProp)) {\n          if (this[sProp].constructor !== Array) { this[sProp] = [this[sProp]]; }\n          this[sProp].push(vContent);\n        } else { this[sProp] = vContent; }\n      }\n    }\n    if (sCollectedTxt) { this.keyValue = parseText(sCollectedTxt); }\n  }\n\n  //IE8 Stupid fix\n  var hasAttr = typeof oXMLParent.hasAttributes === 'undefined'? oXMLParent.attributes.length > 0: oXMLParent.hasAttributes();\n  if (hasAttr) {\n    var oAttrib;\n    for (var nAttrib = 0; nAttrib < oXMLParent.attributes.length; nAttrib++) {\n      oAttrib = oXMLParent.attributes.item(nAttrib);\n      this[\"@\" + decapitalize(oAttrib.name)] = parseText(oAttrib.value.trim());\n    }\n  }\n};\n\nxml.JXONTree.prototype.attr = function(attr) {\n  return this['@' + decapitalize(attr)];\n};\n\nxml.toJXONTree = function toJXONTree(xmlString){\n  var xmlDoc = xml.strToXMLDoc(xmlString);\n  return new xml.JXONTree(xmlDoc);\n};\n\n/**\n * Helper function to extract the keyvalue of a JXONTree obj\n *\n * @param xmlObj {JXONTree}\n * return the key value or undefined;\n */\nxml.keyValue = function getKeyValue(xmlObj) {\n  if(xmlObj){\n    return xmlObj.keyValue;\n  }\n  return undefined;\n};\n\nxml.attr = function getAttrValue(xmlObj, attr) {\n  if(xmlObj) {\n    return xmlObj['@' + decapitalize(attr)];\n  }\n  return undefined;\n};\n\nxml.encode = function encodeXML(str) {\n  return str.replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&apos;');\n};\n\nxml.decode = function decodeXML(str) {\n  return str.replace(/&apos;/g, \"'\")\n    .replace(/&quot;/g, '\"')\n    .replace(/&gt;/g, '>')\n    .replace(/&lt;/g, '<')\n    .replace(/&amp;/g, '&');\n};","videojs.plugin('vastClient', function VASTPlugin(options) {\n  var snapshot;\n  var player = this;\n  var vast = new VASTClient();\n  var adsCanceled = false;\n  var defaultOpts = {\n    // maximum amount of time in ms to wait to receive `adsready` from the ad\n    // implementation after play has been requested. Ad implementations are\n    // expected to load any dynamic libraries and make any requests to determine\n    // ad policies for a video during this time.\n    timeout: 500,\n\n    //TODO:finish this IOS FIX\n    //Whenever you play an add on IOS, the native player kicks in and we loose control of it. On very heavy pages the 'play' event\n    // May occur after the video content has already started. This is wrong if you want to play a preroll ad that needs to happen before the user\n    // starts watching the content. To prevent this usec\n    iosPrerollCancelTimeout: 2000,\n\n    // maximun amount of time for the ad to actually start playing. If this timeout gets\n    // triggered the ads will be cancelled\n    adCancelTimeout: 3000,\n\n    // Boolean flag that configures the player to play a new ad before the user sees the video again\n    // the current video\n    playAdAlways: false,\n\n    // Flag to enable or disable the ads by default.\n    adsEnabled: true,\n\n    // Boolean flag to enable or disable the resize with window.resize or orientationchange\n    autoResize: true,\n\n    // Path to the VPAID flash ad's loader\n    vpaidFlashLoaderPath: '/VPAIDFlash.swf'\n  };\n\n  var settings = extend({}, defaultOpts, options || {});\n\n  if(isUndefined(settings.adTagUrl) && isDefined(settings.url)){\n    settings.adTagUrl = settings.url;\n  }\n\n  if (isString(settings.adTagUrl)) {\n    settings.adTagUrl = echoFn(settings.adTagUrl);\n  }\n\n  if (isDefined(settings.adTagXML) && !isFunction(settings.adTagXML)) {\n    return trackAdError(new VASTError('on VideoJS VAST plugin, the passed adTagXML option does not contain a function'));\n  }\n\n  if (!isDefined(settings.adTagUrl) && !isFunction(settings.adTagXML)) {\n    return trackAdError(new VASTError('on VideoJS VAST plugin, missing adTagUrl on options object'));\n  }\n\n  playerUtils.prepareForAds(player);\n\n  if (settings.playAdAlways) {\n    // No matter what happens we play a new ad before the user sees the video again.\n    player.on('vast.contentEnd', function () {\n      setTimeout(function () {\n        player.trigger('vast.reset');\n      }, 0);\n    });\n  }\n\n  player.on('vast.firstPlay', tryToPlayPrerollAd);\n\n  player.on('vast.reset', function () {\n    //If we are reseting the plugin, we don't want to restore the content\n    snapshot = null;\n    cancelAds();\n  });\n\n  player.vast = {\n    isEnabled: function () {\n      return settings.adsEnabled;\n    },\n\n    enable: function () {\n      settings.adsEnabled = true;\n    },\n\n    disable: function () {\n      settings.adsEnabled = false;\n    }\n  };\n\n  return player.vast;\n\n  /**** Local functions ****/\n  function tryToPlayPrerollAd() {\n    //We remove the poster to prevent flickering whenever the content starts playing\n    playerUtils.removeNativePoster(player);\n\n    playerUtils.once(player, ['vast.adsCancel', 'vast.adEnd'], function () {\n      removeAdUnit();\n      restoreVideoContent();\n    });\n\n    async.waterfall([\n      checkAdsEnabled,\n      preparePlayerForAd,\n      playPrerollAd\n    ], function (error, response) {\n      if (error) {\n        trackAdError(error, response);\n      } else {\n        player.trigger('vast.adEnd');\n      }\n    });\n\n    /*** Local functions ***/\n\n    function removeAdUnit() {\n      if (player.vast && player.vast.adUnit) {\n        player.vast.adUnit = null; //We remove the adUnit\n      }\n    }\n\n    function restoreVideoContent() {\n      setupContentEvents();\n      if (snapshot) {\n        playerUtils.restorePlayerSnapshot(player, snapshot);\n        snapshot = null;\n      }\n    }\n\n    function setupContentEvents() {\n      playerUtils.once(player, ['playing', 'vast.reset', 'vast.firstPlay'], function (evt) {\n        if (evt.type !== 'playing') {\n          return;\n        }\n\n        player.trigger('vast.contentStart');\n\n        playerUtils.once(player, ['ended', 'vast.reset', 'vast.firstPlay'], function (evt) {\n          if (evt.type === 'ended') {\n            player.trigger('vast.contentEnd');\n          }\n        });\n      });\n    }\n\n    function checkAdsEnabled(next) {\n      if (settings.adsEnabled) {\n        return next(null);\n      }\n      next(new VASTError('Ads are not enabled'));\n    }\n\n    function preparePlayerForAd(next) {\n      if (canPlayPrerollAd()) {\n        snapshot = playerUtils.getPlayerSnapshot(player);\n        player.pause();\n        addSpinnerIcon();\n        startAdCancelTimeout();\n        next(null);\n      } else {\n        next(new VASTError('video content has been playing before preroll ad'));\n      }\n    }\n\n    function canPlayPrerollAd() {\n      return !isIPhone() || player.currentTime() <= settings.iosPrerollCancelTimeout;\n    }\n\n    function startAdCancelTimeout() {\n      var adCancelTimeoutId;\n      adsCanceled = false;\n\n      adCancelTimeoutId = setTimeout(function () {\n        trackAdError(new VASTError('timeout while waiting for the video to start playing', 402));\n      }, settings.adCancelTimeout);\n\n      playerUtils.once(player, ['vast.adStart', 'vast.adsCancel'], clearAdCancelTimeout);\n\n      /*** local functions ***/\n      function clearAdCancelTimeout() {\n        if (adCancelTimeoutId) {\n          clearTimeout(adCancelTimeoutId);\n          adCancelTimeoutId = null;\n        }\n      }\n    }\n\n    function addSpinnerIcon() {\n      dom.addClass(player.el(), 'vjs-vast-ad-loading');\n      playerUtils.once(player, ['vast.adStart', 'vast.adsCancel'], removeSpinnerIcon);\n    }\n\n    function removeSpinnerIcon() {\n      //IMPORTANT NOTE: We remove the spinnerIcon asynchronously to give time to the browser to start the video.\n      // If we remove it synchronously we see a flash of the content video before the ad starts playing.\n      setTimeout(function () {\n        dom.removeClass(player.el(), 'vjs-vast-ad-loading');\n      }, 100);\n    }\n\n  }\n\n  function cancelAds() {\n    player.trigger('vast.adsCancel');\n    adsCanceled = true;\n  }\n\n  function playPrerollAd(callback) {\n    async.waterfall([\n      getVastResponse,\n      playAd\n    ], callback);\n  }\n\n  function getVastResponse(callback) {\n    vast.getVASTResponse(settings.adTagUrl ? settings.adTagUrl() : settings.adTagXML, callback);\n  }\n\n  function playAd(vastResponse, callback) {\n    //TODO: Find a better way to stop the play. The 'playPrerollWaterfall' ends in an inconsistent situation\n    //If the state is not 'preroll?' it means the ads were canceled therefore, we break the waterfall\n    if (adsCanceled) {\n      return;\n    }\n\n    var adIntegrator = isVPAID(vastResponse) ? new VPAIDIntegrator(player, settings) : new VASTIntegrator(player);\n    var adFinished = false;\n\n    playerUtils.once(player, ['vast.adStart', 'vast.adsCancel'], function (evt) {\n      if (evt.type === 'vast.adStart') {\n        addAdsLabel();\n      }\n    });\n\n    playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel'], removeAdsLabel);\n\n    if (isIDevice()) {\n      preventManualProgress();\n    }\n\n    player.vast.adUnit = adIntegrator.playAd(vastResponse, callback);\n\n    /*** Local functions ****/\n    function addAdsLabel() {\n      if (adFinished || player.controlBar.getChild('AdsLabel')) {\n        return;\n      }\n      player.controlBar.addChild('AdsLabel');\n    }\n\n    function removeAdsLabel() {\n      player.controlBar.removeChild('AdsLabel');\n      adFinished = true;\n    }\n\n    function preventManualProgress() {\n      //IOS video clock is very unreliable and we need a 3 seconds threshold to ensure that the user forwarded/rewound the ad\n      var PROGRESS_THRESHOLD = 3;\n      var previousTime = 0;\n      var tech = player.el().querySelector('.vjs-tech');\n      var skipad_attempts = 0;\n\n      player.on('timeupdate', adTimeupdateHandler);\n      playerUtils.once(player, ['vast.adEnd', 'vast.adsCancel', 'vast.adError'], stopPreventManualProgress);\n\n      /*** Local functions ***/\n      function adTimeupdateHandler() {\n        var currentTime = player.currentTime();\n        var progressDelta = Math.abs(currentTime - previousTime);\n\n        if (progressDelta > PROGRESS_THRESHOLD) {\n          skipad_attempts += 1;\n          if (skipad_attempts >= 2) {\n            player.pause();\n          }\n          player.currentTime(previousTime);\n        } else {\n          previousTime = currentTime;\n        }\n      }\n\n      function stopPreventManualProgress() {\n        player.off('timeupdate', adTimeupdateHandler);\n      }\n    }\n  }\n\n  function trackAdError(error, vastResponse) {\n    player.trigger({type: 'vast.adError', error: error});\n    cancelAds();\n    if (console && console.log) {\n      console.log('AD ERROR:', error.message, error, vastResponse);\n    }\n  }\n\n  function isVPAID(vastResponse) {\n    var i, len;\n    var mediaFiles = vastResponse.mediaFiles;\n    for (i = 0, len = mediaFiles.length; i < len; i++) {\n      if (vastUtil.isVPAID(mediaFiles[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n});\n","var vjsComponent = videojs.getComponent('Component');\nvar AdsLabel = videojs.extend(vjsComponent, {\n  /** @constructor */\n  constructor: function (player, options) {\n    vjsComponent.call(this, player, options);\n\n    var that = this;\n\n    // We asynchronously reposition the ads label element\n    setTimeout(function () {\n      var currentTimeComp = player.controlBar &&( player.controlBar.getChild(\"timerControls\") || player.controlBar.getChild(\"currentTimeDisplay\") );\n      if(currentTimeComp) {\n        player.controlBar.el().insertBefore(that.el(), currentTimeComp.el());\n      }\n      dom.removeClass(that.el(), 'vjs-label-hidden');\n    }, 0);\n  }\n});\n\nAdsLabel.prototype.createEl = function(){\n  return vjsComponent.prototype.createEl.call(this, 'div', {\n    className: 'vjs-ads-label vjs-control vjs-label-hidden',\n    innerHTML: 'Advertisement'\n  });\n};\n\nvideojs.registerComponent('AdsLabel', AdsLabel);\n","var vjsComponent = videojs.getComponent('Component');\n/**\n * The component that shows a black screen until the ads plugin has decided if it can or it can not play the ad.\n *\n * Note: In case you wonder why instead of this black poster we don't just show the spinner loader.\n *       IOS devices do not work well with animations and the browser chrashes from time to time That is why we chose to\n *       have a secondary black poster.\n *\n *       It also makes it much more easier for the users of the plugin since it does not change the default behaviour of the\n *       spinner and the player works the same way with and without the plugin.\n *\n * @param {vjs.Player|Object} player\n * @param {Object=} options\n * @constructor\n */\nvar BlackPoster = videojs.extend(vjsComponent, {\n  /** @constructor */\n  constructor: function(player, options){\n    vjsComponent.call(this, player, options);\n\n    var posterImg = player.getChild('posterImage');\n\n    //We need to do it asynchronously to be sure that the black poster el is on the dom.\n    setTimeout(function() {\n      if(posterImg) {\n        player.el().insertBefore(this.el(), posterImg.el());\n      }\n    }.bind(this), 0);\n  }\n});\n\n/**\n * Create the black poster div element\n * @return {Element}\n */\nBlackPoster.prototype.createEl = function(){\n  return vjsComponent.prototype.createEl.call(this, 'div', {\n    className: 'vjs-black-poster'\n  });\n};\n\nvideojs.registerComponent('BlackPoster', BlackPoster);","(function (window) {\n  \"use strict\";\n\n\n  function VASTResponse() {\n    if (!(this instanceof VASTResponse)) {\n      return new VASTResponse();\n    }\n\n    this._linearAdded = false;\n    this.ads = [];\n    this.errorURLMacros = [];\n    this.impressions = [];\n    this.clickTrackings = [];\n    this.customClicks = [];\n    this.trackingEvents = {};\n    this.mediaFiles = [];\n    this.clickThrough = undefined;\n    this.adTitle = '';\n    this.duration = undefined;\n    this.skipoffset = undefined;\n  }\n\n  VASTResponse.prototype.addAd = function (ad) {\n    var inLine, wrapper;\n\n    if (ad instanceof Ad) {\n      inLine = ad.inLine;\n      wrapper = ad.wrapper;\n\n      this.ads.push(ad);\n\n      if (inLine) {\n        this._addInLine(inLine);\n      }\n\n      if (wrapper) {\n        this._addWrapper(wrapper);\n      }\n    }\n  };\n\n  VASTResponse.prototype._addErrorTrackUrl = function (error) {\n    var errorURL = error instanceof xml.JXONTree ? xml.keyValue(error) : error;\n    if (errorURL) {\n      this.errorURLMacros.push(errorURL);\n    }\n  };\n\n  VASTResponse.prototype._addImpressions = function (impressions) {\n    isArray(impressions) && appendToArray(this.impressions, impressions);\n  };\n\n  VASTResponse.prototype._addClickThrough = function (clickThrough) {\n    if (isNotEmptyString(clickThrough)) {\n      this.clickThrough = clickThrough;\n    }\n  };\n\n  VASTResponse.prototype._addClickTrackings = function (clickTrackings) {\n    isArray(clickTrackings) && appendToArray(this.clickTrackings, clickTrackings);\n  };\n\n  VASTResponse.prototype._addCustomClicks = function (customClicks) {\n    isArray(customClicks) && appendToArray(this.customClicks, customClicks);\n  };\n\n  VASTResponse.prototype._addTrackingEvents = function (trackingEvents) {\n    var eventsMap = this.trackingEvents;\n\n    if (trackingEvents) {\n      trackingEvents = isArray(trackingEvents) ? trackingEvents : [trackingEvents];\n      trackingEvents.forEach(function (trackingEvent) {\n        if (!eventsMap[trackingEvent.name]) {\n          eventsMap[trackingEvent.name] = [];\n        }\n        eventsMap[trackingEvent.name].push(trackingEvent);\n      });\n    }\n  };\n\n  VASTResponse.prototype._addTitle = function (title) {\n    if (isNotEmptyString(title)) {\n      this.adTitle = title;\n    }\n  };\n\n  VASTResponse.prototype._addDuration = function (duration) {\n    if (isNumber(duration)) {\n      this.duration = duration;\n    }\n  };\n\n  VASTResponse.prototype._addVideoClicks = function (videoClicks) {\n    if (videoClicks instanceof VideoClicks) {\n      this._addClickThrough(videoClicks.clickThrough);\n      this._addClickTrackings(videoClicks.clickTrackings);\n      this._addCustomClicks(videoClicks.customClicks);\n    }\n  };\n\n  VASTResponse.prototype._addMediaFiles = function (mediaFiles) {\n    isArray(mediaFiles) && appendToArray(this.mediaFiles, mediaFiles);\n  };\n\n  VASTResponse.prototype._addSkipoffset = function (offset) {\n    if (offset) {\n      this.skipoffset = offset;\n    }\n  };\n\n  VASTResponse.prototype._addAdParameters = function (adParameters) {\n    if (adParameters) {\n      this.adParameters = adParameters;\n    }\n  };\n\n  VASTResponse.prototype._addLinear = function (linear) {\n    if (linear instanceof Linear) {\n      this._addDuration(linear.duration);\n      this._addTrackingEvents(linear.trackingEvents);\n      this._addVideoClicks(linear.videoClicks);\n      this._addMediaFiles(linear.mediaFiles);\n      this._addSkipoffset(linear.skipoffset);\n      this._addAdParameters(linear.adParameters);\n      this._linearAdded = true;\n    }\n  };\n\n  VASTResponse.prototype._addInLine = function (inLine) {\n    var that = this;\n\n    if (inLine instanceof InLine) {\n      this._addTitle(inLine.adTitle);\n      this._addErrorTrackUrl(inLine.error);\n      this._addImpressions(inLine.impressions);\n\n      inLine.creatives.forEach(function (creative) {\n        if (creative.linear) {\n          that._addLinear(creative.linear);\n        }\n      });\n    }\n  };\n\n  VASTResponse.prototype._addWrapper = function (wrapper) {\n    var that = this;\n\n    if (wrapper instanceof Wrapper) {\n      this._addErrorTrackUrl(wrapper.error);\n      this._addImpressions(wrapper.impressions);\n\n      wrapper.creatives.forEach(function (creative) {\n        var linear = creative.linear;\n        if (linear) {\n          that._addVideoClicks(linear.videoClicks);\n          that.clickThrough = undefined;//We ensure that no clickThrough has been added\n          that._addTrackingEvents(linear.trackingEvents);\n        }\n      });\n    }\n  };\n\n  VASTResponse.prototype.hasLinear = function(){\n    return this._linearAdded;\n  };\n\n  function appendToArray(array, items) {\n    items.forEach(function (item) {\n      array.push(item);\n    });\n  }\n\n  window.VASTResponse = VASTResponse;\n})(window);\n","\"use strict\";\n\nvar vastUtil = {\n\n  track: function track(URLMacros, variables) {\n    var sources = vastUtil.parseURLMacros(URLMacros, variables);\n    var trackImgs = [];\n    sources.forEach(function (src) {\n      var img = new Image();\n      img.src = src;\n      trackImgs.push(img);\n    });\n    return trackImgs;\n  },\n\n  parseURLMacros: function parseMacros(URLMacros, variables) {\n    var parsedURLs = [];\n\n    variables = variables || {};\n\n    if (!(variables[\"CACHEBUSTING\"])) {\n      variables[\"CACHEBUSTING\"] = Math.round(Math.random() * 1.0e+10);\n    }\n\n    URLMacros.forEach(function (URLMacro) {\n      parsedURLs.push(vastUtil._parseURLMacro(URLMacro, variables));\n    });\n\n    return parsedURLs;\n  },\n\n  parseURLMacro: function parseMacro(URLMacro, variables) {\n    variables = variables || {};\n\n    if (!(variables[\"CACHEBUSTING\"])) {\n      variables[\"CACHEBUSTING\"] = Math.round(Math.random() * 1.0e+10);\n    }\n\n    return vastUtil._parseURLMacro(URLMacro, variables);\n  },\n\n  _parseURLMacro: function parseMacro(URLMacro, variables) {\n    variables = variables || {};\n\n    forEach(variables, function (value, key) {\n      URLMacro = URLMacro.replace(new RegExp(\"\\\\[\" + key + \"\\\\\\]\", 'gm'), value);\n    });\n\n    return URLMacro;\n  },\n\n  parseDuration: function parseDuration(durationStr) {\n    var durationRegex = /(\\d\\d):(\\d\\d):(\\d\\d)(\\.(\\d\\d\\d))?/;\n    var match, durationInMs;\n\n    if (isString(durationStr)) {\n      match = durationStr.match(durationRegex);\n      if (match) {\n        durationInMs = parseHoursToMs(match[1]) + parseMinToMs(match[2]) + parseSecToMs(match[3]) + parseInt(match[5] || 0);\n      }\n    }\n\n    return isNaN(durationInMs) ? null : durationInMs;\n\n    /*** local functions ***/\n    function parseHoursToMs(hourStr) {\n      return parseInt(hourStr, 10) * 60 * 60 * 1000;\n    }\n\n    function parseMinToMs(minStr) {\n      return parseInt(minStr, 10) * 60 * 1000;\n    }\n\n    function parseSecToMs(secStr) {\n      return parseInt(secStr, 10) * 1000;\n    }\n  },\n\n  parseImpressions: function parseImpressions(impressions) {\n    if (impressions) {\n      impressions = isArray(impressions) ? impressions : [impressions];\n      return transformArray(impressions, function (impression) {\n        if (isNotEmptyString(impression.keyValue)) {\n          return impression.keyValue;\n        }\n        return undefined;\n      });\n    }\n    return [];\n  },\n\n  parseCreatives: function parseCreatives(creativesJTree) {\n    var creatives = [];\n    var creativesData;\n    if (isDefined(creativesJTree) && isDefined(creativesJTree.creative)) {\n      creativesData = isArray(creativesJTree.creative) ? creativesJTree.creative : [creativesJTree.creative];\n      creativesData.forEach(function (creative) {\n        creatives.push(new Creative(creative));\n      });\n    }\n    return creatives;\n  },\n\n  //We assume that the progress is going to arrive in milliseconds\n  formatProgress: function formatProgress(progress) {\n    var hours, minutes, seconds, milliseconds;\n    hours = progress / (60 * 60 * 1000);\n    hours = Math.floor(hours);\n    minutes = (progress / (60 * 1000)) % 60;\n    minutes = Math.floor(minutes);\n    seconds = (progress / 1000) % 60;\n    seconds = Math.floor(seconds);\n    milliseconds = progress % 1000;\n    return toFixedDigits(hours, 2) + ':' + toFixedDigits(minutes, 2) + ':' + toFixedDigits(seconds, 2) + '.' + toFixedDigits(milliseconds, 3);\n  },\n\n  parseOffset:   function parseOffset(offset, duration) {\n    if(isPercentage(offset)){\n      return calculatePercentage(offset, duration);\n    }\n    return vastUtil.parseDuration(offset);\n\n    /*** Local function ***/\n    function isPercentage(offset) {\n      var percentageRegex = /^\\d+(\\.\\d+)?%$/g;\n      return percentageRegex.test(offset);\n    }\n\n    function calculatePercentage(percentStr, duration) {\n      if(duration) {\n        return calcPercent(duration, parseFloat(percentStr.replace('%', '')));\n      }\n      return null;\n    }\n\n    function calcPercent(quantity, percent){\n      return quantity * percent / 100;\n    }\n  },\n\n  isVPAID: function isVPAIDMediaFile(mediaFile) {\n    return !!mediaFile && mediaFile.apiFramework === 'VPAID';\n  }\n};"],"sourceRoot":"/source/"}